{"chunk_id": "layout-layouts-000", "document_id": "layout-layouts", "content": "Mojo’s [`layout` package](/mojo/kernels/layout/) provides a number of APIs for\nworking with dense multidimensional arrays, which simplify writing algorithms\nfor handling linear algebra.\n\nThis package includes the following main types:", "position": 0, "token_count": 55, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "layout-layouts-000", "document_id": "layout-layouts", "position": 0, "token_count": 55, "has_code": false, "overlap_with_previous": false, "section_hierarchy": [], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts"}}
{"chunk_id": "layout-layouts-001", "document_id": "layout-layouts", "content": "This package includes the following main types:\n\n- The [`Layout`](/mojo/kernels/layout/layout/Layout) struct describes an\n arrangement of data in memory. A *layout* is a function that maps a set of\n logical coordinates (like (*x*, *y*) in a two-dimensional array) to a linear\n index value. Layouts can be hierarchical (for example, representing a 2D\n matrix that’s further subdivided into tiles).\n- [`LayoutTensor`](/mojo/kernels/layout/layout_tensor/LayoutTensor) is a flexible\n tensor type that combines a `Layout` and a pointer to data.\n- The [`IntTuple`](/mojo/kernels/layout/int_tuple/IntTuple) struct is a\n hierarchical tuple type, where each element of the tuple can either be an\n integral value or a nested `IntTuple`. The `IntTuple` type is used extensively\n for defining and indexing layouts and layout tensors.\n\ntip Example code", "position": 1, "token_count": 228, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "layout-layouts-001", "document_id": "layout-layouts", "position": 1, "token_count": 228, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts"}}
{"chunk_id": "layout-layouts-002", "document_id": "layout-layouts", "content": "tip Example code\n\nYou can find most of the code examples on this page in the [public GitHub repo](https://github.com/modular/modular/tree/main/examples/mojo/layouts).\n\nSome of the concepts presented here can be a little hard to grasp from static\nexamples, so we recommend downloading the example code and experimenting.", "position": 2, "token_count": 81, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "layout-layouts-002", "document_id": "layout-layouts", "position": 2, "token_count": 81, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts"}}
{"chunk_id": "layout-layouts-003", "document_id": "layout-layouts", "content": "## What’s a Layout?\n\nA layout is a function that maps a set of logical coordinates to a single linear\nindex value.\n\nFor example, a layout could describe a 2x4 row-major matrix, or a 6x6\ncolumn-major matrix.\n\n```mojo\nfrom layout import Layout, print_layout\n\nvar l2x4row_major = Layout.row_major(2, 4)\nvar l6x6col_major = Layout.col_major(6, 6)", "position": 3, "token_count": 105, "has_code": true, "section_hierarchy": ["What’s a Layout?"], "metadata": {"chunk_id": "layout-layouts-003", "document_id": "layout-layouts", "position": 3, "token_count": 105, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["What’s a Layout?"], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts#whats-a-layout"}}
{"chunk_id": "layout-layouts-004", "document_id": "layout-layouts", "content": "```\n\nLayouts are made up of two tuples: shape and stride, where shape describes the\nlogical coordinate space and the stride determines the mapping to the linear\nindex value. A layout can be written as (*shape*:*stride*). For\nexample, a contiguous vector of length 4 can be represented as (4:1):\n\n<figure>\n\n![](../images/layout/1d-layout-with-strides.png#light)\n![](../images/layout/1d-layout-with-strides-dark.png#dark)\n\n<figcaption><b>Figure 1.</b> 1D layout (4:1)</figcaption>\n</figure>", "position": 4, "token_count": 161, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "layout-layouts-004", "document_id": "layout-layouts", "position": 4, "token_count": 161, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts"}}
{"chunk_id": "layout-layouts-005", "document_id": "layout-layouts", "content": "<figcaption><b>Figure 1.</b> 1D layout (4:1)</figcaption>\n</figure>\n\nA 3x4 row-major layout can be represented as ((3, 4):(4, 1)). That is, the\n*shape* is 3x4 and the *strides* are 4 and 1. You can break this down into two\nsub-layouts or *modes*: a row mode and a column mode: 3 rows with a stride of 4\n(3:4, the first numbers from each tuple) and 4 columns with a stride of 1 (4:1,\nthe second numbers from each tuple).\n\nThe [`print_layout()`](/mojo/kernels/layout/layout/print_layout) function\ngenerates an ASCII diagram of any 2D layout, showing the coordinates on the\noutside and the corresponding index values in the grid.\n\n```mojo\nvar l3x4row_major = Layout.row_major(3, 4)\nprint_layout(l3x4row_major)", "position": 5, "token_count": 235, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "layout-layouts-005", "document_id": "layout-layouts", "position": 5, "token_count": 235, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts"}}
{"chunk_id": "layout-layouts-006", "document_id": "layout-layouts", "content": "```\n\nOutput:\n\n```plaintext\n((3, 4):(4, 1))\n 0 1 2 3\n +----+----+----+----+\n 0 | 0 | 1 | 2 | 3 |\n +----+----+----+----+\n 1 | 4 | 5 | 6 | 7 |\n +----+----+----+----+\n 2 | 8 | 9 | 10 | 11 |\n +----+----+----+----+", "position": 6, "token_count": 143, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "layout-layouts-006", "document_id": "layout-layouts", "position": 6, "token_count": 143, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts"}}
{"chunk_id": "layout-layouts-007", "document_id": "layout-layouts", "content": "```\n\nThe coordinate to index mapping is performed by calculating the dot product of\nthe logical coordinates and the corresponding strides. For example, given the\ncoordinates (*i, j*) and the layout shown above, the index value is $i*4 + j*1$.\nSo coordinate (1, 1) maps to 5, as shown in the diagram.\n\nThe following example shows how to use a `Layout` to convert between coordinates\nand index values.\n\n```mojo\nvar coords = IntTuple(1, 1)\nvar idx = l3x4row_major(coords)\nprint(\"index at coordinates (1, 1): \", idx)\nprint(\"coordinates at index 7:\", l3x4row_major.idx2crd(7))\n```\n\nOutput:\n\n```plaintext\nindex at coordinates (1, 1): 5\ncoordinates at index 7: (1, 3)", "position": 7, "token_count": 202, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "layout-layouts-007", "document_id": "layout-layouts", "position": 7, "token_count": 202, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts"}}
{"chunk_id": "layout-layouts-008", "document_id": "layout-layouts", "content": "```\n\nOutput:\n\n```plaintext\nindex at coordinates (1, 1): 5\ncoordinates at index 7: (1, 3)\n```\n\nAs this example shows, the layout is a function that takes a set of integer\ncoordinates and returns a single integer (the linear index). The `Layout` struct\nalso provides an [`idx2crd()`](/mojo/kernels/layout/layout/Layout#idx2crd) method\nthat transforms a linear index into a set of logical coordinates.\n\nnote Printing layouts\n\nYou can use `print_layout()` to print a diagram of any 2D layout. You can pass\n*any* layout to the built-in `print()` function to print a string representation\nof the layout in the form of a (*shape*:*stride*) pair.", "position": 8, "token_count": 181, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "layout-layouts-008", "document_id": "layout-layouts", "position": 8, "token_count": 181, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts"}}
{"chunk_id": "layout-layouts-009", "document_id": "layout-layouts", "content": "### IntTuple: representing hierarchical shapes and strides\n\nA layout’s shape and stride are represented using the\n[`IntTuple`](/mojo/kernels/layout/int_tuple/IntTuple) type. Each element of an\n`IntTuple` is either an integer value or a nested `IntTuple`. You can create\nnested `IntTuples` using the `IntTuple` constructor:\n\n```mojo\nvar shape1 = IntTuple(4, IntTuple(2, 2))", "position": 9, "token_count": 119, "has_code": true, "section_hierarchy": ["IntTuple: representing hierarchical shapes and strides"], "metadata": {"chunk_id": "layout-layouts-009", "document_id": "layout-layouts", "position": 9, "token_count": 119, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["IntTuple: representing hierarchical shapes and strides"], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts#inttuple-representing-hierarchical-shapes-and-strides"}}
{"chunk_id": "layout-layouts-010", "document_id": "layout-layouts", "content": "```\n\nA layout’s shape and stride tuples must be *congruent*—that is, they need to\nhave the same hierarchical structure: the tuples must have the same number of\nelements, and any elements that are nested tuples must also have the same number\nof elements.\n\nThe [`int_tuple`](/mojo/kernels/layout/int_tuple/) package provides a number of\nfunctions for working with `IntTuple`. For example, it provides a\n[`congruent()`](/mojo/kernels/layout/int_tuple/congruent) function for testing\nthe congruency of two tuples.", "position": 10, "token_count": 147, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "layout-layouts-010", "document_id": "layout-layouts", "position": 10, "token_count": 147, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts"}}
{"chunk_id": "layout-layouts-011", "document_id": "layout-layouts", "content": "### Modes\n\nA layout has one or more *modes*, where a mode is a shape:stride pair. For\nexample, the 1D vector layout (8:1) has a single mode: 8 elements with a stride\nof 1:\n\n<figure>\n\n![](../images/layout/1d-layout.png#light)\n![](../images/layout/1d-layout-dark.png#dark)\n\n<figcaption><b>Figure 2.</b> 1D layout</figcaption>\n</figure>\n\nThe 2D row-major matrix layout ((2, 4):(4, 1)) has two modes, 2:4 (the first\nnumbers from each tuple) and 4:1 (the second numbers from each tuple). Taking\nthem right to left, the second mode describes 4 columns with a stride of one.\nThe first mode specifies that there are two of these groups with a stride of 4:\n\n<figure>", "position": 11, "token_count": 215, "has_code": false, "section_hierarchy": ["Modes"], "metadata": {"chunk_id": "layout-layouts-011", "document_id": "layout-layouts", "position": 11, "token_count": 215, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Modes"], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts#modes"}}
{"chunk_id": "layout-layouts-012", "document_id": "layout-layouts", "content": "<figure>\n\n![](../images/layout/2d-layout-with-strides.png#light)\n![](../images/layout/2d-layout-with-strides-dark.png#dark)\n\n<figcaption><b>Figure 3.</b> 2D layout with strides</figcaption>\n</figure>\n\nIn a column-major layout, the row number varies the fastest, so a column-major\n2x4 matrix has the layout ((2, 4):(1, 2)) and looks like this:\n\n<figure>\n\n![](../images/layout/2d-col-major-layout-with-strides.png#light)\n![](../images/layout/2d-col-major-layout-with-strides-dark.png#dark)\n\n<figcaption><b>Figure 4.</b> 2D column-major layout with strides</figcaption>\n</figure>", "position": 12, "token_count": 221, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "layout-layouts-012", "document_id": "layout-layouts", "position": 12, "token_count": 221, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts"}}
{"chunk_id": "layout-layouts-013", "document_id": "layout-layouts", "content": "<figcaption><b>Figure 4.</b> 2D column-major layout with strides</figcaption>\n</figure>\n\nA layout’s *rank* is the number of modes in its shape. A rank-1 (or 1D) layout\ndescribes a vector. A rank-2 layout describes a 2D matrix, and so on.\n\nA layout’s *size* is defined as the product of all of the modes in the layout’s\nshape. To put it another way, it’s the number of elements that the layout\naddresses: that is, the *domain* of the layout function.\n\nModes can also be nested to represent more complicated strides along a\ndimension. For example, the layout (8:1) represents a 1D vector of 8 elements.\n\n<figure>\n\n![](../images/layout/1d-layout.png#light)\n![](../images/layout/1d-layout-dark.png#dark)", "position": 13, "token_count": 213, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "layout-layouts-013", "document_id": "layout-layouts", "position": 13, "token_count": 213, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts"}}
{"chunk_id": "layout-layouts-014", "document_id": "layout-layouts", "content": "![](../images/layout/1d-layout.png#light)\n![](../images/layout/1d-layout-dark.png#dark)\n\n<figcaption><b>Figure 5.</b> 1D vector layout</figcaption>\n</figure>\n\nThe layout (((4, 2):(1, 4))) is *also* a 1D vector of 8 elements. The extra set\nof parentheses indicates a nested or hierarchical mode. Instead of being\nrepresented by a single mode like 8:1, this layout’s single dimension is\nrepresented by the multi-mode (4, 2):(1, 4):\n\n<figure>\n\n![](../images/layout/1d-multi-modal-layout.png#light)\n![](../images/layout/1d-multi-modal-layout-dark.png#dark)", "position": 14, "token_count": 212, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "layout-layouts-014", "document_id": "layout-layouts", "position": 14, "token_count": 212, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts"}}
{"chunk_id": "layout-layouts-015", "document_id": "layout-layouts", "content": "<figcaption><b>Figure 6.</b> 1D layout with nested modes</figcaption>\n</figure>\n\nNote that in the nested modes, there’s no notion of row and column. You can\nthink of the first mode as the “inner” mode (defining a group) and the next mode\nas an “outer” mode (defining a repeat of the group) as shown above.\n\nA set of nested modes (a *multi-mode*) counts as a single mode when considering\nthe parent layout’s rank. For example, the layouts (8:1) and (((4, 2):(1, 4)))\nare both rank-1 layouts.\n\nThis gets more interesting when we move to two dimensions. Consider the\nfollowing 2D layouts:\n\n<figure>\n\n![](../images/layout/multi-modal-layout.png#light)\n![](../images/layout/multi-modal-layout-dark.png#dark)", "position": 15, "token_count": 224, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "layout-layouts-015", "document_id": "layout-layouts", "position": 15, "token_count": 224, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts"}}
{"chunk_id": "layout-layouts-016", "document_id": "layout-layouts", "content": "![](../images/layout/multi-modal-layout.png#light)\n![](../images/layout/multi-modal-layout-dark.png#dark)\n\n<figcaption><b>Figure 7.</b> Two 2D layouts</figcaption>\n</figure>\n\nLayouts A and B are both 2D matrix layouts with the same overall 2D shape, but\nwith the elements in a different order. Layout B is *tiled*, so instead of being\nin row-major or column-major order, four consecutive indices are grouped into\neach 2x2 tile. This is sometimes called *tile-major order*.\n\nWe can break this tiled layout into two modes, one for the rows and one for the columns:", "position": 16, "token_count": 170, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "layout-layouts-016", "document_id": "layout-layouts", "position": 16, "token_count": 170, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts"}}
{"chunk_id": "layout-layouts-017", "document_id": "layout-layouts", "content": "We can break this tiled layout into two modes, one for the rows and one for the columns:\n\n- Layout B has a row mode of (2, 2):(1, 4). We can further break this into two\n sub-modes: the inner mode, 2:1, defines a group of two rows with a stride of\n one. The outer mode, 2:4, specifies that the group occurs twice with a stride\n of 4.\n- The column has the mode (2, 2):(2, 8). Once again we can break this into two\n sub-modes: (2:2) defines a group of two columns with a stride of two, and the\n group occurs twice with a stride of 8 (2:8).\n\n If all of those modes are swimming before your eyes, take a moment to study the\n figure and trace out the strides yourself.", "position": 17, "token_count": 181, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "layout-layouts-017", "document_id": "layout-layouts", "position": 17, "token_count": 181, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts"}}
{"chunk_id": "layout-layouts-018", "document_id": "layout-layouts", "content": "### Coordinates\n\nCoordinates for layouts can be written in the same format as the shape tuple.\nFor example, coordinates for layout B above can be written ((*i, j*), (*k, l*)).\nHowever, this layout can also be addressed as a logical 2D matrix, just like\nlayout A. So ((0, 1), (0, 1)) and (2, 2) are both valid coordinates that map to\nthe same index.\n\nIn fact, this is true for any layout: the layout can be addressed with 1D or 2D\ncoordinates as well as its “natural” coordinates. When mapping coordinates, the\ndimensions are traversed in *colexicographical* order (that is, a generalized\ncolumn-major order, where the leftmost coordinate varies fastest). Table 1 shows\nhow different 1D and 2D coordinates map to the “natural” coordinates of the ((2,\n2), (2, 2)) shape shown above:\n\n<figure>", "position": 18, "token_count": 208, "has_code": false, "section_hierarchy": ["Coordinates"], "metadata": {"chunk_id": "layout-layouts-018", "document_id": "layout-layouts", "position": 18, "token_count": 208, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Coordinates"], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts#coordinates"}}
{"chunk_id": "layout-layouts-019", "document_id": "layout-layouts", "content": "| 1D | 2D | Natural |\n| ----- | :---- | :---- |\n| 0 | (0, 0) | ((0, 0), (0, 0)) |\n| 1 | (1, 0) | ((1, 0), (0, 0)) |\n| 2 | (2, 0) | ((0, 1), (0, 0)) |\n| 3 | (3, 0) | ((1, 1), (0, 0)) |\n| 4 | (0, 1) | ((0, 0), (1, 0)) |\n| 5 | (1, 1) | ((1, 0), (1, 0)) |\n| 6 | (2, 1) | ((0, 1), (1, 0)) |\n| 7 | (3, 1) | ((1, 1), (1, 0)) |", "position": 19, "token_count": 213, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "layout-layouts-019", "document_id": "layout-layouts", "position": 19, "token_count": 213, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts"}}
{"chunk_id": "layout-layouts-020", "document_id": "layout-layouts", "content": "| 7 | (3, 1) | ((1, 1), (1, 0)) |\n| 8 | (0, 2) | ((0, 0), (0, 1)) |\n| ... | ... | ... |\n| 15 | (3, 3) | ((1, 1), (1, 1)) |", "position": 20, "token_count": 84, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "layout-layouts-020", "document_id": "layout-layouts", "position": 20, "token_count": 84, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts"}}
{"chunk_id": "layout-layouts-021", "document_id": "layout-layouts", "content": "<figcaption><b>Table 1.</b> Mapping between 1D, 2D, and natural coordinates</figcaption>\n</figure>", "position": 21, "token_count": 37, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "layout-layouts-021", "document_id": "layout-layouts", "position": 21, "token_count": 37, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts"}}
{"chunk_id": "layout-layouts-022", "document_id": "layout-layouts", "content": "## Making layouts\n\nThere are multiple ways to create layouts. The\n[`row_major()`](/mojo/kernels/layout/layout/Layout/#row_major) and\n[`col_major()`](/mojo/kernels/layout/layout/Layout/#col_major) static methods are\nprobably the simplest ways to create a layout. The `row_major()` method creates\na generalized row-major layout: that is, the rightmost coordinate varies the\nfastest. The `col_major()` method creates a generalized column-major layout,\nwhere the leftmost coordinate varies the fastest.\n\n```mojo\nprint(Layout.row_major(4, 4, 4))\nprint(Layout.col_major(4, 4, 4))\n```\n\nOutput:\n\n```plaintext\n((4, 4, 4):(16, 4, 1))\n((4, 4, 4):(1, 4, 16))", "position": 22, "token_count": 216, "has_code": true, "section_hierarchy": ["Making layouts"], "metadata": {"chunk_id": "layout-layouts-022", "document_id": "layout-layouts", "position": 22, "token_count": 216, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Making layouts"], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts#making-layouts"}}
{"chunk_id": "layout-layouts-023", "document_id": "layout-layouts", "content": "```\n\nOutput:\n\n```plaintext\n((4, 4, 4):(16, 4, 1))\n((4, 4, 4):(1, 4, 16))\n```\n\nIf you know the shape and strides in advance, you can construct an arbitrarily\ncomplex layout using the `Layout` constructor. For example:\n\n```mojo\nvar tiled_layout = Layout(\n IntTuple(IntTuple(3, 2), IntTuple(2, 5)), # shape\n IntTuple(IntTuple(1, 6), IntTuple(3, 12)) # strides\n)\nprint_layout(tiled_layout)", "position": 23, "token_count": 149, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "layout-layouts-023", "document_id": "layout-layouts", "position": 23, "token_count": 149, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts"}}
{"chunk_id": "layout-layouts-024", "document_id": "layout-layouts", "content": "```\n\nOutput:\n\n```plaintext", "position": 24, "token_count": 12, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "layout-layouts-024", "document_id": "layout-layouts", "position": 24, "token_count": 12, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts"}}
{"chunk_id": "layout-layouts-025", "document_id": "layout-layouts", "content": "(((3, 2), (2, 5)):((1, 6), (3, 12)))\n 0 1 2 3 4 5 6 7 8 9\n +----+----+----+----+----+----+----+----+----+----+\n 0 | 0 | 3 | 12 | 15 | 24 | 27 | 36 | 39 | 48 | 51 |\n +----+----+----+----+----+----+----+----+----+----+\n 1 | 1 | 4 | 13 | 16 | 25 | 28 | 37 | 40 | 49 | 52 |", "position": 25, "token_count": 187, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "layout-layouts-025", "document_id": "layout-layouts", "position": 25, "token_count": 187, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts"}}
{"chunk_id": "layout-layouts-026", "document_id": "layout-layouts", "content": "1 | 1 | 4 | 13 | 16 | 25 | 28 | 37 | 40 | 49 | 52 |\n +----+----+----+----+----+----+----+----+----+----+\n 2 | 2 | 5 | 14 | 17 | 26 | 29 | 38 | 41 | 50 | 53 |\n +----+----+----+----+----+----+----+----+----+----+\n 3 | 6 | 9 | 18 | 21 | 30 | 33 | 42 | 45 | 54 | 57 |\n +----+----+----+----+----+----+----+----+----+----+", "position": 26, "token_count": 221, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "layout-layouts-026", "document_id": "layout-layouts", "position": 26, "token_count": 221, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts"}}
{"chunk_id": "layout-layouts-027", "document_id": "layout-layouts", "content": "4 | 7 | 10 | 19 | 22 | 31 | 34 | 43 | 46 | 55 | 58 |\n +----+----+----+----+----+----+----+----+----+----+\n 5 | 8 | 11 | 20 | 23 | 32 | 35 | 44 | 47 | 56 | 59 |\n +----+----+----+----+----+----+----+----+----+----+", "position": 27, "token_count": 148, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "layout-layouts-027", "document_id": "layout-layouts", "position": 27, "token_count": 148, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts"}}
{"chunk_id": "layout-layouts-028", "document_id": "layout-layouts", "content": "```\n\nThe result is a 6x10 tile-major layout. The layout is indexed vertically in 2\ngroups of 3 rows (3, 2) : (1, 6) ( and horizontally in 5 groups of 2 columns (2,\n5):(3, 12). Alternatively, you can think of this as a layout consisting of 3x2\ncolumn-major tiles ((3, 2):(1, 3)) that are arranged into two rows of 5, ((2,\n5):(6, 12)).\n\nThe `Layout` constructor works fine if you know the shape and strides in\nadvance, but calculating the strides for a complicated layout isn’t always\nintuitive.\n\nAn easier way to generate this layout is the\n[`tile_to_shape()`](/mojo/kernels/layout/layout/tile_to_shape) function.\nThis takes a layout (representing the tile) and a final shape to tile to:\n\n```mojo\nvar tts = tile_to_shape(Layout.col_major(3, 2), IntTuple(6, 10))\nprint_layout(tts)", "position": 28, "token_count": 244, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "layout-layouts-028", "document_id": "layout-layouts", "position": 28, "token_count": 244, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts"}}
{"chunk_id": "layout-layouts-029", "document_id": "layout-layouts", "content": "```\n\nOutput:", "position": 29, "token_count": 7, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "layout-layouts-029", "document_id": "layout-layouts", "position": 29, "token_count": 7, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts"}}
{"chunk_id": "layout-layouts-030", "document_id": "layout-layouts", "content": "```plaintext\n(((3, 2), (2, 5)):((1, 6), (3, 12)))\n 0 1 2 3 4 5 6 7 8 9\n +----+----+----+----+----+----+----+----+----+----+\n 0 | 0 | 3 | 12 | 15 | 24 | 27 | 36 | 39 | 48 | 51 |\n +----+----+----+----+----+----+----+----+----+----+\n 1 | 1 | 4 | 13 | 16 | 25 | 28 | 37 | 40 | 49 | 52 |", "position": 30, "token_count": 192, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "layout-layouts-030", "document_id": "layout-layouts", "position": 30, "token_count": 192, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts"}}
{"chunk_id": "layout-layouts-031", "document_id": "layout-layouts", "content": "1 | 1 | 4 | 13 | 16 | 25 | 28 | 37 | 40 | 49 | 52 |\n +----+----+----+----+----+----+----+----+----+----+\n 2 | 2 | 5 | 14 | 17 | 26 | 29 | 38 | 41 | 50 | 53 |\n +----+----+----+----+----+----+----+----+----+----+\n 3 | 6 | 9 | 18 | 21 | 30 | 33 | 42 | 45 | 54 | 57 |\n +----+----+----+----+----+----+----+----+----+----+", "position": 31, "token_count": 221, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "layout-layouts-031", "document_id": "layout-layouts", "position": 31, "token_count": 221, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts"}}
{"chunk_id": "layout-layouts-032", "document_id": "layout-layouts", "content": "4 | 7 | 10 | 19 | 22 | 31 | 34 | 43 | 46 | 55 | 58 |\n +----+----+----+----+----+----+----+----+----+----+\n 5 | 8 | 11 | 20 | 23 | 32 | 35 | 44 | 47 | 56 | 59 |\n +----+----+----+----+----+----+----+----+----+----+", "position": 32, "token_count": 148, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "layout-layouts-032", "document_id": "layout-layouts", "position": 32, "token_count": 148, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts"}}
{"chunk_id": "layout-layouts-033", "document_id": "layout-layouts", "content": "```\n\nA variation on `tile_to_shape()` is the\n[`blocked_product()`](/mojo/kernels/layout/layout/blocked_product) function. The\nmain difference is that where `tile_to_shape()` takes an output *shape*,\n`blocked_product()` takes a *tiler* layout: essentially, every element in the\ntiler layout is replaced by a tile. The following example generates the same\ntiled layout using `blocked_product()`. It also prints out the two input\nlayouts.\n\n```mojo", "position": 33, "token_count": 128, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "layout-layouts-033", "document_id": "layout-layouts", "position": 33, "token_count": 128, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts"}}
{"chunk_id": "layout-layouts-034", "document_id": "layout-layouts", "content": "# Define 2x3 tile\nvar tile = Layout.col_major(3, 2)", "position": 34, "token_count": 21, "has_code": false, "section_hierarchy": ["Define 2x3 tile"], "metadata": {"chunk_id": "layout-layouts-034", "document_id": "layout-layouts", "position": 34, "token_count": 21, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Define 2x3 tile"], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts#define-2x3-tile"}}
{"chunk_id": "layout-layouts-035", "document_id": "layout-layouts", "content": "# Define a 2x5 tiler\nvar tiler = Layout.col_major(2, 5)\nvar blocked = blocked_product(tile, tiler)\n\nprint(\"Tile:\")\nprint_layout(tile)\nprint(\"\\nTiler:\")\nprint_layout(tiler)\nprint(\"\\nTiled layout:\")\nprint(blocked)", "position": 35, "token_count": 80, "has_code": false, "section_hierarchy": ["Define a 2x5 tiler"], "metadata": {"chunk_id": "layout-layouts-035", "document_id": "layout-layouts", "position": 35, "token_count": 80, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Define a 2x5 tiler"], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts#define-a-2x5-tiler"}}
{"chunk_id": "layout-layouts-036", "document_id": "layout-layouts", "content": "```\n\nOutput:\n\n```plaintext\nTile:\n((3, 2):(1, 3))\n 0 1\n +---+---+\n 0 | 0 | 3 |\n +---+---+\n 1 | 1 | 4 |\n +---+---+\n 2 | 2 | 5 |\n +---+---+\n\nTiler:\n((2, 5):(1, 2))\n 0 1 2 3 4\n +----+----+----+----+----+\n 0 | 0 | 2 | 4 | 6 | 8 |\n +----+----+----+----+----+\n 1 | 1 | 3 | 5 | 7 | 9 |\n +----+----+----+----+----+\n\nTiled layout:\n(((3, 2), (2, 5)):((1, 6), (3, 12)))", "position": 36, "token_count": 238, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "layout-layouts-036", "document_id": "layout-layouts", "position": 36, "token_count": 238, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts"}}
{"chunk_id": "layout-layouts-037", "document_id": "layout-layouts", "content": "```\n\nAs you can see, `blocked_product()` combines two simple layouts to generate a\nmore complex one.\n\nFinally, if you know the *shape* you want and the *order* in which you want to\niterate through the dimensions, you can use the\n[`make_ordered_layout()`](/mojo/kernels/layout/layout/make_ordered_layout)\nfunction. For example, the following example is yet one more way to generate the\nprevious tiled layout:\n\n```mojo\nvar ordered = make_ordered_layout(\n IntTuple(IntTuple(3, 2), IntTuple(2, 5)), # shape\n IntTuple(IntTuple(0, 2), IntTuple(1, 3)) # order\n)\nprint(ordered)\n```\n\nOutput:\n\n```plaintext\n(((3, 2), (2, 5)):((1, 6), (3, 12)))", "position": 37, "token_count": 214, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "layout-layouts-037", "document_id": "layout-layouts", "position": 37, "token_count": 214, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts"}}
{"chunk_id": "layout-layouts-038", "document_id": "layout-layouts", "content": "```\n\nOutput:\n\n```plaintext\n(((3, 2), (2, 5)):((1, 6), (3, 12)))\n```\n\nThe generated layout's strides follow the same ordering as `order`—that is, the\ndimension with the smallest corresponding `order` value has the smallest stride\nvalue, and so on. The strides are computed such that the layout is dense—that\nis, the logical multidimensional array is contiguous.", "position": 38, "token_count": 106, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "layout-layouts-038", "document_id": "layout-layouts", "position": 38, "token_count": 106, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts"}}
{"chunk_id": "layout-layouts-039", "document_id": "layout-layouts", "content": "## Non-contiguous layouts\n\nAll of the examples so far have been dense layouts, where all of the elements\nare contiguous in memory. However, layouts can also describe sparse logical\narrays. For example, a (4:2) layout is a sparse 1D array:\n\n<figure>\n\n![](../images/layout/1d-sparse-layout.png#light)\n![](../images/layout/1d-sparse-layout-dark.png#dark)\n\n<figcaption><b>Figure 8.</b> 1D sparse layout (4:2)</figcaption>\n</figure>\n\nA layout’s *cosize* is the size of the layout’s codomain, which you can think of\nas the size of the smallest contiguous array that can contain all of the\nlayout’s elements. The cosize is the largest linear index value generated by the\nlayout plus 1. So in the example in Figure 8, the layout has a size of 4, but a\ncosize of 7.", "position": 39, "token_count": 230, "has_code": false, "section_hierarchy": ["Non-contiguous layouts"], "metadata": {"chunk_id": "layout-layouts-039", "document_id": "layout-layouts", "position": 39, "token_count": 230, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Non-contiguous layouts"], "file_path": "layout/layouts.mdx", "url": "https://docs.modular.com/mojo/manual/layout/layouts", "title": "Introduction to layouts", "category": null, "tags": [], "section_url": "https://docs.modular.com/mojo/manual/layout/layouts#non-contiguous-layouts"}}
