## 2025-11-10 MCP Multi-Server Architecture & Restructuring

### Project Goal
Build self-contained MCP resource servers for various documentation sources (Mojo, DuckDB, etc.) that can be:
- **Distributed independently** via GitHub (as standalone repos or submodules)
- **Developed locally** with shared build infrastructure  
- **Updated automatically** from upstream documentation sources
- **Accessible to all users** (with or without pixi)

### Key Design Decisions (Ratified in RESTRUCTURING_PLAN.md)

1. **Self-Contained Servers**: Each `/servers/{mcp-name}/` is fully standalone with its own runtime code
2. **Multi-Format Support**: `.mdx`, `.md`, and pluggable other formats via ProcessorFactory
3. **YAML Configuration**: All paths/params config-driven, no hardcoded paths in Python
4. **Non-Pixi Compatible**: Each server has `requirements.txt` for pip + venv setup
5. **Doc Automation**: `sync_documentation.sh` syncs from upstream, GitHub Actions for CI/CD
6. **Build Separation**: `/shared/` is dev-time only; `/servers/*/runtime/` is distributable

### Git Implementation Strategy

**8 phases with branches** (see `RESTRUCTURING_PLAN.md` for full details):
1. `restructure/01-directory-structure-and-config` ← Start here
2. `restructure/02-multi-format-doc-support`
3. `restructure/03-parameterize-build-scripts`
4. `restructure/04-move-build-infrastructure`
5. `restructure/05-organize-mojo-server`
6. `restructure/06-create-tooling-and-automation`
7. `restructure/07-update-documentation`
8. `restructure/08-final-cleanup-and-validation`

### Current vs. Target

**Current Issues**: 
- Multiple main.db and search.py files (ambiguous)
- Hardcoded for Mojo only
- No clear distribution model
- Build/runtime code mixed
- No config-driven paths

**Target State**:
- ✅ Shared build in `/shared/` (dev-time only)
- ✅ Per-server runtime in `/servers/{mcp}/runtime/` (distributable)
- ✅ Config-driven YAML paths
- ✅ Multi-format doc support
- ✅ Automation for upstream doc updates
- ✅ Works without pixi (pip + venv)

### Naming Conventions (Standardized)

- **Servers**: `servers/{tool}-{doc-type}-mcp/` (e.g., `mojo-manual-mcp`)
- **Server file**: `{tool}_{doc_type}_mcp_server.py` (e.g., `mojo_manual_mcp_server.py`)
- **Database**: `{tool}_{doc_type}_mcp.db`
- **Config**: `servers/{mcp}/config/{processing,server}_config.yaml`
- **Source docs**: `source-documentation/{tool}/{doc-type}/`

### Environment Variables (Runtime)

```
MOJO_DB_PATH=servers/mojo-manual-mcp/runtime/mojo_manual_mcp.db
MAX_SERVER_URL=http://localhost:8000/v1
EMBED_MODEL_NAME=sentence-transformers/all-mpnet-base-v2
AUTO_START_MAX=1
```

### .gitignore Updates (Phase 1)

Exclude:
- `shared/build/` — ephemeral artifacts
- `*.db`, `*.ducklake` — large databases  
- `__pycache__/`, `.pixi/`, `venv/`
- `.env`, IDE files

### Comprehensive Plan Reference

Full implementation details in: `RESTRUCTURING_PLAN.md`
- 40+ page detailed guide
- Phase-by-phase breakdown
- Git workflows
- Code examples
- Configuration templates
- Automation scripts

### Next Immediate Action

**Start Phase 1**: `restructure/01-directory-structure-and-config`
- Create directory hierarchy
- Add .gitignore patterns  
- Create config templates
- Low risk, easy to review

