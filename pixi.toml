[workspace]
channels = ["https://conda.modular.com/max-nightly", "conda-forge"]
name = "mcp"
platforms = ["linux-64"]
version = "0.1.0"

[tasks]
process = "python -m preprocessing.src.pipeline"
generate-embeddings = "python embedding/generate_embeddings.py"
consolidate = "python embedding/consolidate_data.py"
load = "python embedding/load_to_ducklake.py"
index = "python embedding/create_indexes.py"
search = "python servers/mojo-manual-mcp/runtime/search.py"
mcp-dev = "mcp dev servers/mojo-manual-mcp/runtime/mojo_manual_mcp_server.py"
max-serve = "max serve --model sentence-transformers/all-mpnet-base-v2"

# MCP-specific build tasks - Updated paths to shared/
mojo-process = "python -m shared.preprocessing.src.pipeline --config servers/mojo-manual-mcp/config/processing_config.yaml --doc-name 'Mojo Manual'"
mojo-generate-embeddings = "python -m shared.embedding.generate_embeddings --mcp-name mojo --doc-type manual --config servers/mojo-manual-mcp/config/processing_config.yaml"
mojo-consolidate = "python -m shared.embedding.consolidate_data --mcp-name mojo --doc-type manual"
mojo-load = "python -m shared.embedding.load_to_ducklake --mcp-name mojo --doc-type manual"
mojo-index = "python -m shared.embedding.create_indexes --mcp-name mojo --doc-type manual"

duckdb-process = "python -m shared.preprocessing.src.pipeline --config servers/duckdb-docs-mcp/config/processing_config.yaml --doc-name 'DuckDB Docs'"
duckdb-generate-embeddings = "python -m shared.embedding.generate_embeddings --mcp-name duckdb --doc-type docs --config servers/duckdb-docs-mcp/config/processing_config.yaml"
duckdb-consolidate = "python -m shared.embedding.consolidate_data --mcp-name duckdb --doc-type docs"
duckdb-load = "python -m shared.embedding.load_to_ducklake --mcp-name duckdb --doc-type docs"
duckdb-index = "python -m shared.embedding.create_indexes --mcp-name duckdb --doc-type docs"

mojo-build = """
pixi run mojo-process && \
pixi run mojo-generate-embeddings && \
pixi run mojo-consolidate && \
pixi run mojo-load && \
pixi run mojo-index
"""

duckdb-build = """
pixi run duckdb-process && \
pixi run duckdb-generate-embeddings && \
pixi run duckdb-consolidate && \
pixi run duckdb-load && \
pixi run duckdb-index
"""

# Demonstration: generic tasks with explicit mcp-name and doc-type
process-mojo = "python -m shared.preprocessing.src.pipeline --config servers/mojo-manual-mcp/config/processing_config.yaml --doc-name 'Mojo Manual'"
generate-embeddings-mojo = "python -m shared.embedding.generate_embeddings --mcp-name mojo --doc-type manual"







[dependencies]
python = "==3.12.3"
openai = ">=2.3.0,<3"
duckdb = ">=1.4.1,<2"
modular = ">=26.1.0.dev2025112105,<27"
tiktoken = ">=0.12.0,<0.13"
python-frontmatter = ">=1.1.0,<2"
pyyaml = ">=6.0.3,<7"
pathlib = ">=1.0.1,<2"
numpy = ">=2.3.3,<3"
requests = ">=2.32.5,<3"
pyarrow = ">=21.0.0,<22"
pandas = ">=2.3.3,<3"
tqdm = ">=4.67.1,<5"
langchain-text-splitters = ">=1.0.0,<2"
sentence-transformers = ">=5.1.2,<6"

[pypi-dependencies]
mcp = { version = ">=1.20.0, <2", extras = ["cli"] }
