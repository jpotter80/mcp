{"chunk_id": "dev-sqllogictest-multiple_connections-000", "document_id": "dev-sqllogictest-multiple_connections", "content": "For tests whose purpose is to verify that the transactional management or versioning of data works correctly, it is generally necessary to use multiple connections. For example, if we want to verify that the creation of tables is correctly transactional, we might want to start a transaction and create a table in `con1`, then fire a query in `con2` that checks that the table is not accessible yet until committed.\n\nWe can use multiple connections in the sqllogictests using `connection labels`. The connection label can be optionally appended to any `statement` or `query`. All queries with the same connection label will be executed in the same connection. A test that would verify the above property would look as follows:\n\n```sql\nstatement ok con1\nBEGIN TRANSACTION\n\nstatement ok con1\nCREATE TABLE integers (i INTEGER);\n\nstatement error con2\nSELECT * FROM integers;\n```", "position": 0, "token_count": 186, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "dev-sqllogictest-multiple_connections-000", "document_id": "dev-sqllogictest-multiple_connections", "position": 0, "token_count": 186, "has_code": true, "overlap_with_previous": false, "section_hierarchy": [], "file_path": "dev/sqllogictest/multiple_connections.md", "url": "/dev/sqllogictest/multiple_connections", "title": "Multiple Connections", "category": null, "tags": [], "section_url": "/dev/sqllogictest/multiple_connections"}}
{"chunk_id": "dev-sqllogictest-multiple_connections-001", "document_id": "dev-sqllogictest-multiple_connections", "content": "## Concurrent Connections\n\nUsing connection modifiers on the statement and queries will result in testing of multiple connections, but all the queries will still be run *sequentially* on a single thread. If we want to run code from multiple connections *concurrently* over multiple threads, we can use the `concurrentloop` construct. The queries in `concurrentloop` will be run concurrently on separate threads at the same time.\n\n```sql\nconcurrentloop i 0 10\n\nstatement ok\nCREATE TEMP TABLE t2 AS (SELECT 1);\n\nstatement ok\nINSERT INTO t2 VALUES (42);\n\nstatement ok\nDELETE FROM t2\n\nendloop", "position": 1, "token_count": 135, "has_code": true, "section_hierarchy": ["Concurrent Connections"], "metadata": {"chunk_id": "dev-sqllogictest-multiple_connections-001", "document_id": "dev-sqllogictest-multiple_connections", "position": 1, "token_count": 135, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Concurrent Connections"], "file_path": "dev/sqllogictest/multiple_connections.md", "url": "/dev/sqllogictest/multiple_connections", "title": "Multiple Connections", "category": null, "tags": [], "section_url": "/dev/sqllogictest/multiple_connections#concurrent-connections"}}
{"chunk_id": "dev-sqllogictest-multiple_connections-002", "document_id": "dev-sqllogictest-multiple_connections", "content": "```\n\nOne caveat with `concurrentloop` is that results are often unpredictable â€“ as multiple clients can hammer the database at the same time we might end up with (expected) transaction conflicts. `statement maybe` can be used to deal with these situations. `statement maybe` essentially accepts both a success, and a failure with a specific error message.\n\n```sql\nconcurrentloop i 1 10\n\nstatement maybe\nCREATE OR REPLACE TABLE t2 AS (SELECT -54124033386577348004002656426531535114 FROM t2 LIMIT 70%);\n----\nwrite-write conflict\n\nendloop\n```", "position": 2, "token_count": 139, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "dev-sqllogictest-multiple_connections-002", "document_id": "dev-sqllogictest-multiple_connections", "position": 2, "token_count": 139, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "dev/sqllogictest/multiple_connections.md", "url": "/dev/sqllogictest/multiple_connections", "title": "Multiple Connections", "category": null, "tags": [], "section_url": "/dev/sqllogictest/multiple_connections"}}
