{"chunk_id": "sql-statements-create_macro-000", "document_id": "sql-statements-create_macro", "content": "The `CREATE MACRO` statement can create a scalar or table macro (function) in the catalog.\n\nFor a scalar macro, `CREATE MACRO` is followed by the name of the macro, and optionally parameters within a set of parentheses. The keyword `AS` is next, followed by the text of the macro. By design, a scalar macro may only return a single value.\nFor a table macro, the syntax is similar to a scalar macro except `AS` is replaced with `AS TABLE`. A table macro may return a table of arbitrary size and shape.\n\n> If a `MACRO` is temporary, it is only usable within the same database connection and is deleted when the connection is closed.", "position": 0, "token_count": 149, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "sql-statements-create_macro-000", "document_id": "sql-statements-create_macro", "position": 0, "token_count": 149, "has_code": false, "overlap_with_previous": false, "section_hierarchy": [], "file_path": "sql/statements/create_macro.md", "url": "/sql/statements/create_macro", "title": "CREATE MACRO Statement", "category": null, "tags": [], "section_url": "/sql/statements/create_macro"}}
{"chunk_id": "sql-statements-create_macro-001", "document_id": "sql-statements-create_macro", "content": "## Examples", "position": 1, "token_count": 5, "has_code": false, "section_hierarchy": ["Examples"], "metadata": {"chunk_id": "sql-statements-create_macro-001", "document_id": "sql-statements-create_macro", "position": 1, "token_count": 5, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Examples"], "file_path": "sql/statements/create_macro.md", "url": "/sql/statements/create_macro", "title": "CREATE MACRO Statement", "category": null, "tags": [], "section_url": "/sql/statements/create_macro#examples"}}
{"chunk_id": "sql-statements-create_macro-002", "document_id": "sql-statements-create_macro", "content": "### Scalar Macros\n\nCreate a macro that adds two expressions (`a` and `b`):\n\n```sql\nCREATE MACRO add(a, b) AS a + b;\n```\n\nCreate a macro, replacing possible existing definitions:\n\n```sql\nCREATE OR REPLACE MACRO add(a, b) AS a + b;\n```\n\nCreate a macro if it does not already exist, else do nothing:\n\n```sql\nCREATE MACRO IF NOT EXISTS add(a, b) AS a + b;\n```\n\nCreate a macro for a `CASE` expression:\n\n```sql\nCREATE MACRO ifelse(a, b, c) AS CASE WHEN a THEN b ELSE c END;\n```\n\nCreate a macro that does a subquery:\n\n```sql\nCREATE MACRO one() AS (SELECT 1);\n```\n\nMacros are schema-dependent, and have an alias, `FUNCTION`:\n\n```sql\nCREATE FUNCTION main.my_avg(x) AS sum(x) / count(x);", "position": 2, "token_count": 224, "has_code": true, "section_hierarchy": ["Scalar Macros"], "metadata": {"chunk_id": "sql-statements-create_macro-002", "document_id": "sql-statements-create_macro", "position": 2, "token_count": 224, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Scalar Macros"], "file_path": "sql/statements/create_macro.md", "url": "/sql/statements/create_macro", "title": "CREATE MACRO Statement", "category": null, "tags": [], "section_url": "/sql/statements/create_macro#scalar-macros"}}
{"chunk_id": "sql-statements-create_macro-003", "document_id": "sql-statements-create_macro", "content": "```\n\nMacros are schema-dependent, and have an alias, `FUNCTION`:\n\n```sql\nCREATE FUNCTION main.my_avg(x) AS sum(x) / count(x);\n```\n\nCreate a macro with a default parameter:\n\n```sql\nCREATE MACRO add_default(a, b := 5) AS a + b;\n```\n\nCreate a macro `arr_append` (with a functionality equivalent to `array_append`):\n\n```sql\nCREATE MACRO arr_append(l, e) AS list_concat(l, list_value(e));\n```\n\nCreate a macro with a typed parameter:\n\n```sql\nCREATE MACRO is_maximal(a INTEGER) AS a = 2^31 - 1;\n```", "position": 3, "token_count": 176, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-statements-create_macro-003", "document_id": "sql-statements-create_macro", "position": 3, "token_count": 176, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/statements/create_macro.md", "url": "/sql/statements/create_macro", "title": "CREATE MACRO Statement", "category": null, "tags": [], "section_url": "/sql/statements/create_macro"}}
{"chunk_id": "sql-statements-create_macro-004", "document_id": "sql-statements-create_macro", "content": "### Table Macros\n\nCreate a table macro without parameters:\n\n```sql\nCREATE MACRO static_table() AS TABLE\n SELECT 'Hello' AS column1, 'World' AS column2;\n```\n\nCreate a table macro with parameters (that can be of any type):\n\n```sql\nCREATE MACRO dynamic_table(col1_value, col2_value) AS TABLE\n SELECT col1_value AS column1, col2_value AS column2;\n```\n\nCreate a table macro that returns multiple rows. It will be replaced if it already exists, and it is temporary (will be automatically deleted when the connection ends):\n\n```sql\nCREATE OR REPLACE TEMP MACRO dynamic_table(col1_value, col2_value) AS TABLE\n SELECT col1_value AS column1, col2_value AS column2\n UNION ALL\n SELECT 'Hello' AS col1_value, 456 AS col2_value;\n```\n\nPass an argument as a list:\n\n```sql\nCREATE MACRO get_users(i) AS TABLE\n SELECT * FROM users WHERE uid IN (SELECT unnest(i));", "position": 4, "token_count": 240, "has_code": true, "section_hierarchy": ["Table Macros"], "metadata": {"chunk_id": "sql-statements-create_macro-004", "document_id": "sql-statements-create_macro", "position": 4, "token_count": 240, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Table Macros"], "file_path": "sql/statements/create_macro.md", "url": "/sql/statements/create_macro", "title": "CREATE MACRO Statement", "category": null, "tags": [], "section_url": "/sql/statements/create_macro#table-macros"}}
{"chunk_id": "sql-statements-create_macro-005", "document_id": "sql-statements-create_macro", "content": "```\n\nPass an argument as a list:\n\n```sql\nCREATE MACRO get_users(i) AS TABLE\n SELECT * FROM users WHERE uid IN (SELECT unnest(i));\n```\n\nAn example for how to use the `get_users` table macro is the following:\n\n```sql\nCREATE TABLE users AS\n SELECT *\n FROM (VALUES (1, 'Ada'), (2, 'Bob'), (3, 'Carl'), (4, 'Dan'), (5, 'Eve')) t(uid, name);\nSELECT * FROM get_users([1, 5]);", "position": 5, "token_count": 140, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-statements-create_macro-005", "document_id": "sql-statements-create_macro", "position": 5, "token_count": 140, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/statements/create_macro.md", "url": "/sql/statements/create_macro", "title": "CREATE MACRO Statement", "category": null, "tags": [], "section_url": "/sql/statements/create_macro"}}
{"chunk_id": "sql-statements-create_macro-006", "document_id": "sql-statements-create_macro", "content": "```\n\nTo define macros on arbitrary tables, use the [`query_table` function]({% link docs/stable/guides/sql_features/query_and_query_table_functions.md %}). For example, the following macro computes a column-wise checksum on a table:\n\n```sql\nCREATE MACRO checksum(tbl) AS TABLE\n SELECT bit_xor(md5_number(COLUMNS(*)::VARCHAR))\n FROM query_table(tbl);\n\nCREATE TABLE tbl AS SELECT unnest([42, 43]) AS x, 100 AS y;\nSELECT * FROM checksum('tbl');\n```", "position": 6, "token_count": 154, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-statements-create_macro-006", "document_id": "sql-statements-create_macro", "position": 6, "token_count": 154, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/statements/create_macro.md", "url": "/sql/statements/create_macro", "title": "CREATE MACRO Statement", "category": null, "tags": [], "section_url": "/sql/statements/create_macro"}}
{"chunk_id": "sql-statements-create_macro-007", "document_id": "sql-statements-create_macro", "content": "## Overloading\n\nIt is possible to overload a macro based on the types or the number of its parameters; this works for both scalar and table macros.\n\nBy providing overloads we can have both `add_x(a, b)` and `add_x(a, b, c)` with different function bodies.\n\n```sql\nCREATE MACRO add_x\n (a, b) AS a + b,\n (a, b, c) AS a + b + c;\n```\n\n```sql\nSELECT\n add_x(21, 42) AS two_args,\n add_x(21, 42, 21) AS three_args;\n```\n\n| two_args | three_args |\n|----------|------------|\n| 63 | 84 |\n\n```sql\nCREATE OR REPLACE MACRO is_maximal\n (a TINYINT) AS a = 2^7 - 1,\n (a INT) AS a = 2^31 - 1;", "position": 7, "token_count": 226, "has_code": true, "section_hierarchy": ["Overloading"], "metadata": {"chunk_id": "sql-statements-create_macro-007", "document_id": "sql-statements-create_macro", "position": 7, "token_count": 226, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Overloading"], "file_path": "sql/statements/create_macro.md", "url": "/sql/statements/create_macro", "title": "CREATE MACRO Statement", "category": null, "tags": [], "section_url": "/sql/statements/create_macro#overloading"}}
{"chunk_id": "sql-statements-create_macro-008", "document_id": "sql-statements-create_macro", "content": "```\n\n```sql\nSELECT\n is_maximal(127::TINYINT) AS tiny,\n is_maximal(127) AS regular;\n```\n\n| tiny | regular |\n|----------|------------|\n| true | false |", "position": 8, "token_count": 70, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-statements-create_macro-008", "document_id": "sql-statements-create_macro", "position": 8, "token_count": 70, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/statements/create_macro.md", "url": "/sql/statements/create_macro", "title": "CREATE MACRO Statement", "category": null, "tags": [], "section_url": "/sql/statements/create_macro"}}
{"chunk_id": "sql-statements-create_macro-009", "document_id": "sql-statements-create_macro", "content": "## Syntax\n\nMacros allow you to create shortcuts for combinations of expressions.\n\n```sql\nCREATE MACRO add(a) AS a + b;\n```\n\n```console\nBinder Error:\nReferenced column \"b\" not found in FROM clause!\n```\n\nThis works:\n\n```sql\nCREATE MACRO add(a, b) AS a + b;\n```\n\nUsage example:\n\n```sql\nSELECT add(1, 2) AS x;\n```\n\n| x |\n|--:|\n| 3 |\n\nHowever, this fails:\n\n```sql\nSELECT add('hello', 3);\n```\n\n```console\nBinder Error:\nCould not choose a best candidate function for the function call \"add(STRING_LITERAL, INTEGER_LITERAL)\". In order to select one, please add explicit type casts.\n\tCandidate functions:\n\tadd(DATE, INTEGER) -> DATE\n\tadd(INTEGER, INTEGER) -> INTEGER", "position": 9, "token_count": 200, "has_code": true, "section_hierarchy": ["Syntax"], "metadata": {"chunk_id": "sql-statements-create_macro-009", "document_id": "sql-statements-create_macro", "position": 9, "token_count": 200, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Syntax"], "file_path": "sql/statements/create_macro.md", "url": "/sql/statements/create_macro", "title": "CREATE MACRO Statement", "category": null, "tags": [], "section_url": "/sql/statements/create_macro#syntax"}}
{"chunk_id": "sql-statements-create_macro-010", "document_id": "sql-statements-create_macro", "content": "```\n\nMacros can have default parameters.\n\n`b` is a default parameter:\n\n```sql\nCREATE MACRO add_default(a, b := 5) AS a + b;\n```\n\nThe following will result in 42:\n\n```sql\nSELECT add_default(37);\n```\n\nThe order of named parameters does not matter:\n\n```sql\nCREATE MACRO triple_add(a, b := 5, c := 10) AS a + b + c;\n```\n\n```sql\nSELECT triple_add(40, c := 1, b := 1) AS x;\n```\n\n| x |\n|---:|\n| 42 |\n\nWhen macros are used, they are expanded (i.e., replaced with the original expression), and the parameters within the expanded expression are replaced with the supplied arguments. Step by step:\n\nThe `add` macro we defined above is used in a query:\n\n```sql\nSELECT add(40, 2) AS x;", "position": 10, "token_count": 215, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-statements-create_macro-010", "document_id": "sql-statements-create_macro", "position": 10, "token_count": 215, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/statements/create_macro.md", "url": "/sql/statements/create_macro", "title": "CREATE MACRO Statement", "category": null, "tags": [], "section_url": "/sql/statements/create_macro"}}
{"chunk_id": "sql-statements-create_macro-011", "document_id": "sql-statements-create_macro", "content": "```\n\nInternally, `add` is replaced with its definition of `a + b`:\n\n```sql\nSELECT a + b AS x;\n```\n\nThen, the parameters are replaced by the supplied arguments:\n\n```sql\nSELECT 40 + 2 AS x;\n```", "position": 11, "token_count": 61, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-statements-create_macro-011", "document_id": "sql-statements-create_macro", "position": 11, "token_count": 61, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/statements/create_macro.md", "url": "/sql/statements/create_macro", "title": "CREATE MACRO Statement", "category": null, "tags": [], "section_url": "/sql/statements/create_macro"}}
{"chunk_id": "sql-statements-create_macro-012", "document_id": "sql-statements-create_macro", "content": "## Limitations\n\n### Using Subquery Macros\n\nTable macros as well as scalar macros defined using scalar subqueries cannot be used in the arguments of table functions. DuckDB will return the following error:\n\n```console\nBinder Error:\nTable function cannot contain subqueries\n```\n\n### Overloads\n\nOverloads for macro functions have to be set at creation, it is not possible to define a macro by the same name twice without first removing the first definition.\n\n### Recursive Functions\n\nDefining recursive functions is not supported.\nFor example, the following macro – supposed to compute the *n*th number of the Fibonacci sequence – fails:\n\n```sql\nCREATE OR REPLACE FUNCTION fibo(n) AS (SELECT 1);\nCREATE OR REPLACE FUNCTION fibo(n) AS (\n CASE\n WHEN n <= 1 THEN 1\n ELSE fibo(n - 1)\n END\n);\nSELECT fibo(3);\n```\n\n```console\nBinder Error:\nMax expression depth limit of 1000 exceeded. Use \"SET max_expression_depth TO x\" to increase the maximum expression depth.\n```", "position": 12, "token_count": 244, "has_code": true, "section_hierarchy": ["Recursive Functions"], "metadata": {"chunk_id": "sql-statements-create_macro-012", "document_id": "sql-statements-create_macro", "position": 12, "token_count": 244, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Recursive Functions"], "file_path": "sql/statements/create_macro.md", "url": "/sql/statements/create_macro", "title": "CREATE MACRO Statement", "category": null, "tags": [], "section_url": "/sql/statements/create_macro#recursive-functions"}}
{"chunk_id": "sql-statements-create_macro-013", "document_id": "sql-statements-create_macro", "content": "### Function Chaining on the First Function Does Not Work\n\nMacros do not support the dot operator for function chaining on the first function.\nTo illustrate this, see an example with the `lower` function, which works:\n\n```sql\nCREATE OR REPLACE MACRO low(s) AS lower(s);\nSELECT low('AA');\n```\n\nHowever, rewriting `lower(s)` to use function chaining does not work:\n\n```sql\nCREATE OR REPLACE MACRO low(s) AS s.lower();\nSELECT low('AA');\n```\n\n```console\nBinder Error:\nReferenced column \"s\" not found in FROM clause!\n```", "position": 13, "token_count": 149, "has_code": true, "section_hierarchy": ["Function Chaining on the First Function Does Not Work"], "metadata": {"chunk_id": "sql-statements-create_macro-013", "document_id": "sql-statements-create_macro", "position": 13, "token_count": 149, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Function Chaining on the First Function Does Not Work"], "file_path": "sql/statements/create_macro.md", "url": "/sql/statements/create_macro", "title": "CREATE MACRO Statement", "category": null, "tags": [], "section_url": "/sql/statements/create_macro#function-chaining-on-the-first-function-does-not-work"}}
