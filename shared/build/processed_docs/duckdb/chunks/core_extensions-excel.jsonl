{"chunk_id": "core_extensions-excel-000", "document_id": "core_extensions-excel", "content": "The `excel` extension provides functions to format numbers per Excel's formatting rules by wrapping the [i18npool library](https://www.openoffice.org/l10n/i18n_framework/index.html), but as of DuckDB 1.2 also provides functionality to read and write Excel (`.xlsx`) files. However, `.xls` files are not supported.\n\nPreviously, reading and writing Excel files was handled through the [`spatial` extension]({% link docs/stable/core_extensions/spatial/overview.md %}), which coincidentally included support for XLSX files through one of its dependencies, but this capability may be removed from the `spatial` extension. Additionally, the `excel` extension is more efficient and provides more control over the import/export process.", "position": 0, "token_count": 184, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-excel-000", "document_id": "core_extensions-excel", "position": 0, "token_count": 184, "has_code": false, "overlap_with_previous": false, "section_hierarchy": [], "file_path": "core_extensions/excel.md", "url": "/core_extensions/excel", "title": "Excel Extension", "category": null, "tags": [], "section_url": "/core_extensions/excel"}}
{"chunk_id": "core_extensions-excel-001", "document_id": "core_extensions-excel", "content": "> Tip If the `excel` extension is insufficient for your use case, try using the [`spatial` extension]({% link docs/stable/core_extensions/spatial/overview.md %}). See the [Excel Import]({% link docs/stable/guides/file_formats/excel_import.md %}) and [Excel Export]({% link docs/stable/guides/file_formats/excel_export.md %}) pages for instructions. However, please be aware that these features may be deprecated in the future.", "position": 1, "token_count": 126, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-excel-001", "document_id": "core_extensions-excel", "position": 1, "token_count": 126, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/excel.md", "url": "/core_extensions/excel", "title": "Excel Extension", "category": null, "tags": [], "section_url": "/core_extensions/excel"}}
{"chunk_id": "core_extensions-excel-002", "document_id": "core_extensions-excel", "content": "## Installing and Loading\n\nThe `excel` extension will be transparently [autoloaded]({% link docs/stable/extensions/overview.md %}#autoloading-extensions) on first use from the official extension repository.\nIf you would like to install and load it manually, run:\n\n```sql\nINSTALL excel;\nLOAD excel;\n```\n\n## Excel Scalar Functions\n\n| Function | Description |\n| :---------------------------------- | :------------------------------------------------------------------- |\n| `excel_text(number, format_string)` | Format the given `number` per the rules given in the `format_string` |\n| `text(number, format_string)` | Alias for `excel_text` |", "position": 2, "token_count": 246, "has_code": true, "section_hierarchy": ["Excel Scalar Functions"], "metadata": {"chunk_id": "core_extensions-excel-002", "document_id": "core_extensions-excel", "position": 2, "token_count": 246, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Excel Scalar Functions"], "file_path": "core_extensions/excel.md", "url": "/core_extensions/excel", "title": "Excel Extension", "category": null, "tags": [], "section_url": "/core_extensions/excel#excel-scalar-functions"}}
{"chunk_id": "core_extensions-excel-003", "document_id": "core_extensions-excel", "content": "## Examples\n\n```sql\nSELECT excel_text(1_234_567.897, 'h:mm AM/PM') AS timestamp;\n```\n\n| timestamp |\n| --------- |\n| 9:31 PM |\n\n```sql\nSELECT excel_text(1_234_567.897, 'h AM/PM') AS timestamp;\n```\n\n| timestamp |\n| --------- |\n| 9 PM |", "position": 3, "token_count": 117, "has_code": true, "section_hierarchy": ["Examples"], "metadata": {"chunk_id": "core_extensions-excel-003", "document_id": "core_extensions-excel", "position": 3, "token_count": 117, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Examples"], "file_path": "core_extensions/excel.md", "url": "/core_extensions/excel", "title": "Excel Extension", "category": null, "tags": [], "section_url": "/core_extensions/excel#examples"}}
{"chunk_id": "core_extensions-excel-004", "document_id": "core_extensions-excel", "content": "## Reading XLSX Files\n\nReading a `.xlsx` file is as simple as just `SELECT`ing from it immediately, e.g.:\n\n```sql\nSELECT *\nFROM 'test.xlsx';", "position": 4, "token_count": 51, "has_code": true, "section_hierarchy": ["Reading XLSX Files"], "metadata": {"chunk_id": "core_extensions-excel-004", "document_id": "core_extensions-excel", "position": 4, "token_count": 51, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Reading XLSX Files"], "file_path": "core_extensions/excel.md", "url": "/core_extensions/excel", "title": "Excel Extension", "category": null, "tags": [], "section_url": "/core_extensions/excel#reading-xlsx-files"}}
{"chunk_id": "core_extensions-excel-005", "document_id": "core_extensions-excel", "content": "```\n\n| a | b |\n| --: | --: |\n| 1.0 | 2.0 |\n| 3.0 | 4.0 |\n\nHowever, if you want to set additional options to control the import process, you can use the `read_xlsx` function instead. The following named parameters are supported.", "position": 5, "token_count": 73, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-excel-005", "document_id": "core_extensions-excel", "position": 5, "token_count": 73, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/excel.md", "url": "/core_extensions/excel", "title": "Excel Extension", "category": null, "tags": [], "section_url": "/core_extensions/excel"}}
{"chunk_id": "core_extensions-excel-006", "document_id": "core_extensions-excel", "content": "| Option | Type | Default | Description |", "position": 6, "token_count": 11, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-excel-006", "document_id": "core_extensions-excel", "position": 6, "token_count": 11, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/excel.md", "url": "/core_extensions/excel", "title": "Excel Extension", "category": null, "tags": [], "section_url": "/core_extensions/excel"}}
{"chunk_id": "core_extensions-excel-007", "document_id": "core_extensions-excel", "content": "| ------------------ | --------- | ------------------------ |", "position": 7, "token_count": 57, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-excel-007", "document_id": "core_extensions-excel", "position": 7, "token_count": 57, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/excel.md", "url": "/core_extensions/excel", "title": "Excel Extension", "category": null, "tags": [], "section_url": "/core_extensions/excel"}}
{"chunk_id": "core_extensions-excel-008", "document_id": "core_extensions-excel", "content": "--------------------------------------------------", "position": 8, "token_count": 52, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-excel-008", "document_id": "core_extensions-excel", "position": 8, "token_count": 52, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/excel.md", "url": "/core_extensions/excel", "title": "Excel Extension", "category": null, "tags": [], "section_url": "/core_extensions/excel"}}
{"chunk_id": "core_extensions-excel-009", "document_id": "core_extensions-excel", "content": "---------------------------------------------------", "position": 9, "token_count": 53, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-excel-009", "document_id": "core_extensions-excel", "position": 9, "token_count": 53, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/excel.md", "url": "/core_extensions/excel", "title": "Excel Extension", "category": null, "tags": [], "section_url": "/core_extensions/excel"}}
{"chunk_id": "core_extensions-excel-010", "document_id": "core_extensions-excel", "content": "---------------------------------------------------", "position": 10, "token_count": 53, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-excel-010", "document_id": "core_extensions-excel", "position": 10, "token_count": 53, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/excel.md", "url": "/core_extensions/excel", "title": "Excel Extension", "category": null, "tags": [], "section_url": "/core_extensions/excel"}}
{"chunk_id": "core_extensions-excel-011", "document_id": "core_extensions-excel", "content": "---------------------------------------------------", "position": 11, "token_count": 53, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-excel-011", "document_id": "core_extensions-excel", "position": 11, "token_count": 53, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/excel.md", "url": "/core_extensions/excel", "title": "Excel Extension", "category": null, "tags": [], "section_url": "/core_extensions/excel"}}
{"chunk_id": "core_extensions-excel-012", "document_id": "core_extensions-excel", "content": "---------------------------------------------------", "position": 12, "token_count": 53, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-excel-012", "document_id": "core_extensions-excel", "position": 12, "token_count": 53, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/excel.md", "url": "/core_extensions/excel", "title": "Excel Extension", "category": null, "tags": [], "section_url": "/core_extensions/excel"}}
{"chunk_id": "core_extensions-excel-013", "document_id": "core_extensions-excel", "content": "---------------------------------------------------", "position": 13, "token_count": 53, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-excel-013", "document_id": "core_extensions-excel", "position": 13, "token_count": 53, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/excel.md", "url": "/core_extensions/excel", "title": "Excel Extension", "category": null, "tags": [], "section_url": "/core_extensions/excel"}}
{"chunk_id": "core_extensions-excel-014", "document_id": "core_extensions-excel", "content": "------------------------------------------------", "position": 14, "token_count": 50, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-excel-014", "document_id": "core_extensions-excel", "position": 14, "token_count": 50, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/excel.md", "url": "/core_extensions/excel", "title": "Excel Extension", "category": null, "tags": [], "section_url": "/core_extensions/excel"}}
{"chunk_id": "core_extensions-excel-015", "document_id": "core_extensions-excel", "content": "|", "position": 15, "token_count": 3, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-excel-015", "document_id": "core_extensions-excel", "position": 15, "token_count": 3, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/excel.md", "url": "/core_extensions/excel", "title": "Excel Extension", "category": null, "tags": [], "section_url": "/core_extensions/excel"}}
{"chunk_id": "core_extensions-excel-016", "document_id": "core_extensions-excel", "content": "| `header` | `BOOLEAN` | _automatically inferred_ | Whether to treat the first row as containing the names of the resulting columns. |\n| `sheet` | `VARCHAR` | _automatically inferred_ | The name of the sheet in the xlsx file to read. Default is the first sheet. |\n| `all_varchar` | `BOOLEAN` | `false` | Whether to read all cells as containing `VARCHAR`s. |\n| `ignore_errors` | `BOOLEAN` | `false` | Whether to ignore errors and silently replace cells that cant be cast to the corresponding inferred column type with `NULL`'s. |\n| `range` | `VARCHAR` | _automatically inferred_ | The range of cells to read, in spreadsheet notation. For example, `A1:B2` reads the cells from A1 to B2. If not specified the resulting range will be inferred as rectangular region of cells between the first row of consecutive non-empty cells and the first empty row spanning the same columns. |", "position": 16, "token_count": 238, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-excel-016", "document_id": "core_extensions-excel", "position": 16, "token_count": 238, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/excel.md", "url": "/core_extensions/excel", "title": "Excel Extension", "category": null, "tags": [], "section_url": "/core_extensions/excel"}}
{"chunk_id": "core_extensions-excel-017", "document_id": "core_extensions-excel", "content": "| `stop_at_empty` | `BOOLEAN` | _automatically inferred_ | Whether to stop reading the file when an empty row is encountered. If an explicit `range` option is provided, this is `false` by default, otherwise `true`. |\n| `empty_as_varchar` | `BOOLEAN` | `false` | Whether to treat empty cells as `VARCHAR` instead of `DOUBLE` when trying to automatically infer column types. |", "position": 17, "token_count": 106, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-excel-017", "document_id": "core_extensions-excel", "position": 17, "token_count": 106, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/excel.md", "url": "/core_extensions/excel", "title": "Excel Extension", "category": null, "tags": [], "section_url": "/core_extensions/excel"}}
{"chunk_id": "core_extensions-excel-018", "document_id": "core_extensions-excel", "content": "```sql\nSELECT *\nFROM read_xlsx('test.xlsx', header = true);", "position": 18, "token_count": 28, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-excel-018", "document_id": "core_extensions-excel", "position": 18, "token_count": 28, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/excel.md", "url": "/core_extensions/excel", "title": "Excel Extension", "category": null, "tags": [], "section_url": "/core_extensions/excel"}}
{"chunk_id": "core_extensions-excel-019", "document_id": "core_extensions-excel", "content": "```\n\n| a | b |\n| --: | --: |\n| 1.0 | 2.0 |\n| 3.0 | 4.0 |\n\nAlternatively, the `COPY` statement with the `XLSX` format option can be used to import an Excel file into an existing table, in which case the types of the columns in the target table will be used to coerce the types of the cells in the Excel file.\n\n```sql\nCREATE TABLE test (a DOUBLE, b DOUBLE);\nCOPY test FROM 'test.xlsx' WITH (FORMAT xlsx, HEADER);\nSELECT * FROM test;\n```", "position": 19, "token_count": 137, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-excel-019", "document_id": "core_extensions-excel", "position": 19, "token_count": 137, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/excel.md", "url": "/core_extensions/excel", "title": "Excel Extension", "category": null, "tags": [], "section_url": "/core_extensions/excel"}}
{"chunk_id": "core_extensions-excel-020", "document_id": "core_extensions-excel", "content": "### Type and Range Inference\n\nBecause Excel itself only really stores numbers or strings in cells, and does not enforce that all cells in a column are of the same type, the `excel` extension has to do some guesswork to \"infer\" and decide the types of the columns when importing an Excel sheet. While almost all columns are inferred as either `DOUBLE` or `VARCHAR`, there are some caveats:\n\n* `TIMESTAMP`, `TIME`, `DATE` and `BOOLEAN` types are inferred when possible based on the _format_ applied to the cell.\n* Text cells containing `TRUE` and `FALSE` are inferred as `BOOLEAN`.\n* Empty cells are considered to be `DOUBLE` by default, unless the `empty_as_varchar` option is set to `true`, in which case they are typed as `VARCHAR`.\n\nIf the `all_varchar` option is set to `true`, none of the above applies and all cells are read as `VARCHAR`.", "position": 20, "token_count": 230, "has_code": false, "section_hierarchy": ["Type and Range Inference"], "metadata": {"chunk_id": "core_extensions-excel-020", "document_id": "core_extensions-excel", "position": 20, "token_count": 230, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Type and Range Inference"], "file_path": "core_extensions/excel.md", "url": "/core_extensions/excel", "title": "Excel Extension", "category": null, "tags": [], "section_url": "/core_extensions/excel#type-and-range-inference"}}
{"chunk_id": "core_extensions-excel-021", "document_id": "core_extensions-excel", "content": "If the `all_varchar` option is set to `true`, none of the above applies and all cells are read as `VARCHAR`.\n\nWhen no types are specified explicitly, (e.g., when using the `read_xlsx` function instead of `COPY TO ... FROM '⟨file⟩.xlsx'`{:.language-sql .highlight})\nthe types of the resulting columns are inferred based on the first \"data\" row in the sheet, that is:\n\n* If no explicit range is given\n * The first row after the header if a header is found or forced by the `header` option\n * The first non-empty row in the sheet if no header is found or forced\n* If an explicit range is given\n * The second row of the range if a header is found in the first row or forced by the `header` option\n * The first row of the range if no header is found or forced", "position": 21, "token_count": 203, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-excel-021", "document_id": "core_extensions-excel", "position": 21, "token_count": 203, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/excel.md", "url": "/core_extensions/excel", "title": "Excel Extension", "category": null, "tags": [], "section_url": "/core_extensions/excel"}}
{"chunk_id": "core_extensions-excel-022", "document_id": "core_extensions-excel", "content": "This can sometimes lead to issues if the first \"data row\" is not representative of the rest of the sheet (e.g., it contains empty cells) in which case the `ignore_errors` or `empty_as_varchar` options can be used to work around this.\n\nHowever, when the `COPY TO ... FROM '⟨file⟩.xlsx'` syntax is used, no type inference is done and the types of the resulting columns are determined by the types of the columns in the table being copied to. All cells will simply be converted by casting from `DOUBLE` or `VARCHAR` to the target column type.", "position": 22, "token_count": 139, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-excel-022", "document_id": "core_extensions-excel", "position": 22, "token_count": 139, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/excel.md", "url": "/core_extensions/excel", "title": "Excel Extension", "category": null, "tags": [], "section_url": "/core_extensions/excel"}}
{"chunk_id": "core_extensions-excel-023", "document_id": "core_extensions-excel", "content": "## Writing XLSX Files\n\nWriting `.xlsx` files is supported using the `COPY` statement with `XLSX` given as the format. The following additional parameters are supported.", "position": 23, "token_count": 43, "has_code": false, "section_hierarchy": ["Writing XLSX Files"], "metadata": {"chunk_id": "core_extensions-excel-023", "document_id": "core_extensions-excel", "position": 23, "token_count": 43, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Writing XLSX Files"], "file_path": "core_extensions/excel.md", "url": "/core_extensions/excel", "title": "Excel Extension", "category": null, "tags": [], "section_url": "/core_extensions/excel#writing-xlsx-files"}}
{"chunk_id": "core_extensions-excel-024", "document_id": "core_extensions-excel", "content": "| Option | Type | Default | Description |\n| ----------------- | --------- | --------- | ------------------------------------------------------------------------------------ |\n| `header` | `BOOLEAN` | `false` | Whether to write the column names as the first row in the sheet |\n| `sheet` | `VARCHAR` | `Sheet1` | The name of the sheet in the xlsx file to write. |\n| `sheet_row_limit` | `INTEGER` | `1048576` | The maximum number of rows in a sheet. An error is thrown if this limit is exceeded. |", "position": 24, "token_count": 234, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-excel-024", "document_id": "core_extensions-excel", "position": 24, "token_count": 234, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/excel.md", "url": "/core_extensions/excel", "title": "Excel Extension", "category": null, "tags": [], "section_url": "/core_extensions/excel"}}
{"chunk_id": "core_extensions-excel-025", "document_id": "core_extensions-excel", "content": "> Warning Many tools only support a maximum of 1,048,576 rows in a sheet, so increasing the `sheet_row_limit` may render the resulting file unreadable by other software.\n\nThese are passed as options to the `COPY` statement after the `FORMAT`, e.g.:\n\n```sql\nCREATE TABLE test AS\n SELECT *\n FROM (VALUES (1, 2), (3, 4)) AS t(a, b);\nCOPY test TO 'test.xlsx' WITH (FORMAT xlsx, HEADER true);", "position": 25, "token_count": 121, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-excel-025", "document_id": "core_extensions-excel", "position": 25, "token_count": 121, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/excel.md", "url": "/core_extensions/excel", "title": "Excel Extension", "category": null, "tags": [], "section_url": "/core_extensions/excel"}}
{"chunk_id": "core_extensions-excel-026", "document_id": "core_extensions-excel", "content": "```", "position": 26, "token_count": 5, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-excel-026", "document_id": "core_extensions-excel", "position": 26, "token_count": 5, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/excel.md", "url": "/core_extensions/excel", "title": "Excel Extension", "category": null, "tags": [], "section_url": "/core_extensions/excel"}}
{"chunk_id": "core_extensions-excel-027", "document_id": "core_extensions-excel", "content": "### Type Conversions\n\nBecause XLSX files only really support storing numbers or strings – the equivalent of `VARCHAR` and `DOUBLE`, the following type conversions are applied when writing XLSX files.\n\n* Numeric types are cast to `DOUBLE` when writing to an XLSX file.\n* Temporal types (`TIMESTAMP`, `DATE`, `TIME`, etc.) are converted to excel \"serial\" numbers, that is the number of days since 1900-01-01 for dates and the fraction of a day for times. These are then styled with a \"number format\" so that they appear as dates or times when opened in Excel.\n* `TIMESTAMP_TZ` and `TIME_TZ` are cast to UTC `TIMESTAMP` and `TIME` respectively, with the timezone information being lost.\n* `BOOLEAN`s are converted to `1` and `0`, with a \"number format\" applied to make them appear as `TRUE` and `FALSE` in Excel.\n* All other types are cast to `VARCHAR` and then written as text cells.", "position": 27, "token_count": 238, "has_code": false, "section_hierarchy": ["Type Conversions"], "metadata": {"chunk_id": "core_extensions-excel-027", "document_id": "core_extensions-excel", "position": 27, "token_count": 238, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Type Conversions"], "file_path": "core_extensions/excel.md", "url": "/core_extensions/excel", "title": "Excel Extension", "category": null, "tags": [], "section_url": "/core_extensions/excel#type-conversions"}}
