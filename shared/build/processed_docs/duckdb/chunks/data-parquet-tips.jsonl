{"chunk_id": "data-parquet-tips-000", "document_id": "data-parquet-tips", "content": "Below is a collection of tips to help when dealing with Parquet files.\n\n## Tips for Reading Parquet Files\n\n### Use `union_by_name` When Loading Files with Different Schemas\n\nThe `union_by_name` option can be used to unify the schema of files that have different or missing columns. For files that do not have certain columns, `NULL` values are filled in:\n\n```sql\nSELECT *\nFROM read_parquet('flights*.parquet', union_by_name = true);\n```", "position": 0, "token_count": 120, "has_code": true, "section_hierarchy": ["Use `union_by_name` When Loading Files with Different Schemas"], "metadata": {"chunk_id": "data-parquet-tips-000", "document_id": "data-parquet-tips", "position": 0, "token_count": 120, "has_code": true, "overlap_with_previous": false, "section_hierarchy": ["Use `union_by_name` When Loading Files with Different Schemas"], "file_path": "data/parquet/tips.md", "url": "/data/parquet/tips", "title": "Parquet Tips", "category": null, "tags": [], "section_url": "/data/parquet/tips#use-unionbyname-when-loading-files-with-different-schemas"}}
{"chunk_id": "data-parquet-tips-001", "document_id": "data-parquet-tips", "content": "## Tips for Writing Parquet Files\n\nUsing a [glob pattern]({% link docs/stable/data/multiple_files/overview.md %}#glob-syntax) upon read or a [Hive partitioning]({% link docs/stable/data/partitioning/hive_partitioning.md %}) structure are good ways to transparently handle multiple files.\n\n### Enabling `PER_THREAD_OUTPUT`\n\nIf the final number of Parquet files is not important, writing one file per thread can significantly improve performance:\n\n```sql\nCOPY\n (FROM generate_series(10_000_000))\n TO 'test.parquet'\n (FORMAT parquet, PER_THREAD_OUTPUT);\n```", "position": 1, "token_count": 161, "has_code": true, "section_hierarchy": ["Enabling `PER_THREAD_OUTPUT`"], "metadata": {"chunk_id": "data-parquet-tips-001", "document_id": "data-parquet-tips", "position": 1, "token_count": 161, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Enabling `PER_THREAD_OUTPUT`"], "file_path": "data/parquet/tips.md", "url": "/data/parquet/tips", "title": "Parquet Tips", "category": null, "tags": [], "section_url": "/data/parquet/tips#enabling-perthreadoutput"}}
{"chunk_id": "data-parquet-tips-002", "document_id": "data-parquet-tips", "content": "### Selecting a `ROW_GROUP_SIZE`\n\nThe `ROW_GROUP_SIZE` parameter specifies the minimum number of rows in a Parquet row group, with a minimum value equal to DuckDB's vector size, 2,048, and a default of 122,880.\nA Parquet row group is a partition of rows, consisting of a column chunk for each column in the dataset.\n\nCompression algorithms are only applied per row group, so the larger the row group size, the more opportunities to compress the data.\nOn the other hand, larger row group sizes mean that each thread keeps more data in memory before flushing when streaming results.\nAnother argument for smaller row group sizes is that DuckDB can read Parquet row groups in parallel even within the same file and uses predicate pushdown to only scan the row groups whose metadata ranges match the `WHERE` clause of the query. However, there is some overhead associated with reading the metadata in each group.", "position": 2, "token_count": 200, "has_code": false, "section_hierarchy": ["Selecting a `ROW_GROUP_SIZE`"], "metadata": {"chunk_id": "data-parquet-tips-002", "document_id": "data-parquet-tips", "position": 2, "token_count": 200, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Selecting a `ROW_GROUP_SIZE`"], "file_path": "data/parquet/tips.md", "url": "/data/parquet/tips", "title": "Parquet Tips", "category": null, "tags": [], "section_url": "/data/parquet/tips#selecting-a-rowgroupsize"}}
{"chunk_id": "data-parquet-tips-003", "document_id": "data-parquet-tips", "content": "A good rule of thumb is to ensure that the number of row groups per file is at least as large as the number of CPU threads used to query that file.\nMore row groups beyond the thread count would improve the speed of highly selective queries, but slow down queries that must scan the whole file like aggregations.\n\nTo write a query to a Parquet file with a different row group size, run:\n\n```sql\nCOPY\n (FROM generate_series(100_000))\n TO 'row-groups.parquet'\n (FORMAT parquet, ROW_GROUP_SIZE 100_000);", "position": 3, "token_count": 125, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "data-parquet-tips-003", "document_id": "data-parquet-tips", "position": 3, "token_count": 125, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "data/parquet/tips.md", "url": "/data/parquet/tips", "title": "Parquet Tips", "category": null, "tags": [], "section_url": "/data/parquet/tips"}}
{"chunk_id": "data-parquet-tips-004", "document_id": "data-parquet-tips", "content": "```", "position": 4, "token_count": 5, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "data-parquet-tips-004", "document_id": "data-parquet-tips", "position": 4, "token_count": 5, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "data/parquet/tips.md", "url": "/data/parquet/tips", "title": "Parquet Tips", "category": null, "tags": [], "section_url": "/data/parquet/tips"}}
{"chunk_id": "data-parquet-tips-005", "document_id": "data-parquet-tips", "content": "### The `ROW_GROUPS_PER_FILE` Option\n\nThe `ROW_GROUPS_PER_FILE` parameter creates a new Parquet file if the current one has a specified number of row groups.\n\n```sql\nCOPY\n (FROM generate_series(100_000))\n TO 'output-directory'\n (FORMAT parquet, ROW_GROUP_SIZE 20_000, ROW_GROUPS_PER_FILE 2);\n```\n\n> If multiple threads are active, the number of row groups in a file may slightly exceed the specified number of row groups to limit the amount of locking – similarly to the behaviour of [`FILE_SIZE_BYTES`](../../sql/statements/copy#copy--to-options).\n> However, if `PER_THREAD_OUTPUT` is set, only one thread writes to each file, and it becomes accurate again.\n\nSee the [Performance Guide on “File Formats”]({% link docs/stable/guides/performance/file_formats.md %}#parquet-file-sizes) for more tips.", "position": 5, "token_count": 231, "has_code": true, "section_hierarchy": ["The `ROW_GROUPS_PER_FILE` Option"], "metadata": {"chunk_id": "data-parquet-tips-005", "document_id": "data-parquet-tips", "position": 5, "token_count": 231, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["The `ROW_GROUPS_PER_FILE` Option"], "file_path": "data/parquet/tips.md", "url": "/data/parquet/tips", "title": "Parquet Tips", "category": null, "tags": [], "section_url": "/data/parquet/tips#the-rowgroupsperfile-option"}}
