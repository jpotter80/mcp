{"chunk_id": "core_extensions-httpfs-s3api_legacy_authentication-000", "document_id": "core_extensions-httpfs-s3api_legacy_authentication", "content": "Prior to version 0.10.0, DuckDB did not have a [Secrets manager]({% link docs/stable/sql/statements/create_secret.md %}). Hence, the configuration of and authentication to S3 endpoints was handled via variables. This page documents the legacy authentication scheme for the S3 API.\n\n> Warning This page describes a legacy method to store secrets as DuckDB settings.\n> This increases the risk of accidentally leaking secrets (e.g., by printing their values).\n> Therefore, avoid using these methods for storing secrets.\n> The recommended way to configuration and authentication of S3 endpoints is to use [secrets]({% link docs/stable/core_extensions/httpfs/s3api.md %}#configuration-and-authentication).", "position": 0, "token_count": 172, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-httpfs-s3api_legacy_authentication-000", "document_id": "core_extensions-httpfs-s3api_legacy_authentication", "position": 0, "token_count": 172, "has_code": false, "overlap_with_previous": false, "section_hierarchy": [], "file_path": "core_extensions/httpfs/s3api_legacy_authentication.md", "url": "/core_extensions/httpfs/s3api_legacy_authentication", "title": "Legacy Authentication Scheme for S3 API", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api_legacy_authentication"}}
{"chunk_id": "core_extensions-httpfs-s3api_legacy_authentication-001", "document_id": "core_extensions-httpfs-s3api_legacy_authentication", "content": "## Legacy Authentication Scheme\n\nTo be able to read or write from S3, the correct region should be set:\n\n```sql\nSET s3_region = 'us-east-1';\n```\n\nOptionally, the endpoint can be configured in case a non-AWS object storage server is used:\n\n```sql\nSET s3_endpoint = '⟨domain⟩.⟨tld⟩:⟨port⟩';\n```\n\nIf the endpoint is not SSL-enabled then run:\n\n```sql\nSET s3_use_ssl = false;\n```\n\nSwitching between [path-style](https://docs.aws.amazon.com/AmazonS3/latest/userguide/VirtualHosting.html#path-style-access) and [vhost-style](https://docs.aws.amazon.com/AmazonS3/latest/userguide/VirtualHosting.html#virtual-hosted-style-access) URLs is possible using:\n\n```sql\nSET s3_url_style = 'path';", "position": 1, "token_count": 240, "has_code": true, "section_hierarchy": ["Legacy Authentication Scheme"], "metadata": {"chunk_id": "core_extensions-httpfs-s3api_legacy_authentication-001", "document_id": "core_extensions-httpfs-s3api_legacy_authentication", "position": 1, "token_count": 240, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Legacy Authentication Scheme"], "file_path": "core_extensions/httpfs/s3api_legacy_authentication.md", "url": "/core_extensions/httpfs/s3api_legacy_authentication", "title": "Legacy Authentication Scheme for S3 API", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api_legacy_authentication#legacy-authentication-scheme"}}
{"chunk_id": "core_extensions-httpfs-s3api_legacy_authentication-002", "document_id": "core_extensions-httpfs-s3api_legacy_authentication", "content": "```\n\nHowever, note that this may also require updating the endpoint. For example for AWS S3 it is required to change the endpoint to `s3.⟨region⟩.amazonaws.com`{:.language-sql .highlight}.\n\nAfter configuring the correct endpoint and region, public files can be read. To also read private files, authentication credentials can be added:\n\n```sql\nSET s3_access_key_id = '⟨aws_access_key_id⟩';\nSET s3_secret_access_key = '⟨aws_secret_access_key⟩';\n```\n\nAlternatively, temporary S3 credentials are also supported. They require setting an additional session token:\n\n```sql\nSET s3_session_token = '⟨aws_session_token⟩';\n```\n\nThe [`aws` extension]({% link docs/stable/core_extensions/aws.md %}) allows for loading AWS credentials.", "position": 2, "token_count": 221, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-httpfs-s3api_legacy_authentication-002", "document_id": "core_extensions-httpfs-s3api_legacy_authentication", "position": 2, "token_count": 221, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/httpfs/s3api_legacy_authentication.md", "url": "/core_extensions/httpfs/s3api_legacy_authentication", "title": "Legacy Authentication Scheme for S3 API", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api_legacy_authentication"}}
{"chunk_id": "core_extensions-httpfs-s3api_legacy_authentication-003", "document_id": "core_extensions-httpfs-s3api_legacy_authentication", "content": "## Per-Request Configuration\n\nAside from the global S3 configuration described above, specific configuration values can be used on a per-request basis. This allows for use of multiple sets of credentials, regions, etc. These are used by including them on the S3 URI as query parameters. All the individual configuration values listed above can be set as query parameters. For instance:\n\n```sql\nSELECT *\nFROM 's3://bucket/file.parquet?s3_access_key_id=accessKey&s3_secret_access_key=secretKey';\n```\n\nMultiple configurations per query are also allowed:\n\n```sql\nSELECT *\nFROM 's3://bucket/file.parquet?s3_access_key_id=accessKey1&s3_secret_access_key=secretKey1' t1\nINNER JOIN 's3://bucket/file.csv?s3_access_key_id=accessKey2&s3_secret_access_key=secretKey2' t2;\n```", "position": 3, "token_count": 229, "has_code": true, "section_hierarchy": ["Per-Request Configuration"], "metadata": {"chunk_id": "core_extensions-httpfs-s3api_legacy_authentication-003", "document_id": "core_extensions-httpfs-s3api_legacy_authentication", "position": 3, "token_count": 229, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Per-Request Configuration"], "file_path": "core_extensions/httpfs/s3api_legacy_authentication.md", "url": "/core_extensions/httpfs/s3api_legacy_authentication", "title": "Legacy Authentication Scheme for S3 API", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api_legacy_authentication#per-request-configuration"}}
{"chunk_id": "core_extensions-httpfs-s3api_legacy_authentication-004", "document_id": "core_extensions-httpfs-s3api_legacy_authentication", "content": "## Configuration\n\nSome additional configuration options exist for the S3 upload, though the default values should suffice for most use cases.\n\nAdditionally, most of the configuration options can be set via environment variables:", "position": 4, "token_count": 44, "has_code": false, "section_hierarchy": ["Configuration"], "metadata": {"chunk_id": "core_extensions-httpfs-s3api_legacy_authentication-004", "document_id": "core_extensions-httpfs-s3api_legacy_authentication", "position": 4, "token_count": 44, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Configuration"], "file_path": "core_extensions/httpfs/s3api_legacy_authentication.md", "url": "/core_extensions/httpfs/s3api_legacy_authentication", "title": "Legacy Authentication Scheme for S3 API", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api_legacy_authentication#configuration"}}
{"chunk_id": "core_extensions-httpfs-s3api_legacy_authentication-005", "document_id": "core_extensions-httpfs-s3api_legacy_authentication", "content": "| DuckDB setting | Environment variable | Note |\n|:-----------------------|:---------------------------|:-----------------------------------------|\n| `s3_region` | `AWS_REGION` | Takes priority over `AWS_DEFAULT_REGION` |\n| `s3_region` | `AWS_DEFAULT_REGION` | |\n| `s3_access_key_id` | `AWS_ACCESS_KEY_ID` | |\n| `s3_secret_access_key` | `AWS_SECRET_ACCESS_KEY` | |\n| `s3_session_token` | `AWS_SESSION_TOKEN` | |", "position": 5, "token_count": 223, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-httpfs-s3api_legacy_authentication-005", "document_id": "core_extensions-httpfs-s3api_legacy_authentication", "position": 5, "token_count": 223, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/httpfs/s3api_legacy_authentication.md", "url": "/core_extensions/httpfs/s3api_legacy_authentication", "title": "Legacy Authentication Scheme for S3 API", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api_legacy_authentication"}}
{"chunk_id": "core_extensions-httpfs-s3api_legacy_authentication-006", "document_id": "core_extensions-httpfs-s3api_legacy_authentication", "content": "| `s3_secret_access_key` | `AWS_SECRET_ACCESS_KEY` | |\n| `s3_session_token` | `AWS_SESSION_TOKEN` | |\n| `s3_endpoint` | `DUCKDB_S3_ENDPOINT` | |\n| `s3_use_ssl` | `DUCKDB_S3_USE_SSL` | |\n| `s3_requester_pays` | `DUCKDB_S3_REQUESTER_PAYS` | |", "position": 6, "token_count": 117, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-httpfs-s3api_legacy_authentication-006", "document_id": "core_extensions-httpfs-s3api_legacy_authentication", "position": 6, "token_count": 117, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/httpfs/s3api_legacy_authentication.md", "url": "/core_extensions/httpfs/s3api_legacy_authentication", "title": "Legacy Authentication Scheme for S3 API", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api_legacy_authentication"}}
