{"chunk_id": "internals-storage-000", "document_id": "internals-storage", "content": "## Compatibility\n\n### Backward Compatibility\n\n_Backward compatibility_ refers to the ability of a newer DuckDB version to read storage files created by an older DuckDB version. Version 0.10 is the first release of DuckDB that supports backward compatibility in the storage format. DuckDB v0.10 can read and operate on files created by the previous DuckDB version – DuckDB v0.9.\n\nFor future DuckDB versions, our goal is to ensure that any DuckDB version released **after** can read files created by previous versions, starting from this release. We want to ensure that the file format is fully backward compatible. This allows you to keep data stored in DuckDB files around and guarantees that you will be able to read the files without having to worry about which version the file was written with or having to convert files between versions.", "position": 0, "token_count": 174, "has_code": false, "section_hierarchy": ["Backward Compatibility"], "metadata": {"chunk_id": "internals-storage-000", "document_id": "internals-storage", "position": 0, "token_count": 174, "has_code": false, "overlap_with_previous": false, "section_hierarchy": ["Backward Compatibility"], "file_path": "internals/storage.md", "url": "/internals/storage", "title": "Storage Versions and Format", "category": null, "tags": [], "section_url": "/internals/storage#backward-compatibility"}}
{"chunk_id": "internals-storage-001", "document_id": "internals-storage", "content": "### Forward Compatibility\n\n_Forward compatibility_ refers to the ability of an older DuckDB version to read storage files produced by a newer DuckDB version. DuckDB v0.9 is [**partially** forward compatible with DuckDB v0.10]({% post_url 2024-02-13-announcing-duckdb-0100 %}#forward-compatibility). Certain files created by DuckDB v0.10 can be read by DuckDB v0.9.\n\nForward compatibility is provided on a **best effort** basis. While stability of the storage format is important – there are still many improvements and innovations that we want to make to the storage format in the future. As such, forward compatibility may be (partially) broken on occasion.", "position": 1, "token_count": 163, "has_code": false, "section_hierarchy": ["Forward Compatibility"], "metadata": {"chunk_id": "internals-storage-001", "document_id": "internals-storage", "position": 1, "token_count": 163, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Forward Compatibility"], "file_path": "internals/storage.md", "url": "/internals/storage", "title": "Storage Versions and Format", "category": null, "tags": [], "section_url": "/internals/storage#forward-compatibility"}}
{"chunk_id": "internals-storage-002", "document_id": "internals-storage", "content": "## How to Move between Storage Formats\n\nWhen you update DuckDB and open an old database file, you might encounter an error message about incompatible storage formats, pointing to this page.\nTo move your database(s) to newer format you only need the older and the newer DuckDB executable.\n\nOpen your database file with the older DuckDB and run the SQL statement `EXPORT DATABASE 'tmp'`. This allows you to save the whole state of the current database in use inside folder `tmp`.\nThe content of the `tmp` folder will be overridden, so choose an empty/non yet existing location. Then, start the newer DuckDB and execute `IMPORT DATABASE 'tmp'` (pointing to the previously populated folder) to load the database, which can be then saved to the file you pointed DuckDB to.\n\nA Bash script to achieve this (to be adapted with the file names and executable locations) is the following\n\n```bash\n/older/duckdb mydata.old.db -c \"EXPORT DATABASE 'tmp'\"\n/newer/duckdb mydata.new.db -c \"IMPORT DATABASE 'tmp'\"", "position": 2, "token_count": 246, "has_code": true, "section_hierarchy": ["How to Move between Storage Formats"], "metadata": {"chunk_id": "internals-storage-002", "document_id": "internals-storage", "position": 2, "token_count": 246, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["How to Move between Storage Formats"], "file_path": "internals/storage.md", "url": "/internals/storage", "title": "Storage Versions and Format", "category": null, "tags": [], "section_url": "/internals/storage#how-to-move-between-storage-formats"}}
{"chunk_id": "internals-storage-003", "document_id": "internals-storage", "content": "```\n\nAfter this, `mydata.old.db` will remain in the old format, `mydata.new.db` will contain the same data but in a format accessible by the more recent DuckDB version, and the folder `tmp` will hold the same data in a universal format as different files.\n\nCheck [`EXPORT` documentation]({% link docs/stable/sql/statements/export.md %}) for more details on the syntax.", "position": 3, "token_count": 104, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "internals-storage-003", "document_id": "internals-storage", "position": 3, "token_count": 104, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "internals/storage.md", "url": "/internals/storage", "title": "Storage Versions and Format", "category": null, "tags": [], "section_url": "/internals/storage"}}
{"chunk_id": "internals-storage-004", "document_id": "internals-storage", "content": "### Explicit Storage Versions\n\n[DuckDB v1.2.0 introduced the `STORAGE_VERSION` option]({% post_url 2025-02-05-announcing-duckdb-120 %}#explicit-storage-versions), which allows explicitly specifying the storage version.\nUsing this, you can opt-in to newer forwards-incompatible features:\n\n```sql\nATTACH 'file.db' (STORAGE_VERSION 'v1.2.0');\n```\n\nThis setting specifies the minimum DuckDB version that should be able to read the database file. When database files are written with this option, the resulting files cannot be opened by older DuckDB released versions than the specified version. They can be read by the specified version and all newer versions of DuckDB.\n\nIf you attach to DuckDB databases, you can query the storage versions using the following command:\n\n```sql\nSELECT database_name, tags FROM duckdb_databases();", "position": 4, "token_count": 204, "has_code": true, "section_hierarchy": ["Explicit Storage Versions"], "metadata": {"chunk_id": "internals-storage-004", "document_id": "internals-storage", "position": 4, "token_count": 204, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Explicit Storage Versions"], "file_path": "internals/storage.md", "url": "/internals/storage", "title": "Storage Versions and Format", "category": null, "tags": [], "section_url": "/internals/storage#explicit-storage-versions"}}
{"chunk_id": "internals-storage-005", "document_id": "internals-storage", "content": "```\n\nThis shows the storage versions:\n\n```text\n┌───────────────┬───────────────────────────────────┐\n│ database_name │ tags │\n│ varchar │ map(varchar, varchar) │\n├───────────────┼───────────────────────────────────┤\n│ file1 │ {storage_version=v1.2.0} │\n│ file2 │ {storage_version=v1.0.0 - v1.1.3} │\n│ ... │ ... │\n└───────────────┴───────────────────────────────────┘\n```\n\nThis means that `file2` can be opened by past DuckDB versions while `file1` is compatible only with `v1.2.0` (or future versions).", "position": 5, "token_count": 132, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "internals-storage-005", "document_id": "internals-storage", "position": 5, "token_count": 132, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "internals/storage.md", "url": "/internals/storage", "title": "Storage Versions and Format", "category": null, "tags": [], "section_url": "/internals/storage"}}
{"chunk_id": "internals-storage-006", "document_id": "internals-storage", "content": "### Converting between Storage Versions\n\nTo convert from the new format to the old format for compatibility, use the following sequence in DuckDB v1.2.0+:\n\n```sql\nATTACH 'file1.db';\nATTACH 'converted_file.db' (STORAGE_VERSION 'v1.0.0');\nCOPY FROM DATABASE file1 TO converted_file;\n```", "position": 6, "token_count": 84, "has_code": true, "section_hierarchy": ["Converting between Storage Versions"], "metadata": {"chunk_id": "internals-storage-006", "document_id": "internals-storage", "position": 6, "token_count": 84, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Converting between Storage Versions"], "file_path": "internals/storage.md", "url": "/internals/storage", "title": "Storage Versions and Format", "category": null, "tags": [], "section_url": "/internals/storage#converting-between-storage-versions"}}
{"chunk_id": "internals-storage-007", "document_id": "internals-storage", "content": "## Storage Header\n\nDuckDB files start with a `uint64_t` which contains a checksum for the main header, followed by four magic bytes (`DUCK`), followed by the storage version number in a `uint64_t`.\n\n```batch\nhexdump -n 20 -C mydata.db\n```\n\n```text\n00000000 01 d0 e2 63 9c 13 39 3e 44 55 43 4b 2b 00 00 00 |...c..9>DUCK+...|\n00000010 00 00 00 00 |....|\n00000014\n```\n\nA simple example of reading the storage version using Python is below.\n\n```python\nimport struct\n\npattern = struct.Struct('<8x4sQ')\n\nwith open('test/sql/storage_version/storage_version.db', 'rb') as fh:\n print(pattern.unpack(fh.read(pattern.size)))\n```", "position": 7, "token_count": 231, "has_code": true, "section_hierarchy": ["Storage Header"], "metadata": {"chunk_id": "internals-storage-007", "document_id": "internals-storage", "position": 7, "token_count": 231, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Storage Header"], "file_path": "internals/storage.md", "url": "/internals/storage", "title": "Storage Versions and Format", "category": null, "tags": [], "section_url": "/internals/storage#storage-header"}}
{"chunk_id": "internals-storage-008", "document_id": "internals-storage", "content": "## Storage Version Table\n\nFor changes in each given release, check out the [change log](https://github.com/duckdb/duckdb/releases) on GitHub.\nTo see the commits that changed each storage version, see the [commit log](https://github.com/duckdb/duckdb/commits/main/src/storage/storage_info.cpp).", "position": 8, "token_count": 95, "has_code": false, "section_hierarchy": ["Storage Version Table"], "metadata": {"chunk_id": "internals-storage-008", "document_id": "internals-storage", "position": 8, "token_count": 95, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Storage Version Table"], "file_path": "internals/storage.md", "url": "/internals/storage", "title": "Storage Versions and Format", "category": null, "tags": [], "section_url": "/internals/storage#storage-version-table"}}
{"chunk_id": "internals-storage-009", "document_id": "internals-storage", "content": "| Storage version | DuckDB version(s) |\n|----------------:|---------------------------------|\n| 67 | v1.4.x |\n| 66 | v1.3.x |\n| 65 | v1.2.x |\n| 64 | v0.9.x, v0.10.x, v1.0.0, v1.1.x |\n| 51 | v0.8.x |\n| 43 | v0.7.x |\n| 39 | v0.6.x |\n| 38 | v0.5.x |\n| 33 | v0.3.3, v0.3.4, v0.4.0 |\n| 31 | v0.3.2 |", "position": 9, "token_count": 201, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "internals-storage-009", "document_id": "internals-storage", "position": 9, "token_count": 201, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "internals/storage.md", "url": "/internals/storage", "title": "Storage Versions and Format", "category": null, "tags": [], "section_url": "/internals/storage"}}
{"chunk_id": "internals-storage-010", "document_id": "internals-storage", "content": "| 33 | v0.3.3, v0.3.4, v0.4.0 |\n| 31 | v0.3.2 |\n| 27 | v0.3.1 |\n| 25 | v0.3.0 |\n| 21 | v0.2.9 |\n| 18 | v0.2.8 |\n| 17 | v0.2.7 |\n| 15 | v0.2.6 |\n| 13 | v0.2.5 |\n| 11 | v0.2.4 |\n| 6 | v0.2.3 |\n| 4 | v0.2.2 |\n| 1 | v0.2.1 and prior |", "position": 10, "token_count": 148, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "internals-storage-010", "document_id": "internals-storage", "position": 10, "token_count": 148, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "internals/storage.md", "url": "/internals/storage", "title": "Storage Versions and Format", "category": null, "tags": [], "section_url": "/internals/storage"}}
{"chunk_id": "internals-storage-011", "document_id": "internals-storage", "content": "## Compression\n\nDuckDB uses [lightweight compression]({% post_url 2022-10-28-lightweight-compression %}).\nBy default, compression is only applied to persistent databases and is **not applied to in-memory instances**.\nTo turn on compression for in-memory databases, use `ATTACH` with the [`COMPRESS` option]({% link docs/stable/sql/statements/attach.md %}#options).", "position": 11, "token_count": 102, "has_code": false, "section_hierarchy": ["Compression"], "metadata": {"chunk_id": "internals-storage-011", "document_id": "internals-storage", "position": 11, "token_count": 102, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Compression"], "file_path": "internals/storage.md", "url": "/internals/storage", "title": "Storage Versions and Format", "category": null, "tags": [], "section_url": "/internals/storage#compression"}}
{"chunk_id": "internals-storage-012", "document_id": "internals-storage", "content": "### Compression Algorithms\n\nThe compression algorithms supported by DuckDB include the following:", "position": 12, "token_count": 18, "has_code": false, "section_hierarchy": ["Compression Algorithms"], "metadata": {"chunk_id": "internals-storage-012", "document_id": "internals-storage", "position": 12, "token_count": 18, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Compression Algorithms"], "file_path": "internals/storage.md", "url": "/internals/storage", "title": "Storage Versions and Format", "category": null, "tags": [], "section_url": "/internals/storage#compression-algorithms"}}
{"chunk_id": "internals-storage-013", "document_id": "internals-storage", "content": "* [Constant Encoding]({% post_url 2022-10-28-lightweight-compression %}#constant-encoding)\n* [Run-Length Encoding (RLE)]({% post_url 2022-10-28-lightweight-compression %}#run-length-encoding-rle)\n* [Bit Packing]({% post_url 2022-10-28-lightweight-compression %}#bit-packing)\n* [Frame of Reference (FOR)]({% post_url 2022-10-28-lightweight-compression %}#frame-of-reference)\n* [Dictionary Encoding]({% post_url 2022-10-28-lightweight-compression %}#dictionary-encoding)", "position": 13, "token_count": 164, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "internals-storage-013", "document_id": "internals-storage", "position": 13, "token_count": 164, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "internals/storage.md", "url": "/internals/storage", "title": "Storage Versions and Format", "category": null, "tags": [], "section_url": "/internals/storage"}}
{"chunk_id": "internals-storage-014", "document_id": "internals-storage", "content": "* [Dictionary Encoding]({% post_url 2022-10-28-lightweight-compression %}#dictionary-encoding)\n* [Fast Static Symbol Table (FSST)]({% post_url 2022-10-28-lightweight-compression %}#fsst) – [VLDB 2020 paper](https://www.vldb.org/pvldb/vol13/p2649-boncz.pdf)\n* [Adaptive Lossless Floating-Point Compression (ALP)]({% post_url 2024-02-13-announcing-duckdb-0100 %}#adaptive-lossless-floating-point-compression-alp) – [SIGMOD 2024 paper](https://ir.cwi.nl/pub/33334/33334.pdf)", "position": 14, "token_count": 187, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "internals-storage-014", "document_id": "internals-storage", "position": 14, "token_count": 187, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "internals/storage.md", "url": "/internals/storage", "title": "Storage Versions and Format", "category": null, "tags": [], "section_url": "/internals/storage"}}
{"chunk_id": "internals-storage-015", "document_id": "internals-storage", "content": "* [Chimp]({% post_url 2022-10-28-lightweight-compression %}#chimp--patas) – [VLDB 2022 paper](https://www.vldb.org/pvldb/vol15/p3058-liakos.pdf)\n* [Patas]({% post_url 2022-11-14-announcing-duckdb-060 %}#compression-improvements)", "position": 15, "token_count": 105, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "internals-storage-015", "document_id": "internals-storage", "position": 15, "token_count": 105, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "internals/storage.md", "url": "/internals/storage", "title": "Storage Versions and Format", "category": null, "tags": [], "section_url": "/internals/storage"}}
{"chunk_id": "internals-storage-016", "document_id": "internals-storage", "content": "## Disk Usage\n\nThe disk usage of DuckDB's format depends on a number of factors, including the data type and the data distribution, the compression methods used, etc.\nAs a rough approximation, loading 100 GB of uncompressed CSV files into a DuckDB database file will require 25 GB of disk space, while loading 100 GB of Parquet files will require 120 GB of disk space.", "position": 16, "token_count": 83, "has_code": false, "section_hierarchy": ["Disk Usage"], "metadata": {"chunk_id": "internals-storage-016", "document_id": "internals-storage", "position": 16, "token_count": 83, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Disk Usage"], "file_path": "internals/storage.md", "url": "/internals/storage", "title": "Storage Versions and Format", "category": null, "tags": [], "section_url": "/internals/storage#disk-usage"}}
{"chunk_id": "internals-storage-017", "document_id": "internals-storage", "content": "## Row Groups\n\nDuckDB's storage format stores the data in _row groups,_ i.e., horizontal partitions of the data.\nThis concept is equivalent to [Parquet's row groups](https://parquet.apache.org/docs/concepts/).\nSeveral features in DuckDB, including [parallelism]({% link docs/stable/guides/performance/how_to_tune_workloads.md %}) and [compression]({% post_url 2022-10-28-lightweight-compression %}) are based on row groups.\n\nThe row group size can be specified as an option of the `ATTACH` statement:\n\n```sql\nATTACH '/tmp/somefile.db' AS db (ROW_GROUP_SIZE 16384);\n```", "position": 17, "token_count": 181, "has_code": true, "section_hierarchy": ["Row Groups"], "metadata": {"chunk_id": "internals-storage-017", "document_id": "internals-storage", "position": 17, "token_count": 181, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Row Groups"], "file_path": "internals/storage.md", "url": "/internals/storage", "title": "Storage Versions and Format", "category": null, "tags": [], "section_url": "/internals/storage#row-groups"}}
{"chunk_id": "internals-storage-018", "document_id": "internals-storage", "content": "## Troubleshooting\n\n### Error Message When Opening an Incompatible Database File\n\nWhen opening a database file that has been written by a different DuckDB version from the one you are using, the following error message may occur:\n\n```console\nError: unable to open database \"...\": Serialization Error: Failed to deserialize: ...\n```\n\nThe message implies that the database file was created with a newer DuckDB version and uses features that are backward incompatible with the DuckDB version used to read the file.\n\nThere are two potential workarounds:\n\n1. Update your DuckDB version to the latest stable version.\n2. Open the database with the latest version of DuckDB, export it to a standard format (e.g., Parquet), then import it using to any version of DuckDB. See the [`EXPORT/IMPORT DATABASE` statements]({% link docs/stable/sql/statements/export.md %}) for details.", "position": 18, "token_count": 207, "has_code": true, "section_hierarchy": ["Error Message When Opening an Incompatible Database File"], "metadata": {"chunk_id": "internals-storage-018", "document_id": "internals-storage", "position": 18, "token_count": 207, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Error Message When Opening an Incompatible Database File"], "file_path": "internals/storage.md", "url": "/internals/storage", "title": "Storage Versions and Format", "category": null, "tags": [], "section_url": "/internals/storage#error-message-when-opening-an-incompatible-database-file"}}
