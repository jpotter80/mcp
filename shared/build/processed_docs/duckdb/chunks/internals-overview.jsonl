{"chunk_id": "internals-overview-000", "document_id": "internals-overview", "content": "On this page is a brief description of the internals of the DuckDB engine.", "position": 0, "token_count": 19, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "internals-overview-000", "document_id": "internals-overview", "position": 0, "token_count": 19, "has_code": false, "overlap_with_previous": false, "section_hierarchy": [], "file_path": "internals/overview.md", "url": "/internals/overview", "title": "Overview of DuckDB Internals", "category": null, "tags": [], "section_url": "/internals/overview"}}
{"chunk_id": "internals-overview-001", "document_id": "internals-overview", "content": "## Parser\n\nThe parser converts a query string into the following tokens:\n\n* [`SQLStatement`](https://github.com/duckdb/duckdb/blob/main/src/include/duckdb/parser/sql_statement.hpp)\n* [`QueryNode`](https://github.com/duckdb/duckdb/blob/main/src/include/duckdb/parser/query_node.hpp)\n* [`TableRef`](https://github.com/duckdb/duckdb/blob/main/src/include/duckdb/parser/tableref.hpp)\n* [`ParsedExpression`](https://github.com/duckdb/duckdb/blob/main/src/include/duckdb/parser/parsed_expression.hpp)", "position": 1, "token_count": 219, "has_code": false, "section_hierarchy": ["Parser"], "metadata": {"chunk_id": "internals-overview-001", "document_id": "internals-overview", "position": 1, "token_count": 219, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Parser"], "file_path": "internals/overview.md", "url": "/internals/overview", "title": "Overview of DuckDB Internals", "category": null, "tags": [], "section_url": "/internals/overview#parser"}}
{"chunk_id": "internals-overview-002", "document_id": "internals-overview", "content": "The parser is not aware of the catalog or any other aspect of the database. It will not throw errors if tables do not exist, and will not resolve **any** types of columns yet. It only transforms a query string into a set of tokens as specified.", "position": 2, "token_count": 59, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "internals-overview-002", "document_id": "internals-overview", "position": 2, "token_count": 59, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "internals/overview.md", "url": "/internals/overview", "title": "Overview of DuckDB Internals", "category": null, "tags": [], "section_url": "/internals/overview"}}
{"chunk_id": "internals-overview-003", "document_id": "internals-overview", "content": "### ParsedExpression\n\nThe ParsedExpression represents an expression within a SQL statement. This can be e.g., a reference to a column, an addition operator or a constant value. The type of the ParsedExpression indicates what it represents, e.g., a comparison is represented as a [`ComparisonExpression`](https://github.com/duckdb/duckdb/blob/main/src/include/duckdb/parser/expression/comparison_expression.hpp).\n\nParsedExpressions do **not** have types, except for nodes with explicit types such as `CAST` statements. The types for expressions are resolved in the Binder, not in the Parser.\n\n### TableRef\n\nThe TableRef represents any table source. This can be a reference to a base table, but it can also be a join, a table-producing function or a subquery.", "position": 3, "token_count": 211, "has_code": false, "section_hierarchy": ["TableRef"], "metadata": {"chunk_id": "internals-overview-003", "document_id": "internals-overview", "position": 3, "token_count": 211, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["TableRef"], "file_path": "internals/overview.md", "url": "/internals/overview", "title": "Overview of DuckDB Internals", "category": null, "tags": [], "section_url": "/internals/overview#tableref"}}
{"chunk_id": "internals-overview-004", "document_id": "internals-overview", "content": "### TableRef\n\nThe TableRef represents any table source. This can be a reference to a base table, but it can also be a join, a table-producing function or a subquery.\n\n### QueryNode\n\nThe QueryNode represents either (1) a `SELECT` statement, or (2) a set operation (i.e., `UNION`, `INTERSECT` or `DIFFERENCE`).\n\n### SQL Statement\n\nThe SQLStatement represents a complete SQL statement. The type of the SQL Statement represents what kind of statement it is (e.g., `StatementType::SELECT` represents a `SELECT` statement). A single SQL string can be transformed into multiple SQL statements in case the original query string contains multiple queries.", "position": 4, "token_count": 165, "has_code": false, "section_hierarchy": ["SQL Statement"], "metadata": {"chunk_id": "internals-overview-004", "document_id": "internals-overview", "position": 4, "token_count": 165, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["SQL Statement"], "file_path": "internals/overview.md", "url": "/internals/overview", "title": "Overview of DuckDB Internals", "category": null, "tags": [], "section_url": "/internals/overview#sql-statement"}}
{"chunk_id": "internals-overview-005", "document_id": "internals-overview", "content": "## Binder\n\nThe binder converts all nodes into their **bound** equivalents. In the binder phase:\n\n* The tables and columns are resolved using the catalog\n* Types are resolved\n* Aggregate/window functions are extracted\n\nThe following conversions happen:", "position": 5, "token_count": 54, "has_code": false, "section_hierarchy": ["Binder"], "metadata": {"chunk_id": "internals-overview-005", "document_id": "internals-overview", "position": 5, "token_count": 54, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Binder"], "file_path": "internals/overview.md", "url": "/internals/overview", "title": "Overview of DuckDB Internals", "category": null, "tags": [], "section_url": "/internals/overview#binder"}}
{"chunk_id": "internals-overview-006", "document_id": "internals-overview", "content": "* The tables and columns are resolved using the catalog\n* Types are resolved\n* Aggregate/window functions are extracted\n\nThe following conversions happen:\n\n* SQLStatement → [`BoundStatement`](https://github.com/duckdb/duckdb/blob/main/src/include/duckdb/planner/bound_statement.hpp)\n* QueryNode → [`BoundQueryNode`](https://github.com/duckdb/duckdb/blob/main/src/include/duckdb/planner/bound_query_node.hpp)\n* TableRef → [`BoundTableRef`](https://github.com/duckdb/duckdb/blob/main/src/include/duckdb/planner/bound_tableref.hpp)\n* ParsedExpression → [`Expression`](https://github.com/duckdb/duckdb/blob/main/src/include/duckdb/planner/expression.hpp)", "position": 6, "token_count": 241, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "internals-overview-006", "document_id": "internals-overview", "position": 6, "token_count": 241, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "internals/overview.md", "url": "/internals/overview", "title": "Overview of DuckDB Internals", "category": null, "tags": [], "section_url": "/internals/overview"}}
{"chunk_id": "internals-overview-007", "document_id": "internals-overview", "content": "## Logical Planner\n\nThe logical planner creates [`LogicalOperator`](https://github.com/duckdb/duckdb/blob/main/src/include/duckdb/planner/logical_operator.hpp) nodes from the bound statements. In this phase, the actual logical query tree is created.", "position": 7, "token_count": 75, "has_code": false, "section_hierarchy": ["Logical Planner"], "metadata": {"chunk_id": "internals-overview-007", "document_id": "internals-overview", "position": 7, "token_count": 75, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Logical Planner"], "file_path": "internals/overview.md", "url": "/internals/overview", "title": "Overview of DuckDB Internals", "category": null, "tags": [], "section_url": "/internals/overview#logical-planner"}}
{"chunk_id": "internals-overview-008", "document_id": "internals-overview", "content": "## Optimizer\n\nAfter the logical planner has created the logical query tree, the optimizers are run over that query tree to create an optimized query plan. The following query optimizers are run:\n\n* **Expression Rewriter**: Simplifies expressions, performs constant folding\n* **Filter Pushdown**: Pushes filters down into the query plan and duplicates filters over equivalency sets. Also prunes subtrees that are guaranteed to be empty (because of filters that statically evaluate to false).\n* **Join Order Optimizer**: Reorders joins using dynamic programming. Specifically, the `DPccp` algorithm from the paper [Dynamic Programming Strikes Back](https://15721.courses.cs.cmu.edu/spring2017/papers/14-optimizer1/p539-moerkotte.pdf) is used.\n* **Common Sub Expressions**: Extracts common subexpressions from projection and filter nodes to prevent unnecessary duplicate execution.\n* **In Clause Rewriter**: Rewrites large static IN clauses to a MARK join or INNER join.", "position": 8, "token_count": 246, "has_code": false, "section_hierarchy": ["Optimizer"], "metadata": {"chunk_id": "internals-overview-008", "document_id": "internals-overview", "position": 8, "token_count": 246, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Optimizer"], "file_path": "internals/overview.md", "url": "/internals/overview", "title": "Overview of DuckDB Internals", "category": null, "tags": [], "section_url": "/internals/overview#optimizer"}}
{"chunk_id": "internals-overview-009", "document_id": "internals-overview", "content": "## Column Binding Resolver\n\nThe column binding resolver converts logical [`BoundColumnRefExpresion`](https://github.com/duckdb/duckdb/blob/main/src/include/duckdb/planner/expression/bound_columnref_expression.hpp) nodes that refer to a column of a specific table into [`BoundReferenceExpression`](https://github.com/duckdb/duckdb/blob/main/src/include/duckdb/planner/expression/bound_reference_expression.hpp) nodes that refer to a specific index into the DataChunks that are passed around in the execution engine.\n\n## Physical Plan Generator\n\nThe physical plan generator converts the resulting logical operator tree into a [`PhysicalOperator`](https://github.com/duckdb/duckdb/blob/main/src/include/duckdb/execution/physical_operator.hpp) tree.", "position": 9, "token_count": 226, "has_code": false, "section_hierarchy": ["Physical Plan Generator"], "metadata": {"chunk_id": "internals-overview-009", "document_id": "internals-overview", "position": 9, "token_count": 226, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Physical Plan Generator"], "file_path": "internals/overview.md", "url": "/internals/overview", "title": "Overview of DuckDB Internals", "category": null, "tags": [], "section_url": "/internals/overview#physical-plan-generator"}}
{"chunk_id": "internals-overview-010", "document_id": "internals-overview", "content": "## Execution\n\nIn the execution phase, the physical operators are executed to produce the query result.\nDuckDB uses a push-based vectorized model, where [`DataChunks`](https://github.com/duckdb/duckdb/blob/main/src/include/duckdb/common/types/data_chunk.hpp) are pushed through the operator tree.\nFor more information, see the talk [Push-Based Execution in DuckDB](https://www.youtube.com/watch?v=1kDrPgRUuEI).", "position": 10, "token_count": 130, "has_code": false, "section_hierarchy": ["Execution"], "metadata": {"chunk_id": "internals-overview-010", "document_id": "internals-overview", "position": 10, "token_count": 130, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Execution"], "file_path": "internals/overview.md", "url": "/internals/overview", "title": "Overview of DuckDB Internals", "category": null, "tags": [], "section_url": "/internals/overview#execution"}}
