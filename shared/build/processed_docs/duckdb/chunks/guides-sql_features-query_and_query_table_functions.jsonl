{"chunk_id": "guides-sql_features-query_and_query_table_functions-000", "document_id": "guides-sql_features-query_and_query_table_functions", "content": "The [`query_table`]({% link docs/stable/sql/functions/utility.md %}#query_tabletbl_name)\nand [`query`]({% link docs/stable/sql/functions/utility.md %}#queryquery_string_literal)\nfunctions enable powerful and more dynamic SQL.\n\nThe `query_table` function returns the table whose name is specified by its string argument; the `query` function returns the table obtained by executing the query specified by its string argument.\n\nBoth functions only accept constant strings. For example, they allow passing in a table name as a prepared statement parameter:\n\n```sql\nCREATE TABLE my_table (i INTEGER);\nINSERT INTO my_table VALUES (42);\n\nPREPARE select_from_table AS SELECT * FROM query_table($1);\nEXECUTE select_from_table('my_table');", "position": 0, "token_count": 194, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "guides-sql_features-query_and_query_table_functions-000", "document_id": "guides-sql_features-query_and_query_table_functions", "position": 0, "token_count": 194, "has_code": true, "overlap_with_previous": false, "section_hierarchy": [], "file_path": "guides/sql_features/query_and_query_table_functions.md", "url": "/guides/sql_features/query_and_query_table_functions", "title": "query and query_table Functions", "category": null, "tags": [], "section_url": "/guides/sql_features/query_and_query_table_functions"}}
{"chunk_id": "guides-sql_features-query_and_query_table_functions-001", "document_id": "guides-sql_features-query_and_query_table_functions", "content": "```\n\n| i |\n|---:|\n| 42 |\n\nWhen combined with the [`COLUMNS` expression]({% link docs/stable/sql/expressions/star.md %}#columns), we can write very generic SQL-only macros. For example, below is a custom version of `SUMMARIZE` that computes the `min` and `max` of every column in a table:", "position": 1, "token_count": 92, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "guides-sql_features-query_and_query_table_functions-001", "document_id": "guides-sql_features-query_and_query_table_functions", "position": 1, "token_count": 92, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "guides/sql_features/query_and_query_table_functions.md", "url": "/guides/sql_features/query_and_query_table_functions", "title": "query and query_table Functions", "category": null, "tags": [], "section_url": "/guides/sql_features/query_and_query_table_functions"}}
{"chunk_id": "guides-sql_features-query_and_query_table_functions-002", "document_id": "guides-sql_features-query_and_query_table_functions", "content": "```sql\nCREATE OR REPLACE MACRO my_summarize(table_name) AS TABLE\nSELECT\n unnest([*COLUMNS('alias_.*')]) AS column_name,\n unnest([*COLUMNS('min_.*')]) AS min_value,\n unnest([*COLUMNS('max_.*')]) AS max_value\nFROM (\n SELECT\n any_value(alias(COLUMNS(*))) AS \"alias_\\0\",\n min(COLUMNS(*))::VARCHAR AS \"min_\\0\",\n max(COLUMNS(*))::VARCHAR AS \"max_\\0\"\n FROM query_table(table_name::VARCHAR)\n);\n\nSELECT *\nFROM my_summarize('https://blobs.duckdb.org/data/ontime.parquet')\nLIMIT 3;", "position": 2, "token_count": 201, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "guides-sql_features-query_and_query_table_functions-002", "document_id": "guides-sql_features-query_and_query_table_functions", "position": 2, "token_count": 201, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "guides/sql_features/query_and_query_table_functions.md", "url": "/guides/sql_features/query_and_query_table_functions", "title": "query and query_table Functions", "category": null, "tags": [], "section_url": "/guides/sql_features/query_and_query_table_functions"}}
{"chunk_id": "guides-sql_features-query_and_query_table_functions-003", "document_id": "guides-sql_features-query_and_query_table_functions", "content": "```\n\n| column_name | min_value | max_value |\n|-------------|----------:|----------:|\n| year | 2017 | 2017 |\n| quarter | 1 | 3 |\n| month | 1 | 9 |\n\nThe `query` function allows for even more flexibility. For example, users who prefer pandas' `stack` syntax over SQL's `UNPIVOT` syntax, may use:\n\n```sql\nCREATE OR REPLACE MACRO stack(table_name, index, name, values) AS TABLE\nFROM query(\n 'UNPIVOT ' || table_name\n || ' ON COLUMNS(* EXCLUDE (' || array_to_string(index, ', ')\n || ')) INTO NAME ' || name || ' VALUES ' || values\n);", "position": 3, "token_count": 196, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "guides-sql_features-query_and_query_table_functions-003", "document_id": "guides-sql_features-query_and_query_table_functions", "position": 3, "token_count": 196, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "guides/sql_features/query_and_query_table_functions.md", "url": "/guides/sql_features/query_and_query_table_functions", "title": "query and query_table Functions", "category": null, "tags": [], "section_url": "/guides/sql_features/query_and_query_table_functions"}}
{"chunk_id": "guides-sql_features-query_and_query_table_functions-004", "document_id": "guides-sql_features-query_and_query_table_functions", "content": "WITH cities AS (\n FROM (\n VALUES\n ('NL', 'Amsterdam', '10', '12', '15'),\n ('US', 'New York', '100', '120', '150')\n ) _(country, city, '2000', '2010', '2020')\n)\nSELECT *\nFROM stack('cities', ['country', 'city'], 'year', 'population');", "position": 4, "token_count": 101, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "guides-sql_features-query_and_query_table_functions-004", "document_id": "guides-sql_features-query_and_query_table_functions", "position": 4, "token_count": 101, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "guides/sql_features/query_and_query_table_functions.md", "url": "/guides/sql_features/query_and_query_table_functions", "title": "query and query_table Functions", "category": null, "tags": [], "section_url": "/guides/sql_features/query_and_query_table_functions"}}
{"chunk_id": "guides-sql_features-query_and_query_table_functions-005", "document_id": "guides-sql_features-query_and_query_table_functions", "content": "```\n\n| country | city | year | population |\n|---------|-----------|------|------------|\n| NL | Amsterdam | 2000 | 10 |\n| NL | Amsterdam | 2010 | 12 |\n| NL | Amsterdam | 2020 | 15 |\n| US | New York | 2000 | 100 |\n| US | New York | 2010 | 120 |\n| US | New York | 2020 | 150 |", "position": 5, "token_count": 114, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "guides-sql_features-query_and_query_table_functions-005", "document_id": "guides-sql_features-query_and_query_table_functions", "position": 5, "token_count": 114, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "guides/sql_features/query_and_query_table_functions.md", "url": "/guides/sql_features/query_and_query_table_functions", "title": "query and query_table Functions", "category": null, "tags": [], "section_url": "/guides/sql_features/query_and_query_table_functions"}}
