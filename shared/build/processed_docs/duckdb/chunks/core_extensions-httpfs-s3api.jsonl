{"chunk_id": "core_extensions-httpfs-s3api-000", "document_id": "core_extensions-httpfs-s3api", "content": "The `httpfs` extension supports reading/writing/[globbing](#globbing) files on object storage servers using the S3 API. S3 offers a standard API to read and write to remote files (while regular http servers, predating S3, do not offer a common write API). DuckDB conforms to the S3 API, that is now common among industry storage providers.", "position": 0, "token_count": 87, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-httpfs-s3api-000", "document_id": "core_extensions-httpfs-s3api", "position": 0, "token_count": 87, "has_code": false, "overlap_with_previous": false, "section_hierarchy": [], "file_path": "core_extensions/httpfs/s3api.md", "url": "/core_extensions/httpfs/s3api", "title": "S3 API Support", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api"}}
{"chunk_id": "core_extensions-httpfs-s3api-001", "document_id": "core_extensions-httpfs-s3api", "content": "## Platforms\n\nThe `httpfs` filesystem is tested with [AWS S3](https://aws.amazon.com/s3/), [Minio](https://min.io/), [Google Cloud](https://cloud.google.com/storage/docs/interoperability), and [lakeFS](https://docs.lakefs.io/integrations/duckdb.html). Other services that implement the S3 API (such as [Cloudflare R2](https://www.cloudflare.com/en-gb/developer-platform/r2/)) should also work, but not all features may be supported.\n\nThe following table shows which parts of the S3 API are required for each `httpfs` feature.", "position": 1, "token_count": 183, "has_code": false, "section_hierarchy": ["Platforms"], "metadata": {"chunk_id": "core_extensions-httpfs-s3api-001", "document_id": "core_extensions-httpfs-s3api", "position": 1, "token_count": 183, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Platforms"], "file_path": "core_extensions/httpfs/s3api.md", "url": "/core_extensions/httpfs/s3api", "title": "S3 API Support", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api#platforms"}}
{"chunk_id": "core_extensions-httpfs-s3api-002", "document_id": "core_extensions-httpfs-s3api", "content": "The following table shows which parts of the S3 API are required for each `httpfs` feature.\n\n| Feature | Required S3 API features |\n|:---|:---|\n| Public file reads | HTTP Range requests |\n| Private file reads | Secret key or session token authentication |\n| File glob | [ListObjectsV2](https://docs.aws.amazon.com/AmazonS3/latest/API/API_ListObjectsV2.html) |\n| File writes | [Multipart upload](https://docs.aws.amazon.com/AmazonS3/latest/userguide/mpuoverview.html) |", "position": 2, "token_count": 156, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-httpfs-s3api-002", "document_id": "core_extensions-httpfs-s3api", "position": 2, "token_count": 156, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/httpfs/s3api.md", "url": "/core_extensions/httpfs/s3api", "title": "S3 API Support", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api"}}
{"chunk_id": "core_extensions-httpfs-s3api-003", "document_id": "core_extensions-httpfs-s3api", "content": "## Configuration and Authentication\n\nThe preferred way to configure and authenticate to S3 endpoints is to use [secrets]({% link docs/stable/sql/statements/create_secret.md %}). Multiple secret providers are available.\n\nTo migrate from the [deprecated S3 API]({% link docs/stable/core_extensions/httpfs/s3api_legacy_authentication.md %}), use a defined secret with a profile.\nSee the [“Loading a Secret Based on a Profile” section](#loading-a-secret-based-on-a-profile).", "position": 3, "token_count": 138, "has_code": false, "section_hierarchy": ["Configuration and Authentication"], "metadata": {"chunk_id": "core_extensions-httpfs-s3api-003", "document_id": "core_extensions-httpfs-s3api", "position": 3, "token_count": 138, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Configuration and Authentication"], "file_path": "core_extensions/httpfs/s3api.md", "url": "/core_extensions/httpfs/s3api", "title": "S3 API Support", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api#configuration-and-authentication"}}
{"chunk_id": "core_extensions-httpfs-s3api-004", "document_id": "core_extensions-httpfs-s3api", "content": "### `config` Provider\n\nThe default provider, `config` (i.e., user-configured), allows access to the S3 bucket by manually providing a key. For example:\n\n```sql\nCREATE OR REPLACE SECRET secret (\n TYPE s3,\n PROVIDER config,\n KEY_ID '⟨AKIAIOSFODNN7EXAMPLE⟩',\n SECRET '⟨wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY⟩',\n REGION '⟨us-east-1⟩'\n);\n```\n\n> Tip If you get an IO Error (`Connection error for HTTP HEAD`), configure the endpoint explicitly via `ENDPOINT 's3.⟨your-region⟩.amazonaws.com'`{:.language-sql .highlight}.\n\nNow, to query using the above secret, simply query any `s3://` prefixed file:\n\n```sql\nSELECT *\nFROM 's3://⟨your-bucket⟩/⟨your_file⟩.parquet';\n```", "position": 4, "token_count": 239, "has_code": true, "section_hierarchy": ["`config` Provider"], "metadata": {"chunk_id": "core_extensions-httpfs-s3api-004", "document_id": "core_extensions-httpfs-s3api", "position": 4, "token_count": 239, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["`config` Provider"], "file_path": "core_extensions/httpfs/s3api.md", "url": "/core_extensions/httpfs/s3api", "title": "S3 API Support", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api#config-provider"}}
{"chunk_id": "core_extensions-httpfs-s3api-005", "document_id": "core_extensions-httpfs-s3api", "content": "### `credential_chain` Provider\n\nThe `credential_chain` provider allows automatically fetching credentials using mechanisms provided by the AWS SDK. For example, to use the AWS SDK default provider:\n\n```sql\nCREATE OR REPLACE SECRET secret (\n TYPE s3,\n PROVIDER credential_chain\n);\n```\n\nAgain, to query a file using the above secret, simply query any `s3://` prefixed file.\n\nDuckDB also allows specifying a specific chain using the `CHAIN` keyword. This takes a semicolon-separated list (`a;b;c`) of providers that will be tried in order. For example:\n\n```sql\nCREATE OR REPLACE SECRET secret (\n TYPE s3,\n PROVIDER credential_chain,\n CHAIN 'env;config'\n);", "position": 5, "token_count": 179, "has_code": true, "section_hierarchy": ["`credential_chain` Provider"], "metadata": {"chunk_id": "core_extensions-httpfs-s3api-005", "document_id": "core_extensions-httpfs-s3api", "position": 5, "token_count": 179, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["`credential_chain` Provider"], "file_path": "core_extensions/httpfs/s3api.md", "url": "/core_extensions/httpfs/s3api", "title": "S3 API Support", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api#credentialchain-provider"}}
{"chunk_id": "core_extensions-httpfs-s3api-006", "document_id": "core_extensions-httpfs-s3api", "content": "```\n\nThe possible values for `CHAIN` are the following:", "position": 6, "token_count": 16, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-httpfs-s3api-006", "document_id": "core_extensions-httpfs-s3api", "position": 6, "token_count": 16, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/httpfs/s3api.md", "url": "/core_extensions/httpfs/s3api", "title": "S3 API Support", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api"}}
{"chunk_id": "core_extensions-httpfs-s3api-007", "document_id": "core_extensions-httpfs-s3api", "content": "* [`config`](https://sdk.amazonaws.com/cpp/api/LATEST/aws-cpp-sdk-core/html/class_aws_1_1_auth_1_1_profile_config_file_a_w_s_credentials_provider.html)\n* [`sts`](https://sdk.amazonaws.com/cpp/api/LATEST/aws-cpp-sdk-core/html/class_aws_1_1_auth_1_1_s_t_s_assume_role_web_identity_credentials_provider.html)\n* [`sso`](https://aws.amazon.com/what-is/sso/)", "position": 7, "token_count": 183, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-httpfs-s3api-007", "document_id": "core_extensions-httpfs-s3api", "position": 7, "token_count": 183, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/httpfs/s3api.md", "url": "/core_extensions/httpfs/s3api", "title": "S3 API Support", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api"}}
{"chunk_id": "core_extensions-httpfs-s3api-008", "document_id": "core_extensions-httpfs-s3api", "content": "* [`sso`](https://aws.amazon.com/what-is/sso/)\n* [`env`](https://sdk.amazonaws.com/cpp/api/LATEST/aws-cpp-sdk-core/html/class_aws_1_1_auth_1_1_environment_a_w_s_credentials_provider.html)\n* [`instance`](https://sdk.amazonaws.com/cpp/api/LATEST/aws-cpp-sdk-core/html/class_aws_1_1_auth_1_1_instance_profile_credentials_provider.html)\n* [`process`](https://sdk.amazonaws.com/cpp/api/LATEST/aws-cpp-sdk-core/html/class_aws_1_1_auth_1_1_process_credentials_provider.html)", "position": 8, "token_count": 230, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-httpfs-s3api-008", "document_id": "core_extensions-httpfs-s3api", "position": 8, "token_count": 230, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/httpfs/s3api.md", "url": "/core_extensions/httpfs/s3api", "title": "S3 API Support", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api"}}
{"chunk_id": "core_extensions-httpfs-s3api-009", "document_id": "core_extensions-httpfs-s3api", "content": "The `credential_chain` provider also allows overriding the automatically fetched config. For example, to automatically load credentials, and then override the region, run:\n\n```sql\nCREATE OR REPLACE SECRET secret (\n TYPE s3,\n PROVIDER credential_chain,\n CHAIN config,\n REGION '⟨eu-west-1⟩'\n);", "position": 9, "token_count": 78, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-httpfs-s3api-009", "document_id": "core_extensions-httpfs-s3api", "position": 9, "token_count": 78, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/httpfs/s3api.md", "url": "/core_extensions/httpfs/s3api", "title": "S3 API Support", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api"}}
{"chunk_id": "core_extensions-httpfs-s3api-010", "document_id": "core_extensions-httpfs-s3api", "content": "```", "position": 10, "token_count": 5, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-httpfs-s3api-010", "document_id": "core_extensions-httpfs-s3api", "position": 10, "token_count": 5, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/httpfs/s3api.md", "url": "/core_extensions/httpfs/s3api", "title": "S3 API Support", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api"}}
{"chunk_id": "core_extensions-httpfs-s3api-011", "document_id": "core_extensions-httpfs-s3api", "content": "#### Loading a Secret Based on a Profile\n\nTo load credentials based on a profile which is not defined as a default from the `AWS_PROFILE` environment variable or as a default profile based on AWS SDK precedence, run:\n\n```sql\nCREATE OR REPLACE SECRET secret (\n TYPE s3,\n PROVIDER credential_chain,\n CHAIN config,\n PROFILE '⟨my_profile⟩'\n);\n```\n\nThis approach is equivalent to the [deprecated S3 API's]({% link docs/stable/core_extensions/httpfs/s3api_legacy_authentication.md %})'s method `load_aws_credentials('⟨my_profile⟩')`.", "position": 11, "token_count": 157, "has_code": true, "section_hierarchy": ["Loading a Secret Based on a Profile"], "metadata": {"chunk_id": "core_extensions-httpfs-s3api-011", "document_id": "core_extensions-httpfs-s3api", "position": 11, "token_count": 157, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Loading a Secret Based on a Profile"], "file_path": "core_extensions/httpfs/s3api.md", "url": "/core_extensions/httpfs/s3api", "title": "S3 API Support", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api#loading-a-secret-based-on-a-profile"}}
{"chunk_id": "core_extensions-httpfs-s3api-012", "document_id": "core_extensions-httpfs-s3api", "content": "### Overview of S3 Secret Parameters\n\nBelow is a complete list of the supported parameters that can be used for both the `config` and `credential_chain` providers:", "position": 12, "token_count": 42, "has_code": false, "section_hierarchy": ["Overview of S3 Secret Parameters"], "metadata": {"chunk_id": "core_extensions-httpfs-s3api-012", "document_id": "core_extensions-httpfs-s3api", "position": 12, "token_count": 42, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Overview of S3 Secret Parameters"], "file_path": "core_extensions/httpfs/s3api.md", "url": "/core_extensions/httpfs/s3api", "title": "S3 API Support", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api#overview-of-s3-secret-parameters"}}
{"chunk_id": "core_extensions-httpfs-s3api-013", "document_id": "core_extensions-httpfs-s3api", "content": "| Name | Description | Secret | Type | Default |\n|:------------------------------|:--------------------------------------------------------------------------------------|:------------------|:----------|:--------------------------------------------|", "position": 13, "token_count": 212, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-httpfs-s3api-013", "document_id": "core_extensions-httpfs-s3api", "position": 13, "token_count": 212, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/httpfs/s3api.md", "url": "/core_extensions/httpfs/s3api", "title": "S3 API Support", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api"}}
{"chunk_id": "core_extensions-httpfs-s3api-014", "document_id": "core_extensions-httpfs-s3api", "content": "| `ENDPOINT` | Specify a custom S3 endpoint | `S3`, `GCS`, `R2` | `STRING` | `s3.amazonaws.com` for `S3`, |\n| `KEY_ID` | The ID of the key to use | `S3`, `GCS`, `R2` | `STRING` | - |\n| `REGION` | The region for which to authenticate (should match the region of the bucket to query) | `S3`, `GCS`, `R2` | `STRING` | `us-east-1` |\n| `SECRET` | The secret of the key to use | `S3`, `GCS`, `R2` | `STRING` | - |\n| `SESSION_TOKEN` | Optionally, a session token can be passed to use temporary credentials | `S3`, `GCS`, `R2` | `STRING` | - |", "position": 14, "token_count": 215, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-httpfs-s3api-014", "document_id": "core_extensions-httpfs-s3api", "position": 14, "token_count": 215, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/httpfs/s3api.md", "url": "/core_extensions/httpfs/s3api", "title": "S3 API Support", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api"}}
{"chunk_id": "core_extensions-httpfs-s3api-015", "document_id": "core_extensions-httpfs-s3api", "content": "| `SESSION_TOKEN` | Optionally, a session token can be passed to use temporary credentials | `S3`, `GCS`, `R2` | `STRING` | - |\n| `URL_COMPATIBILITY_MODE` | Can help when URLs contain problematic characters | `S3`, `GCS`, `R2` | `BOOLEAN` | `true` |\n| `URL_STYLE` | Either `vhost` or `path` | `S3`, `GCS`, `R2` | `STRING` | `vhost` for `S3`, `path` for `R2` and `GCS` |\n| `USE_SSL` | Whether to use HTTPS or HTTP | `S3`, `GCS`, `R2` | `BOOLEAN` | `true` |\n| `ACCOUNT_ID` | The R2 account ID to use for generating the endpoint URL | `R2` | `STRING` | - |", "position": 15, "token_count": 222, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-httpfs-s3api-015", "document_id": "core_extensions-httpfs-s3api", "position": 15, "token_count": 222, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/httpfs/s3api.md", "url": "/core_extensions/httpfs/s3api", "title": "S3 API Support", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api"}}
{"chunk_id": "core_extensions-httpfs-s3api-016", "document_id": "core_extensions-httpfs-s3api", "content": "| `ACCOUNT_ID` | The R2 account ID to use for generating the endpoint URL | `R2` | `STRING` | - |\n| `KMS_KEY_ID` | AWS KMS (Key Management Service) key for Server Side Encryption S3 | `S3` | `STRING` | - |\n| `REQUESTER_PAYS` | Allows use of \"requester pays\" S3 buckets | `S3` | `BOOLEAN` | `false` |", "position": 16, "token_count": 108, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-httpfs-s3api-016", "document_id": "core_extensions-httpfs-s3api", "position": 16, "token_count": 108, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/httpfs/s3api.md", "url": "/core_extensions/httpfs/s3api", "title": "S3 API Support", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api"}}
{"chunk_id": "core_extensions-httpfs-s3api-017", "document_id": "core_extensions-httpfs-s3api", "content": "### Platform-Specific Secret Types\n\n#### S3 Secrets\n\nThe httpfs extension supports [Server Side Encryption via the AWS Key Management Service (KMS) on S3](https://docs.aws.amazon.com/AmazonS3/latest/userguide/UsingKMSEncryption.html) using the `KMS_KEY_ID` option:\n\n```sql\nCREATE OR REPLACE SECRET secret (\n TYPE s3,\n PROVIDER credential_chain,\n CHAIN config,\n REGION '⟨eu-west-1⟩',\n KMS_KEY_ID 'arn:aws:kms:⟨region⟩:⟨account_id⟩:⟨key⟩/⟨key_id⟩',\n SCOPE 's3://⟨bucket-sub-path⟩'\n);\n```", "position": 17, "token_count": 180, "has_code": true, "section_hierarchy": ["S3 Secrets"], "metadata": {"chunk_id": "core_extensions-httpfs-s3api-017", "document_id": "core_extensions-httpfs-s3api", "position": 17, "token_count": 180, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["S3 Secrets"], "file_path": "core_extensions/httpfs/s3api.md", "url": "/core_extensions/httpfs/s3api", "title": "S3 API Support", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api#s3-secrets"}}
{"chunk_id": "core_extensions-httpfs-s3api-018", "document_id": "core_extensions-httpfs-s3api", "content": "#### R2 Secrets\n\nWhile [Cloudflare R2](https://www.cloudflare.com/developer-platform/r2) uses the regular S3 API, DuckDB has a special Secret type, `R2`, to make configuring it a bit simpler:\n\n```sql\nCREATE OR REPLACE SECRET secret (\n TYPE r2,\n KEY_ID '⟨AKIAIOSFODNN7EXAMPLE⟩',\n SECRET '⟨wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY⟩',\n ACCOUNT_ID '⟨my_account_id⟩'\n);", "position": 18, "token_count": 142, "has_code": true, "section_hierarchy": ["R2 Secrets"], "metadata": {"chunk_id": "core_extensions-httpfs-s3api-018", "document_id": "core_extensions-httpfs-s3api", "position": 18, "token_count": 142, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["R2 Secrets"], "file_path": "core_extensions/httpfs/s3api.md", "url": "/core_extensions/httpfs/s3api", "title": "S3 API Support", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api#r2-secrets"}}
{"chunk_id": "core_extensions-httpfs-s3api-019", "document_id": "core_extensions-httpfs-s3api", "content": "```\n\nNote the addition of the `ACCOUNT_ID` which is used to generate the correct endpoint URL for you. Also note that `R2` Secrets can also use both the `CONFIG` and `credential_chain` providers. However, since DuckDB uses an AWS client internally, when using `credential_chain`, the client will search for AWS credentials in the standard AWS credential locations (environment variables, credential files, etc.). Therefore, your R2 credentials must be made available as AWS environment variables (`AWS_ACCESS_KEY_ID` and `AWS_SECRET_ACCESS_KEY`) for the credential chain to work properly. Finally, `R2` secrets are only available when using URLs starting with `r2://`, for example:\n\n```sql\nSELECT *\nFROM read_parquet('r2://⟨some-file-that-uses-an-r2-secret⟩.parquet');\n```", "position": 19, "token_count": 227, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-httpfs-s3api-019", "document_id": "core_extensions-httpfs-s3api", "position": 19, "token_count": 227, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/httpfs/s3api.md", "url": "/core_extensions/httpfs/s3api", "title": "S3 API Support", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api"}}
{"chunk_id": "core_extensions-httpfs-s3api-020", "document_id": "core_extensions-httpfs-s3api", "content": "#### GCS Secrets\n\nWhile [Google Cloud Storage](https://cloud.google.com/storage) is accessed by DuckDB using the S3 API, DuckDB has a special Secret type, `GCS`, to make configuring it a bit simpler:\n\n```sql\nCREATE OR REPLACE SECRET secret (\n TYPE gcs,\n KEY_ID '⟨my_hmac_access_id⟩',\n SECRET '⟨my_hmac_secret_key⟩'\n);", "position": 20, "token_count": 108, "has_code": true, "section_hierarchy": ["GCS Secrets"], "metadata": {"chunk_id": "core_extensions-httpfs-s3api-020", "document_id": "core_extensions-httpfs-s3api", "position": 20, "token_count": 108, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["GCS Secrets"], "file_path": "core_extensions/httpfs/s3api.md", "url": "/core_extensions/httpfs/s3api", "title": "S3 API Support", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api#gcs-secrets"}}
{"chunk_id": "core_extensions-httpfs-s3api-021", "document_id": "core_extensions-httpfs-s3api", "content": "```\n\n**Important**: The `KEY_ID` and `SECRET` values must be HMAC keys generated specifically for Google Cloud Storage interoperability. These are not the same as regular GCP service account keys or access tokens. You can create HMAC keys by following the [Google Cloud documentation for managing HMAC keys](https://cloud.google.com/storage/docs/authentication/managing-hmackeys).", "position": 21, "token_count": 99, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-httpfs-s3api-021", "document_id": "core_extensions-httpfs-s3api", "position": 21, "token_count": 99, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/httpfs/s3api.md", "url": "/core_extensions/httpfs/s3api", "title": "S3 API Support", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api"}}
{"chunk_id": "core_extensions-httpfs-s3api-022", "document_id": "core_extensions-httpfs-s3api", "content": "Note that the above secret will automatically have the correct Google Cloud Storage endpoint configured. Also note that `GCS` Secrets can also use both the `CONFIG` and `credential_chain` providers. However, since DuckDB uses an AWS client internally, when using `credential_chain`, the client will search for AWS credentials in the standard AWS credential locations (environment variables, credential files, etc.). Therefore, your GCS HMAC keys must be made available as AWS environment variables (`AWS_ACCESS_KEY_ID` and `AWS_SECRET_ACCESS_KEY`) for the credential chain to work properly. Finally, `GCS` secrets are only available when using URLs starting with `gcs://` or `gs://`, for example:\n\n```sql\nSELECT *\nFROM read_parquet('gcs://⟨some/file/that/uses/a/gcs/secret⟩.parquet');", "position": 22, "token_count": 223, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-httpfs-s3api-022", "document_id": "core_extensions-httpfs-s3api", "position": 22, "token_count": 223, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/httpfs/s3api.md", "url": "/core_extensions/httpfs/s3api", "title": "S3 API Support", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api"}}
{"chunk_id": "core_extensions-httpfs-s3api-023", "document_id": "core_extensions-httpfs-s3api", "content": "```", "position": 23, "token_count": 5, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-httpfs-s3api-023", "document_id": "core_extensions-httpfs-s3api", "position": 23, "token_count": 5, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/httpfs/s3api.md", "url": "/core_extensions/httpfs/s3api", "title": "S3 API Support", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api"}}
{"chunk_id": "core_extensions-httpfs-s3api-024", "document_id": "core_extensions-httpfs-s3api", "content": "## Reading\n\nReading files from S3 is now as simple as:\n\n```sql\nSELECT *\nFROM 's3://⟨your-bucket⟩/⟨filename⟩.⟨extension⟩';\n```\n\n### Partial Reading\n\nThe `httpfs` extension supports [partial reading]({% link docs/stable/core_extensions/httpfs/https.md %}#partial-reading) from S3 buckets.\n\n### Reading Multiple Files\n\nMultiple files are also possible, for example:\n\n```sql\nSELECT *\nFROM read_parquet([\n 's3://⟨your-bucket⟩/⟨filename-1⟩.parquet',\n 's3://⟨your-bucket⟩/⟨filename-2⟩.parquet'\n]);\n```", "position": 24, "token_count": 175, "has_code": true, "section_hierarchy": ["Reading Multiple Files"], "metadata": {"chunk_id": "core_extensions-httpfs-s3api-024", "document_id": "core_extensions-httpfs-s3api", "position": 24, "token_count": 175, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Reading Multiple Files"], "file_path": "core_extensions/httpfs/s3api.md", "url": "/core_extensions/httpfs/s3api", "title": "S3 API Support", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api#reading-multiple-files"}}
{"chunk_id": "core_extensions-httpfs-s3api-025", "document_id": "core_extensions-httpfs-s3api", "content": "### Globbing\n\nFile [globbing]({% link docs/stable/sql/functions/pattern_matching.md %}#globbing) is implemented using the ListObjectsV2 API call and allows to use filesystem-like glob patterns to match multiple files, for example:\n\n```sql\nSELECT *\nFROM read_parquet('s3://⟨your-bucket⟩/*.parquet');\n```\n\nThis query matches all files in the root of the bucket with the [Parquet extension]({% link docs/stable/data/parquet/overview.md %}).\n\nSeveral features for matching are supported, such as `*` to match any number of any character, `?` for any single character or `[0-9]` for a single character in a range of characters:\n\n```sql\nSELECT count(*) FROM read_parquet('s3://⟨your-bucket⟩/folder*/100?/t[0-9].parquet');", "position": 25, "token_count": 235, "has_code": true, "section_hierarchy": ["Globbing"], "metadata": {"chunk_id": "core_extensions-httpfs-s3api-025", "document_id": "core_extensions-httpfs-s3api", "position": 25, "token_count": 235, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Globbing"], "file_path": "core_extensions/httpfs/s3api.md", "url": "/core_extensions/httpfs/s3api", "title": "S3 API Support", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api#globbing"}}
{"chunk_id": "core_extensions-httpfs-s3api-026", "document_id": "core_extensions-httpfs-s3api", "content": "```\n\nA useful feature when using globs is the `filename` option, which adds a column named `filename` that encodes the file that a particular row originated from:\n\n```sql\nSELECT *\nFROM read_parquet('s3://⟨your-bucket⟩/*.parquet', filename = true);\n```\n\nThis could for example result in:\n\n| column_a | column_b | filename |\n|:---|:---|:---|\n| 1 | examplevalue1 | s3://bucket-name/file1.parquet |\n| 2 | examplevalue1 | s3://bucket-name/file2.parquet |", "position": 26, "token_count": 162, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-httpfs-s3api-026", "document_id": "core_extensions-httpfs-s3api", "position": 26, "token_count": 162, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/httpfs/s3api.md", "url": "/core_extensions/httpfs/s3api", "title": "S3 API Support", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api"}}
{"chunk_id": "core_extensions-httpfs-s3api-027", "document_id": "core_extensions-httpfs-s3api", "content": "### Hive Partitioning\n\nDuckDB also offers support for the [Hive partitioning scheme]({% link docs/stable/data/partitioning/hive_partitioning.md %}), which is available when using HTTP(S) and S3 endpoints.", "position": 27, "token_count": 60, "has_code": false, "section_hierarchy": ["Hive Partitioning"], "metadata": {"chunk_id": "core_extensions-httpfs-s3api-027", "document_id": "core_extensions-httpfs-s3api", "position": 27, "token_count": 60, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Hive Partitioning"], "file_path": "core_extensions/httpfs/s3api.md", "url": "/core_extensions/httpfs/s3api", "title": "S3 API Support", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api#hive-partitioning"}}
{"chunk_id": "core_extensions-httpfs-s3api-028", "document_id": "core_extensions-httpfs-s3api", "content": "## Writing\n\nWriting to S3 uses the multipart upload API. This allows DuckDB to robustly upload files at high speed. Writing to S3 works for both CSV and Parquet:\n\n```sql\nCOPY table_name TO 's3://⟨your-bucket⟩/⟨filename⟩.⟨extension⟩';\n```\n\nPartitioned copy to S3 also works:\n\n```sql\nCOPY table TO 's3://⟨your-bucket⟩/partitioned' (\n FORMAT parquet,\n PARTITION_BY (⟨part_col_a⟩, ⟨part_col_b⟩)\n);", "position": 28, "token_count": 137, "has_code": true, "section_hierarchy": ["Writing"], "metadata": {"chunk_id": "core_extensions-httpfs-s3api-028", "document_id": "core_extensions-httpfs-s3api", "position": 28, "token_count": 137, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Writing"], "file_path": "core_extensions/httpfs/s3api.md", "url": "/core_extensions/httpfs/s3api", "title": "S3 API Support", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api#writing"}}
{"chunk_id": "core_extensions-httpfs-s3api-029", "document_id": "core_extensions-httpfs-s3api", "content": "```\n\nAn automatic check is performed for existing files/directories, which is currently quite conservative (and on S3 will add a bit of latency). To disable this check and force writing, an `OVERWRITE_OR_IGNORE` flag is added:\n\n```sql\nCOPY table TO 's3://⟨your-bucket⟩/partitioned' (\n FORMAT parquet,\n PARTITION_BY (⟨part_col_a⟩, ⟨part_col_b⟩),\n OVERWRITE_OR_IGNORE true\n);\n```\n\nThe naming scheme of the written files looks like this:\n\n```sql\ns3://⟨your-bucket⟩/partitioned/part_col_a=⟨val⟩/part_col_b=⟨val⟩/data_⟨thread_number⟩.parquet\n```", "position": 29, "token_count": 180, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "core_extensions-httpfs-s3api-029", "document_id": "core_extensions-httpfs-s3api", "position": 29, "token_count": 180, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "core_extensions/httpfs/s3api.md", "url": "/core_extensions/httpfs/s3api", "title": "S3 API Support", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api"}}
{"chunk_id": "core_extensions-httpfs-s3api-030", "document_id": "core_extensions-httpfs-s3api", "content": "### Configuration\n\nSome additional configuration options exist for the S3 upload, though the default values should suffice for most use cases.\n\n| Name | Description |\n|:---|:---|\n| `s3_uploader_max_parts_per_file` | Used for part size calculation, see [AWS docs](https://docs.aws.amazon.com/AmazonS3/latest/userguide/qfacts.html) |\n| `s3_uploader_max_filesize` | Used for part size calculation, see [AWS docs](https://docs.aws.amazon.com/AmazonS3/latest/userguide/qfacts.html) |\n| `s3_uploader_thread_limit` | Maximum number of uploader threads |", "position": 30, "token_count": 190, "has_code": false, "section_hierarchy": ["Configuration"], "metadata": {"chunk_id": "core_extensions-httpfs-s3api-030", "document_id": "core_extensions-httpfs-s3api", "position": 30, "token_count": 190, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Configuration"], "file_path": "core_extensions/httpfs/s3api.md", "url": "/core_extensions/httpfs/s3api", "title": "S3 API Support", "category": null, "tags": [], "section_url": "/core_extensions/httpfs/s3api#configuration"}}
