{"chunk_id": "sql-functions-window_functions-000", "document_id": "sql-functions-window_functions", "content": "DuckDB supports [window functions](https://en.wikipedia.org/wiki/Window_function_(SQL)), which can use multiple rows to calculate a value for each row.\nWindow functions are [blocking operators]({% link docs/stable/guides/performance/how_to_tune_workloads.md %}#blocking-operators), i.e., they require their entire input to be buffered, making them one of the most memory-intensive operators in SQL.\n\nWindow function are available in SQL since [SQL:2003](https://en.wikipedia.org/wiki/SQL:2003) and are supported by major SQL database systems.", "position": 0, "token_count": 151, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "sql-functions-window_functions-000", "document_id": "sql-functions-window_functions", "position": 0, "token_count": 151, "has_code": false, "overlap_with_previous": false, "section_hierarchy": [], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions"}}
{"chunk_id": "sql-functions-window_functions-001", "document_id": "sql-functions-window_functions", "content": "## Examples\n\nGenerate a `row_number` column to enumerate rows:\n\n```sql\nSELECT row_number() OVER ()\nFROM sales;\n```\n\n> Tip If you only need a number for each row in a table, you can use the [`rowid` pseudocolumn]({% link docs/stable/sql/statements/select.md %}#row-ids).\n\nGenerate a `row_number` column to enumerate rows, ordered by `time`:\n\n```sql\nSELECT row_number() OVER (ORDER BY time)\nFROM sales;\n```\n\nGenerate a `row_number` column to enumerate rows, ordered by `time` and partitioned by `region`:\n\n```sql\nSELECT row_number() OVER (PARTITION BY region ORDER BY time)\nFROM sales;\n```\n\nCompute the difference between the current and the previous-by-`time` `amount`:\n\n```sql\nSELECT amount - lag(amount) OVER (ORDER BY time)\nFROM sales;", "position": 1, "token_count": 226, "has_code": true, "section_hierarchy": ["Examples"], "metadata": {"chunk_id": "sql-functions-window_functions-001", "document_id": "sql-functions-window_functions", "position": 1, "token_count": 226, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Examples"], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions#examples"}}
{"chunk_id": "sql-functions-window_functions-002", "document_id": "sql-functions-window_functions", "content": "```\n\nCompute the difference between the current and the previous-by-`time` `amount`:\n\n```sql\nSELECT amount - lag(amount) OVER (ORDER BY time)\nFROM sales;\n```\n\nCompute the percentage of the total `amount` of sales per `region` for each row:\n\n```sql\nSELECT amount / sum(amount) OVER (PARTITION BY region)\nFROM sales;\n```", "position": 2, "token_count": 90, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-functions-window_functions-002", "document_id": "sql-functions-window_functions", "position": 2, "token_count": 90, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions"}}
{"chunk_id": "sql-functions-window_functions-003", "document_id": "sql-functions-window_functions", "content": "## Syntax\n\nWindow functions can only be used in the `SELECT` clause. To share `OVER` specifications between functions, use the statement's [`WINDOW` clause]({% link docs/stable/sql/query_syntax/window.md %}) and use the `OVER ⟨window_name⟩`{:.language-sql .highlight} syntax.", "position": 3, "token_count": 81, "has_code": false, "section_hierarchy": ["Syntax"], "metadata": {"chunk_id": "sql-functions-window_functions-003", "document_id": "sql-functions-window_functions", "position": 3, "token_count": 81, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Syntax"], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions#syntax"}}
{"chunk_id": "sql-functions-window_functions-004", "document_id": "sql-functions-window_functions", "content": "## General-Purpose Window Functions\n\nThe table below shows the available general window functions.", "position": 4, "token_count": 19, "has_code": false, "section_hierarchy": ["General-Purpose Window Functions"], "metadata": {"chunk_id": "sql-functions-window_functions-004", "document_id": "sql-functions-window_functions", "position": 4, "token_count": 19, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["General-Purpose Window Functions"], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions#general-purpose-window-functions"}}
{"chunk_id": "sql-functions-window_functions-005", "document_id": "sql-functions-window_functions", "content": "| Name | Description |\n|:--|:-------|\n| [`cume_dist([ORDER BY ordering])`](#cume_distorder-by-ordering) | The cumulative distribution: (number of partition rows preceding or peer with current row) / total partition rows. |\n| [`dense_rank()`](#dense_rank) | The rank of the current row *without gaps;* this function counts peer groups. |\n| [`fill(expr [ ORDER BY ordering])`](#fillexpr-order-by-ordering) | Fill in missing values using linear interpolation with `ORDER BY` as the X-axis. |", "position": 5, "token_count": 158, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "sql-functions-window_functions-005", "document_id": "sql-functions-window_functions", "position": 5, "token_count": 158, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions"}}
{"chunk_id": "sql-functions-window_functions-006", "document_id": "sql-functions-window_functions", "content": "| [`first_value(expr[ ORDER BY ordering][ IGNORE NULLS])`](#first_valueexpr-order-by-ordering-ignore-nulls) | Returns `expr` evaluated at the row that is the first row (with a non-null value of `expr` if `IGNORE NULLS` is set) of the window frame. |\n| [`lag(expr[, offset[, default]][ ORDER BY ordering][ IGNORE NULLS])`](#lagexpr-offset-default-order-by-ordering-ignore-nulls) | Returns `expr` evaluated at the row that is `offset` rows (among rows with a non-null value of `expr` if `IGNORE NULLS` is set) before the current row within the window frame; if there is no such row, instead return `default` (which must be of the Same type as `expr`). Both `offset` and `default` are evaluated with respect to the current row. If omitted, `offset` defaults to `1` and default to `NULL`. |", "position": 6, "token_count": 248, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "sql-functions-window_functions-006", "document_id": "sql-functions-window_functions", "position": 6, "token_count": 248, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions"}}
{"chunk_id": "sql-functions-window_functions-007", "document_id": "sql-functions-window_functions", "content": "| [`last_value(expr[ ORDER BY ordering][ IGNORE NULLS])`](#last_valueexpr-order-by-ordering-ignore-nulls) | Returns `expr` evaluated at the row that is the last row (among rows with a non-null value of `expr` if `IGNORE NULLS` is set) of the window frame. |\n| [`lead(expr[, offset[, default]][ ORDER BY ordering][ IGNORE NULLS])`](#leadexpr-offset-default-order-by-ordering-ignore-nulls) | Returns `expr` evaluated at the row that is `offset` rows after the current row (among rows with a non-null value of `expr` if `IGNORE NULLS` is set) within the window frame; if there is no such row, instead return `default` (which must be of the Same type as `expr`). Both `offset` and `default` are evaluated with respect to the current row. If omitted, `offset` defaults to `1` and default to `NULL`. |", "position": 7, "token_count": 248, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "sql-functions-window_functions-007", "document_id": "sql-functions-window_functions", "position": 7, "token_count": 248, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions"}}
{"chunk_id": "sql-functions-window_functions-008", "document_id": "sql-functions-window_functions", "content": "| [`nth_value(expr, nth[ ORDER BY ordering][ IGNORE NULLS])`](#nth_valueexpr-nth-order-by-ordering-ignore-nulls) | Returns `expr` evaluated at the nth row (among rows with a non-null value of `expr` if `IGNORE NULLS` is set) of the window frame (counting from 1); `NULL` if no such row. |\n| [`ntile(num_buckets[ ORDER BY ordering])`](#ntilenum_buckets-order-by-ordering) | An integer ranging from 1 to `num_buckets`, dividing the partition as equally as possible. |\n| [`percent_rank([ORDER BY ordering])`](#percent_rankorder-by-ordering) | The relative rank of the current row: `(rank() - 1) / (total partition rows - 1)`. |", "position": 8, "token_count": 218, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "sql-functions-window_functions-008", "document_id": "sql-functions-window_functions", "position": 8, "token_count": 218, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions"}}
{"chunk_id": "sql-functions-window_functions-009", "document_id": "sql-functions-window_functions", "content": "| [`rank([ORDER BY ordering])`](#rankorder-by-ordering) | The rank of the current row *with gaps;* same as `row_number` of its first peer. |\n| [`row_number([ORDER BY ordering])`](#row_numberorder-by-ordering) | The number of the current row within the partition, counting from 1. |", "position": 9, "token_count": 93, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "sql-functions-window_functions-009", "document_id": "sql-functions-window_functions", "position": 9, "token_count": 93, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions"}}
{"chunk_id": "sql-functions-window_functions-010", "document_id": "sql-functions-window_functions", "content": "#### `cume_dist([ORDER BY ordering])`\n\n| **Description** | The cumulative distribution: (number of partition rows preceding or peer with current row) / total partition rows. If an `ORDER BY` clause is specified, the distribution is computed within the frame using the provided ordering instead of the frame ordering. |\n| **Return type** | `DOUBLE` |\n| **Example** | `cume_dist()` |\n\n#### `dense_rank()`\n\n| **Description** | The rank of the current row *without gaps;* this function counts peer groups. |\n| **Return type** | `BIGINT` |\n| **Example** | `dense_rank()` |\n| **Aliases** | `rank_dense()` |", "position": 10, "token_count": 185, "has_code": false, "section_hierarchy": ["`dense_rank()`"], "metadata": {"chunk_id": "sql-functions-window_functions-010", "document_id": "sql-functions-window_functions", "position": 10, "token_count": 185, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["`dense_rank()`"], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions#denserank"}}
{"chunk_id": "sql-functions-window_functions-011", "document_id": "sql-functions-window_functions", "content": "#### `fill(expr[ ORDER BY ordering])`\n\n| **Description** | Replaces `NULL` values of `expr` with a linear interpolation based on the closest non-`NULL` values and the sort values. Both values must support arithmetic and there must be only one ordering key. For missing values at the ends, linear extrapolation is used. Failure to interpolate results in the `NULL` value being retained. |\n| **Return type** | Same type as `expr` |\n| **Example** | `fill(column)` |", "position": 11, "token_count": 130, "has_code": false, "section_hierarchy": ["`fill(expr[ ORDER BY ordering])`"], "metadata": {"chunk_id": "sql-functions-window_functions-011", "document_id": "sql-functions-window_functions", "position": 11, "token_count": 130, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["`fill(expr[ ORDER BY ordering])`"], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions#fillexpr-order-by-ordering"}}
{"chunk_id": "sql-functions-window_functions-012", "document_id": "sql-functions-window_functions", "content": "#### `first_value(expr[ ORDER BY ordering][ IGNORE NULLS])`\n\n| **Description** | Returns `expr` evaluated at the row that is the first row (with a non-null value of `expr` if `IGNORE NULLS` is set) of the window frame. If an `ORDER BY` clause is specified, the first row number is computed within the frame using the provided ordering instead of the frame ordering. |\n| **Return type** | Same type as `expr` |\n| **Example** | `first_value(column)` |", "position": 12, "token_count": 134, "has_code": false, "section_hierarchy": ["`first_value(expr[ ORDER BY ordering][ IGNORE NULLS])`"], "metadata": {"chunk_id": "sql-functions-window_functions-012", "document_id": "sql-functions-window_functions", "position": 12, "token_count": 134, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["`first_value(expr[ ORDER BY ordering][ IGNORE NULLS])`"], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions#firstvalueexpr-order-by-ordering-ignore-nulls"}}
{"chunk_id": "sql-functions-window_functions-013", "document_id": "sql-functions-window_functions", "content": "#### `lag(expr[, offset[, default]][ ORDER BY ordering][ IGNORE NULLS])`\n\n| **Description** | Returns `expr` evaluated at the row that is `offset` rows (among rows with a non-null value of `expr` if `IGNORE NULLS` is set) before the current row within the window frame; if there is no such row, instead return `default` (which must be of the Same type as `expr`). Both `offset` and `default` are evaluated with respect to the current row. If omitted, `offset` defaults to `1` and default to `NULL`. If an `ORDER BY` clause is specified, the lagged row number is computed within the frame using the provided ordering instead of the frame ordering. |\n| **Return type** | Same type as `expr` |\n| **Example** | `lag(column, 3, 0)` |", "position": 13, "token_count": 215, "has_code": false, "section_hierarchy": ["`lag(expr[, offset[, default]][ ORDER BY ordering][ IGNORE NULLS])`"], "metadata": {"chunk_id": "sql-functions-window_functions-013", "document_id": "sql-functions-window_functions", "position": 13, "token_count": 215, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["`lag(expr[, offset[, default]][ ORDER BY ordering][ IGNORE NULLS])`"], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions#lagexpr-offset-default-order-by-ordering-ignore-nulls"}}
{"chunk_id": "sql-functions-window_functions-014", "document_id": "sql-functions-window_functions", "content": "#### `last_value(expr[ ORDER BY ordering][ IGNORE NULLS])`\n\n| **Description** | Returns `expr` evaluated at the row that is the last row (among rows with a non-null value of `expr` if `IGNORE NULLS` is set) of the window frame. If omitted, `offset` defaults to `1` and default to `NULL`. If an `ORDER BY` clause is specified, the last row is determined within the frame using the provided ordering instead of the frame ordering. |\n| **Return type** | Same type as `expr` |\n| **Example** | `last_value(column)` |", "position": 14, "token_count": 154, "has_code": false, "section_hierarchy": ["`last_value(expr[ ORDER BY ordering][ IGNORE NULLS])`"], "metadata": {"chunk_id": "sql-functions-window_functions-014", "document_id": "sql-functions-window_functions", "position": 14, "token_count": 154, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["`last_value(expr[ ORDER BY ordering][ IGNORE NULLS])`"], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions#lastvalueexpr-order-by-ordering-ignore-nulls"}}
{"chunk_id": "sql-functions-window_functions-015", "document_id": "sql-functions-window_functions", "content": "#### `lead(expr[, offset[, default]][ ORDER BY ordering][ IGNORE NULLS])`\n\n| **Description** | Returns `expr` evaluated at the row that is `offset` rows after the current row (among rows with a non-null value of `expr` if `IGNORE NULLS` is set) within the window frame; if there is no such row, instead return `default` (which must be of the Same type as `expr`). Both `offset` and `default` are evaluated with respect to the current row. If omitted, `offset` defaults to `1` and default to `NULL`. If an `ORDER BY` clause is specified, the leading row number is computed within the frame using the provided ordering instead of the frame ordering. |\n| **Return type** | Same type as `expr` |\n| **Example** | `lead(column, 3, 0)` |", "position": 15, "token_count": 212, "has_code": false, "section_hierarchy": ["`lead(expr[, offset[, default]][ ORDER BY ordering][ IGNORE NULLS])`"], "metadata": {"chunk_id": "sql-functions-window_functions-015", "document_id": "sql-functions-window_functions", "position": 15, "token_count": 212, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["`lead(expr[, offset[, default]][ ORDER BY ordering][ IGNORE NULLS])`"], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions#leadexpr-offset-default-order-by-ordering-ignore-nulls"}}
{"chunk_id": "sql-functions-window_functions-016", "document_id": "sql-functions-window_functions", "content": "#### `nth_value(expr, nth[ ORDER BY ordering][ IGNORE NULLS])`\n\n| **Description** | Returns `expr` evaluated at the nth row (among rows with a non-null value of `expr` if `IGNORE NULLS` is set) of the window frame (counting from 1); `NULL` if no such row. If an `ORDER BY` clause is specified, the nth row number is computed within the frame using the provided ordering instead of the frame ordering. |\n| **Return type** | Same type as `expr` |\n| **Example** | `nth_value(column, 2)` |", "position": 16, "token_count": 154, "has_code": false, "section_hierarchy": ["`nth_value(expr, nth[ ORDER BY ordering][ IGNORE NULLS])`"], "metadata": {"chunk_id": "sql-functions-window_functions-016", "document_id": "sql-functions-window_functions", "position": 16, "token_count": 154, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["`nth_value(expr, nth[ ORDER BY ordering][ IGNORE NULLS])`"], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions#nthvalueexpr-nth-order-by-ordering-ignore-nulls"}}
{"chunk_id": "sql-functions-window_functions-017", "document_id": "sql-functions-window_functions", "content": "#### `ntile(num_buckets[ ORDER BY ordering])`\n\n| **Description** | An integer ranging from 1 to `num_buckets`, dividing the partition as equally as possible. If an `ORDER BY` clause is specified, the ntile is computed within the frame using the provided ordering instead of the frame ordering. |\n| **Return type** | `BIGINT` |\n| **Example** | `ntile(4)` |\n\n#### `percent_rank([ORDER BY ordering])`\n\n| **Description** | The relative rank of the current row: `(rank() - 1) / (total partition rows - 1)`. If an `ORDER BY` clause is specified, the relative rank is computed within the frame using the provided ordering instead of the frame ordering. |\n| **Return type** | `DOUBLE` |\n| **Example** | `percent_rank()` |", "position": 17, "token_count": 213, "has_code": false, "section_hierarchy": ["`percent_rank([ORDER BY ordering])`"], "metadata": {"chunk_id": "sql-functions-window_functions-017", "document_id": "sql-functions-window_functions", "position": 17, "token_count": 213, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["`percent_rank([ORDER BY ordering])`"], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions#percentrankorder-by-ordering"}}
{"chunk_id": "sql-functions-window_functions-018", "document_id": "sql-functions-window_functions", "content": "#### `rank([ORDER BY ordering])`\n\n| **Description** | The rank of the current row *with gaps*; same as `row_number` of its first peer. If an `ORDER BY` clause is specified, the rank is computed within the frame using the provided ordering instead of the frame ordering. |\n| **Return type** | `BIGINT` |\n| **Example** | `rank()` |\n\n#### `row_number([ORDER BY ordering])`\n\n| **Description** | The number of the current row within the partition, counting from 1. If an `ORDER BY` clause is specified, the row number is computed within the frame using the provided ordering instead of the frame ordering. |\n| **Return type** | `BIGINT` |\n| **Example** | `row_number()` |", "position": 18, "token_count": 194, "has_code": false, "section_hierarchy": ["`row_number([ORDER BY ordering])`"], "metadata": {"chunk_id": "sql-functions-window_functions-018", "document_id": "sql-functions-window_functions", "position": 18, "token_count": 194, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["`row_number([ORDER BY ordering])`"], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions#rownumberorder-by-ordering"}}
{"chunk_id": "sql-functions-window_functions-019", "document_id": "sql-functions-window_functions", "content": "## Aggregate Window Functions\n\nAll [aggregate functions]({% link docs/stable/sql/functions/aggregates.md %}) can be used in a windowing context, including the optional [`FILTER` clause]({% link docs/stable/sql/query_syntax/filter.md %}).\nThe `first` and `last` aggregate functions are shadowed by the respective general-purpose window functions, with the minor consequence that the `FILTER` clause is not available for these but `IGNORE NULLS` is.", "position": 19, "token_count": 116, "has_code": false, "section_hierarchy": ["Aggregate Window Functions"], "metadata": {"chunk_id": "sql-functions-window_functions-019", "document_id": "sql-functions-window_functions", "position": 19, "token_count": 116, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Aggregate Window Functions"], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions#aggregate-window-functions"}}
{"chunk_id": "sql-functions-window_functions-020", "document_id": "sql-functions-window_functions", "content": "## DISTINCT Arguments\n\nAll aggregate window functions support using a `DISTINCT` clause for the arguments. When the `DISTINCT` clause is\nprovided, only distinct values are considered in the computation of the aggregate. This is typically used in combination\nwith the `COUNT` aggregate to get the number of distinct elements; but it can be used together with any aggregate\nfunction in the system. There are some aggregates that are insensitive to duplicate values (e.g., `min`, `max`) and for\nthem this clause is parsed and ignored.\n\n```sql\n-- Count the number of distinct users at a given point in time\nSELECT count(DISTINCT name) OVER (ORDER BY time) FROM sales;\n-- Concatenate those distinct users into a list\nSELECT list(DISTINCT name) OVER (ORDER BY time) FROM sales;\n```", "position": 20, "token_count": 176, "has_code": true, "section_hierarchy": ["DISTINCT Arguments"], "metadata": {"chunk_id": "sql-functions-window_functions-020", "document_id": "sql-functions-window_functions", "position": 20, "token_count": 176, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["DISTINCT Arguments"], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions#distinct-arguments"}}
{"chunk_id": "sql-functions-window_functions-021", "document_id": "sql-functions-window_functions", "content": "## ORDER BY Arguments\n\nAll aggregate window functions support using an `ORDER BY` argument clause that is *different* from the window ordering.\nWhen the `ORDER BY` argument clause is provided, the values being aggregated are sorted before applying the function.\nUsually this is not important, but there are some order-sensitive aggregates that can have indeterminate results (e.g.,\n`mode`, `list` and `string_agg`). These can be made deterministic by ordering the arguments. For order-insensitive\naggregates, this clause is parsed and ignored.\n\n```sql\n-- Compute the modal value up to each time, breaking ties in favour of the most recent value.\nSELECT mode(value ORDER BY time DESC) OVER (ORDER BY time) FROM sales;", "position": 21, "token_count": 171, "has_code": true, "section_hierarchy": ["ORDER BY Arguments"], "metadata": {"chunk_id": "sql-functions-window_functions-021", "document_id": "sql-functions-window_functions", "position": 21, "token_count": 171, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["ORDER BY Arguments"], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions#order-by-arguments"}}
{"chunk_id": "sql-functions-window_functions-022", "document_id": "sql-functions-window_functions", "content": "```\n\nThe SQL standard does not provide for using `ORDER BY` with general-purpose window functions, but we have extended all\nof these functions (except `dense_rank`) to accept this syntax and use framing to restrict the range that the secondary\nordering applies to.\n\n```sql\n-- Compare each athlete's time in an event with the best time to date\nSELECT event, date, athlete, time\n first_value(time ORDER BY time DESC) OVER w AS record_time,\n first_value(athlete ORDER BY time DESC) OVER w AS record_athlete,\nFROM meet_results\nWINDOW w AS (PARTITION BY event ORDER BY datetime)\nORDER BY ALL\n```\n\nNote that there is no comma separating the arguments from the `ORDER BY` clause.", "position": 22, "token_count": 163, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-functions-window_functions-022", "document_id": "sql-functions-window_functions", "position": 22, "token_count": 163, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions"}}
{"chunk_id": "sql-functions-window_functions-023", "document_id": "sql-functions-window_functions", "content": "## Nulls\n\nAll [general-purpose window functions](#general-purpose-window-functions) that accept `IGNORE NULLS` respect nulls by default. This default behavior can optionally be made explicit via `RESPECT NULLS`.\n\nIn contrast, all [aggregate window functions](#aggregate-window-functions) (except for `list` and its aliases, which can be made to ignore nulls via a `FILTER`) ignore nulls and do not accept `RESPECT NULLS`. For example, `sum(column) OVER (ORDER BY time) AS cumulativeColumn` computes a cumulative sum where rows with a `NULL` value of `column` have the same value of `cumulativeColumn` as the row that precedes them.", "position": 23, "token_count": 165, "has_code": false, "section_hierarchy": ["Nulls"], "metadata": {"chunk_id": "sql-functions-window_functions-023", "document_id": "sql-functions-window_functions", "position": 23, "token_count": 165, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Nulls"], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions#nulls"}}
{"chunk_id": "sql-functions-window_functions-024", "document_id": "sql-functions-window_functions", "content": "## Evaluation\n\nWindowing works by breaking a relation up into independent *partitions*,\n*ordering* those partitions,\nand then computing a new column for each row as a function of the nearby values.\nSome window functions depend only on the partition boundary and the ordering,\nbut a few (including all the aggregates) also use a *frame*.\nFrames are specified as a number of rows on either side (*preceding* or *following*) of the *current row*.\nThe distance can be specified as a number of *rows*,\nas a *range* of values using the partition's ordering value and a distance,\nor as a number of *groups* (sets of rows with the same sort value).\n\nThe full syntax is shown in the diagram at the top of the page,\nand this diagram visually illustrates computation environment:", "position": 24, "token_count": 174, "has_code": false, "section_hierarchy": ["Evaluation"], "metadata": {"chunk_id": "sql-functions-window_functions-024", "document_id": "sql-functions-window_functions", "position": 24, "token_count": 174, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Evaluation"], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions#evaluation"}}
{"chunk_id": "sql-functions-window_functions-025", "document_id": "sql-functions-window_functions", "content": "### Partition and Ordering\n\nPartitioning breaks the relation up into independent, unrelated pieces.\nPartitioning is optional, and if none is specified then the entire relation is treated as a single partition.\nWindow functions cannot access values outside of the partition containing the row they are being evaluated at.\n\nOrdering is also optional, but without it the results of [general-purpose window functions](#general-purpose-window-functions) and [order-sensitive aggregate functions]({% link docs/stable/sql/functions/aggregates.md %}#order-by-clause-in-aggregate-functions), and the order of [framing](#framing) are not well-defined.\nEach partition is ordered using the same ordering clause.\n\nHere is a table of power generation data, available as a CSV file ([`power-plant-generation-history.csv`]({% link data/power-plant-generation-history.csv %})). To load the data, run:\n\n```sql\nCREATE TABLE \"Generation History\" AS\n FROM 'power-plant-generation-history.csv';", "position": 25, "token_count": 238, "has_code": true, "section_hierarchy": ["Partition and Ordering"], "metadata": {"chunk_id": "sql-functions-window_functions-025", "document_id": "sql-functions-window_functions", "position": 25, "token_count": 238, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Partition and Ordering"], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions#partition-and-ordering"}}
{"chunk_id": "sql-functions-window_functions-026", "document_id": "sql-functions-window_functions", "content": "```\n\nAfter partitioning by plant and ordering by date, it will have this layout:", "position": 26, "token_count": 21, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-functions-window_functions-026", "document_id": "sql-functions-window_functions", "position": 26, "token_count": 21, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions"}}
{"chunk_id": "sql-functions-window_functions-027", "document_id": "sql-functions-window_functions", "content": "| Plant | Date | MWh |\n|:---|:---|---:|\n| Boston | 2019-01-02 | 564337 |\n| Boston | 2019-01-03 | 507405 |\n| Boston | 2019-01-04 | 528523 |\n| Boston | 2019-01-05 | 469538 |\n| Boston | 2019-01-06 | 474163 |\n| Boston | 2019-01-07 | 507213 |\n| Boston | 2019-01-08 | 613040 |\n| Boston | 2019-01-09 | 582588 |\n| Boston | 2019-01-10 | 499506 |\n| Boston | 2019-01-11 | 482014 |\n| Boston | 2019-01-12 | 486134 |\n| Boston | 2019-01-13 | 531518 |", "position": 27, "token_count": 189, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "sql-functions-window_functions-027", "document_id": "sql-functions-window_functions", "position": 27, "token_count": 189, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions"}}
{"chunk_id": "sql-functions-window_functions-028", "document_id": "sql-functions-window_functions", "content": "| Boston | 2019-01-11 | 482014 |\n| Boston | 2019-01-12 | 486134 |\n| Boston | 2019-01-13 | 531518 |\n| Worcester | 2019-01-02 | 118860 |\n| Worcester | 2019-01-03 | 101977 |\n| Worcester | 2019-01-04 | 106054 |\n| Worcester | 2019-01-05 | 92182 |\n| Worcester | 2019-01-06 | 94492 |\n| Worcester | 2019-01-07 | 99932 |\n| Worcester | 2019-01-08 | 118854 |\n| Worcester | 2019-01-09 | 113506 |\n| Worcester | 2019-01-10 | 96644 |\n| Worcester | 2019-01-11 | 93806 |\n| Worcester | 2019-01-12 | 98963 |\n| Worcester | 2019-01-13 | 107170 |", "position": 28, "token_count": 199, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "sql-functions-window_functions-028", "document_id": "sql-functions-window_functions", "position": 28, "token_count": 199, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions"}}
{"chunk_id": "sql-functions-window_functions-029", "document_id": "sql-functions-window_functions", "content": "In what follows,\nwe shall use this table (or small sections of it) to illustrate various pieces of window function evaluation.\n\nThe simplest window function is `row_number()`.\nThis function just computes the 1-based row number within the partition using the query:\n\n```sql\nSELECT\n \"Plant\",\n \"Date\",\n row_number() OVER (PARTITION BY \"Plant\" ORDER BY \"Date\") AS \"Row\"\nFROM \"Generation History\"\nORDER BY 1, 2;", "position": 29, "token_count": 104, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-functions-window_functions-029", "document_id": "sql-functions-window_functions", "position": 29, "token_count": 104, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions"}}
{"chunk_id": "sql-functions-window_functions-030", "document_id": "sql-functions-window_functions", "content": "```\n\nThe result will be the following:\n\n| Plant | Date | Row |\n|:---|:---|---:|\n| Boston | 2019-01-02 | 1 |\n| Boston | 2019-01-03 | 2 |\n| Boston | 2019-01-04 | 3 |\n| ... | ... | ... |\n| Worcester | 2019-01-02 | 1 |\n| Worcester | 2019-01-03 | 2 |\n| Worcester | 2019-01-04 | 3 |\n| ... | ... | ... |\n\nNote that even though the function is computed with an `ORDER BY` clause,\nthe result does not have to be sorted,\nso the `SELECT` also needs to be explicitly sorted if that is desired.", "position": 30, "token_count": 168, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-functions-window_functions-030", "document_id": "sql-functions-window_functions", "position": 30, "token_count": 168, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions"}}
{"chunk_id": "sql-functions-window_functions-031", "document_id": "sql-functions-window_functions", "content": "### Framing\n\nFraming specifies a set of rows relative to each row where the function is evaluated.\nThe distance from the current row is given as an expression either `PRECEDING` or `FOLLOWING` the current row in the order specified by the `ORDER BY` clause in the `OVER` specification.\nThis distance can either be specified as an integral number of `ROWS` or `GROUPS`,\nor as a `RANGE` delta expression. It is invalid for a frame to start after it ends.\nFor a `RANGE` specification, there must be only one ordering expression and it must support subtraction unless only the sentinel boundary values `UNBOUNDED PRECEDING` / `UNBOUNDED FOLLOWING` / `CURRENT ROW` are used.\nUsing the [`EXCLUDE` clause](#exclude-clause), rows comparing equal to the current row in the specified ordering expression (so-called peers) can be excluded from the frame.", "position": 31, "token_count": 190, "has_code": false, "section_hierarchy": ["Framing"], "metadata": {"chunk_id": "sql-functions-window_functions-031", "document_id": "sql-functions-window_functions", "position": 31, "token_count": 190, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Framing"], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions#framing"}}
{"chunk_id": "sql-functions-window_functions-032", "document_id": "sql-functions-window_functions", "content": "The default frame is unbounded (i.e., the entire partition) when no `ORDER BY` clause is present and `RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW` when an `ORDER BY` clause is present. By default, the `CURRENT ROW` boundary value (but not the `CURRENT ROW` in the `EXCLUDE` clause) means the current row and all its peers when `RANGE` or `GROUP` framing are used but it means only the current row when `ROWS` framing is used.", "position": 32, "token_count": 109, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "sql-functions-window_functions-032", "document_id": "sql-functions-window_functions", "position": 32, "token_count": 109, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions"}}
{"chunk_id": "sql-functions-window_functions-033", "document_id": "sql-functions-window_functions", "content": "#### `ROWS` Framing\n\nHere is a simple `ROW` frame query, using an aggregate function:\n\n```sql\nSELECT points,\n sum(points) OVER (\n ROWS BETWEEN 1 PRECEDING\n AND 1 FOLLOWING) AS we\nFROM results;\n```\n\nThis query computes the `sum` of each point and the points on either side of it:\n\nNotice that at the edge of the partition, there are only two values added together.\nThis is because frames are cropped to the edge of the partition.", "position": 33, "token_count": 105, "has_code": true, "section_hierarchy": ["`ROWS` Framing"], "metadata": {"chunk_id": "sql-functions-window_functions-033", "document_id": "sql-functions-window_functions", "position": 33, "token_count": 105, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["`ROWS` Framing"], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions#rows-framing"}}
{"chunk_id": "sql-functions-window_functions-034", "document_id": "sql-functions-window_functions", "content": "#### `RANGE` Framing\n\nReturning to the power data, suppose the data is noisy.\nWe might want to compute a 7 day moving average for each plant to smooth out the noise.\nTo do this, we can use this window query:\n\n```sql\nSELECT \"Plant\", \"Date\",\n avg(\"MWh\") OVER (\n PARTITION BY \"Plant\"\n ORDER BY \"Date\" ASC\n RANGE BETWEEN INTERVAL 3 DAYS PRECEDING\n AND INTERVAL 3 DAYS FOLLOWING)\n AS \"MWh 7-day Moving Average\"\nFROM \"Generation History\"\nORDER BY 1, 2;", "position": 34, "token_count": 120, "has_code": true, "section_hierarchy": ["`RANGE` Framing"], "metadata": {"chunk_id": "sql-functions-window_functions-034", "document_id": "sql-functions-window_functions", "position": 34, "token_count": 120, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["`RANGE` Framing"], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions#range-framing"}}
{"chunk_id": "sql-functions-window_functions-035", "document_id": "sql-functions-window_functions", "content": "```\n\nThis query partitions the data by `Plant` (to keep the different power plants' data separate),\norders each plant's partition by `Date` (to put the energy measurements next to each other),\nand uses a `RANGE` frame of three days on either side of each day for the `avg`\n(to handle any missing days).\nThis is the result:\n\n| Plant | Date | MWh 7-day Moving Average |\n|:---|:---|---:|\n| Boston | 2019-01-02 | 517450.75 |\n| Boston | 2019-01-03 | 508793.20 |\n| Boston | 2019-01-04 | 508529.83 |\n| ... | ... | ... |\n| Boston | 2019-01-13 | 499793.00 |\n| Worcester | 2019-01-02 | 104768.25 |\n| Worcester | 2019-01-03 | 102713.00 |\n| Worcester | 2019-01-04 | 102249.50 |\n| ... | ... | ... |", "position": 35, "token_count": 250, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-functions-window_functions-035", "document_id": "sql-functions-window_functions", "position": 35, "token_count": 250, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions"}}
{"chunk_id": "sql-functions-window_functions-036", "document_id": "sql-functions-window_functions", "content": "#### `GROUPS` Framing\n\nThe third type of framing counts *groups* of rows relative the current row.\nA *group* in this framing is a set of values with identical `ORDER BY` values.\nIf we assume that power is being generated on every day,\nwe can use `GROUPS` framing to compute the moving average of all power generated in the system\nwithout having to resort to date arithmetic:\n\n```sql\nSELECT \"Date\", \"Plant\",\n avg(\"MWh\") OVER (\n ORDER BY \"Date\" ASC\n GROUPS BETWEEN 3 PRECEDING\n AND 3 FOLLOWING)\n AS \"MWh 7-day Moving Average\"\nFROM \"Generation History\"\nORDER BY 1, 2;", "position": 36, "token_count": 144, "has_code": true, "section_hierarchy": ["`GROUPS` Framing"], "metadata": {"chunk_id": "sql-functions-window_functions-036", "document_id": "sql-functions-window_functions", "position": 36, "token_count": 144, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["`GROUPS` Framing"], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions#groups-framing"}}
{"chunk_id": "sql-functions-window_functions-037", "document_id": "sql-functions-window_functions", "content": "```\n\n| Date | Plant | MWh 7-day Moving Average |\n|------------|-----------|-------------------------:|\n| 2019-01-02 | Boston | 311109.500 |\n| 2019-01-02 | Worcester | 311109.500 |\n| 2019-01-03 | Boston | 305753.100 |\n| 2019-01-03 | Worcester | 305753.100 |\n| 2019-01-04 | Boston | 305389.667 |\n| 2019-01-04 | Worcester | 305389.667 |\n| ... | ... | ... |\n| 2019-01-12 | Boston | 309184.900 |\n| 2019-01-12 | Worcester | 309184.900 |\n| 2019-01-13 | Boston | 299469.375 |\n| 2019-01-13 | Worcester | 299469.375 |\n\nNotice how the values for each date are the same.", "position": 37, "token_count": 247, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-functions-window_functions-037", "document_id": "sql-functions-window_functions", "position": 37, "token_count": 247, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions"}}
{"chunk_id": "sql-functions-window_functions-038", "document_id": "sql-functions-window_functions", "content": "#### `EXCLUDE` Clause\n\n`EXCLUDE` is an optional modifier to the frame clause for excluding rows around the `CURRENT ROW`.\nThis is useful when you want to compute some aggregate value of nearby rows\nto see how the current row compares to it.\n\nIn the following example, we want to know how an athlete's time in an event compares to\nthe average of all the times recorded for their event within ±10 days:\n\n```sql\nSELECT\n event,\n date,\n athlete,\n avg(time) OVER w AS recent,\nFROM results\nWINDOW w AS (\n PARTITION BY event\n ORDER BY date\n RANGE BETWEEN INTERVAL 10 DAYS PRECEDING AND INTERVAL 10 DAYS FOLLOWING\n EXCLUDE CURRENT ROW\n)\nORDER BY event, date, athlete;", "position": 38, "token_count": 147, "has_code": true, "section_hierarchy": ["`EXCLUDE` Clause"], "metadata": {"chunk_id": "sql-functions-window_functions-038", "document_id": "sql-functions-window_functions", "position": 38, "token_count": 147, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["`EXCLUDE` Clause"], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions#exclude-clause"}}
{"chunk_id": "sql-functions-window_functions-039", "document_id": "sql-functions-window_functions", "content": "```\n\nThere are four options for `EXCLUDE` that specify how to treat the current row:\n\n* `CURRENT ROW` – exclude just the current row\n* `GROUP` – exclude the current row and all its “peers” (rows that have the same `ORDER BY` value)\n* `TIES` – exclude all peer rows, but _not_ the current row (this makes a hole on either side)\n* `NO OTHERS` – don't exclude anything (the default)\n\nExclusion is implemented for both windowed aggregates as well as for the `first`, `last` and `nth_value` functions.", "position": 39, "token_count": 131, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-functions-window_functions-039", "document_id": "sql-functions-window_functions", "position": 39, "token_count": 131, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions"}}
{"chunk_id": "sql-functions-window_functions-040", "document_id": "sql-functions-window_functions", "content": "### `WINDOW` Clauses\n\nMultiple different `OVER` clauses can be specified in the same `SELECT`, and each will be computed separately.\nOften, however, we want to use the same layout for multiple window functions.\nThe `WINDOW` clause can be used to define a *named* window that can be shared between multiple window functions:\n\n```sql\nSELECT \"Plant\", \"Date\",\n min(\"MWh\") OVER seven AS \"MWh 7-day Moving Minimum\",\n avg(\"MWh\") OVER seven AS \"MWh 7-day Moving Average\",\n max(\"MWh\") OVER seven AS \"MWh 7-day Moving Maximum\"\nFROM \"Generation History\"\nWINDOW seven AS (\n PARTITION BY \"Plant\"\n ORDER BY \"Date\" ASC\n RANGE BETWEEN INTERVAL 3 DAYS PRECEDING\n AND INTERVAL 3 DAYS FOLLOWING)\nORDER BY 1, 2;", "position": 40, "token_count": 184, "has_code": true, "section_hierarchy": ["`WINDOW` Clauses"], "metadata": {"chunk_id": "sql-functions-window_functions-040", "document_id": "sql-functions-window_functions", "position": 40, "token_count": 184, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["`WINDOW` Clauses"], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions#window-clauses"}}
{"chunk_id": "sql-functions-window_functions-041", "document_id": "sql-functions-window_functions", "content": "```\n\nThe three window functions will also share the data layout, which will improve performance.\n\nMultiple windows can be defined in the same `WINDOW` clause by comma-separating them:\n\n```sql\nSELECT \"Plant\", \"Date\",\n min(\"MWh\") OVER seven AS \"MWh 7-day Moving Minimum\",\n avg(\"MWh\") OVER seven AS \"MWh 7-day Moving Average\",\n max(\"MWh\") OVER seven AS \"MWh 7-day Moving Maximum\",\n min(\"MWh\") OVER three AS \"MWh 3-day Moving Minimum\",\n avg(\"MWh\") OVER three AS \"MWh 3-day Moving Average\",\n max(\"MWh\") OVER three AS \"MWh 3-day Moving Maximum\"\nFROM \"Generation History\"\nWINDOW\n seven AS (\n PARTITION BY \"Plant\"\n ORDER BY \"Date\" ASC\n RANGE BETWEEN INTERVAL 3 DAYS PRECEDING\n AND INTERVAL 3 DAYS FOLLOWING),\n three AS (\n PARTITION BY \"Plant\"\n ORDER BY \"Date\" ASC\n RANGE BETWEEN INTERVAL 1 DAYS PRECEDING\n AND INTERVAL 1 DAYS FOLLOWING)\nORDER BY 1, 2;", "position": 41, "token_count": 241, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-functions-window_functions-041", "document_id": "sql-functions-window_functions", "position": 41, "token_count": 241, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions"}}
{"chunk_id": "sql-functions-window_functions-042", "document_id": "sql-functions-window_functions", "content": "```\n\nThe queries above do not use a number of clauses commonly found in select statements, like\n`WHERE`, `GROUP BY`, etc. For more complex queries you can find where `WINDOW` clauses fall in\nthe canonical order of the [`SELECT statement`]({% link docs/stable/sql/statements/select.md %}).", "position": 42, "token_count": 80, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-functions-window_functions-042", "document_id": "sql-functions-window_functions", "position": 42, "token_count": 80, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions"}}
{"chunk_id": "sql-functions-window_functions-043", "document_id": "sql-functions-window_functions", "content": "### Filtering the Results of Window Functions Using `QUALIFY`\n\nWindow functions are executed after the [`WHERE`]({% link docs/stable/sql/query_syntax/where.md %}) and [`HAVING`]({% link docs/stable/sql/query_syntax/having.md %}) clauses have been already evaluated, so it's not possible to use these clauses to filter the results of window functions\nThe [`QUALIFY` clause]({% link docs/stable/sql/query_syntax/qualify.md %}) avoids the need for a subquery or [`WITH` clause]({% link docs/stable/sql/query_syntax/with.md %}) to perform this filtering.", "position": 43, "token_count": 166, "has_code": false, "section_hierarchy": ["Filtering the Results of Window Functions Using `QUALIFY`"], "metadata": {"chunk_id": "sql-functions-window_functions-043", "document_id": "sql-functions-window_functions", "position": 43, "token_count": 166, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Filtering the Results of Window Functions Using `QUALIFY`"], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions#filtering-the-results-of-window-functions-using-qualify"}}
{"chunk_id": "sql-functions-window_functions-044", "document_id": "sql-functions-window_functions", "content": "### Box and Whisker Queries\n\nAll aggregates can be used as windowing functions, including the complex statistical functions.\nThese function implementations have been optimized for windowing,\nand we can use the window syntax to write queries that generate the data for moving box-and-whisker plots:\n\n```sql\nSELECT \"Plant\", \"Date\",\n min(\"MWh\") OVER seven AS \"MWh 7-day Moving Minimum\",\n quantile_cont(\"MWh\", [0.25, 0.5, 0.75]) OVER seven\n AS \"MWh 7-day Moving IQR\",\n max(\"MWh\") OVER seven AS \"MWh 7-day Moving Maximum\",\nFROM \"Generation History\"\nWINDOW seven AS (\n PARTITION BY \"Plant\"\n ORDER BY \"Date\" ASC\n RANGE BETWEEN INTERVAL 3 DAYS PRECEDING\n AND INTERVAL 3 DAYS FOLLOWING)\nORDER BY 1, 2;\n```", "position": 44, "token_count": 201, "has_code": true, "section_hierarchy": ["Box and Whisker Queries"], "metadata": {"chunk_id": "sql-functions-window_functions-044", "document_id": "sql-functions-window_functions", "position": 44, "token_count": 201, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Box and Whisker Queries"], "file_path": "sql/functions/window_functions.md", "url": "/sql/functions/window_functions", "title": "Window Functions", "category": null, "tags": [], "section_url": "/sql/functions/window_functions#box-and-whisker-queries"}}
