{"chunk_id": "clients-python-conversion-000", "document_id": "clients-python-conversion", "content": "This page documents the rules for converting [Python objects to DuckDB](#object-conversion-python-object-to-duckdb) and [DuckDB results to Python](#result-conversion-duckdb-results-to-python).", "position": 0, "token_count": 55, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "clients-python-conversion-000", "document_id": "clients-python-conversion", "position": 0, "token_count": 55, "has_code": false, "overlap_with_previous": false, "section_hierarchy": [], "file_path": "clients/python/conversion.md", "url": "/clients/python/conversion", "title": "Conversion between DuckDB and Python", "category": null, "tags": [], "section_url": "/clients/python/conversion"}}
{"chunk_id": "clients-python-conversion-001", "document_id": "clients-python-conversion", "content": "## Object Conversion: Python Object to DuckDB\n\nThis is a mapping of Python object types to DuckDB [Logical Types]({% link docs/stable/sql/data_types/overview.md %}):\n\n* `None` → `NULL`\n* `bool` → `BOOLEAN`\n* `datetime.timedelta` → `INTERVAL`\n* `str` → `VARCHAR`\n* `bytearray` → `BLOB`\n* `memoryview` → `BLOB`\n* `decimal.Decimal` → `DECIMAL` / `DOUBLE`\n* `uuid.UUID` → `UUID`\n\nThe rest of the conversion rules are as follows.\n\n### `int`\n\nSince integers can be of arbitrary size in Python, there is not a one-to-one conversion possible for ints.\nInstead we perform these casts in order until one succeeds:\n\n* `BIGINT`\n* `INTEGER`\n* `UBIGINT`\n* `UINTEGER`\n* `DOUBLE`\n\nWhen using the DuckDB Value class, it's possible to set a target type, which will influence the conversion.", "position": 1, "token_count": 243, "has_code": false, "section_hierarchy": ["`int`"], "metadata": {"chunk_id": "clients-python-conversion-001", "document_id": "clients-python-conversion", "position": 1, "token_count": 243, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["`int`"], "file_path": "clients/python/conversion.md", "url": "/clients/python/conversion", "title": "Conversion between DuckDB and Python", "category": null, "tags": [], "section_url": "/clients/python/conversion#int"}}
{"chunk_id": "clients-python-conversion-002", "document_id": "clients-python-conversion", "content": "### `float`\n\nThese casts are tried in order until one succeeds:\n\n* `DOUBLE`\n* `FLOAT`\n\n### `datetime.datetime`\n\nFor `datetime` we will check `pandas.isnull` if it's available and return `NULL` if it returns `true`.\nWe check against `datetime.datetime.min` and `datetime.datetime.max` to convert to `-inf` and `+inf` respectively.\n\nIf the `datetime` has tzinfo, we will use `TIMESTAMPTZ`, otherwise it becomes `TIMESTAMP`.\n\n### `datetime.time`\n\nIf the `time` has tzinfo, we will use `TIMETZ`, otherwise it becomes `TIME`.\n\n### `datetime.date`\n\n`date` converts to the `DATE` type.\nWe check against `datetime.date.min` and `datetime.date.max` to convert to `-inf` and `+inf` respectively.", "position": 2, "token_count": 226, "has_code": false, "section_hierarchy": ["`datetime.date`"], "metadata": {"chunk_id": "clients-python-conversion-002", "document_id": "clients-python-conversion", "position": 2, "token_count": 226, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["`datetime.date`"], "file_path": "clients/python/conversion.md", "url": "/clients/python/conversion", "title": "Conversion between DuckDB and Python", "category": null, "tags": [], "section_url": "/clients/python/conversion#datetimedate"}}
{"chunk_id": "clients-python-conversion-003", "document_id": "clients-python-conversion", "content": "### `bytes`\n\n`bytes` converts to `BLOB` by default, when it's used to construct a Value object of type `BITSTRING`, it maps to `BITSTRING` instead.\n\n### `list`\n\n`list` becomes a `LIST` type of the “most permissive” type of its children, for example:\n\n```python\nmy_list_value = [\n 12345,\n \"test\"\n]\n```\n\nWill become `VARCHAR[]` because 12345 can convert to `VARCHAR` but `test` can not convert to `INTEGER`.\n\n```sql\n[12345, test]\n```", "position": 3, "token_count": 145, "has_code": true, "section_hierarchy": ["`list`"], "metadata": {"chunk_id": "clients-python-conversion-003", "document_id": "clients-python-conversion", "position": 3, "token_count": 145, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["`list`"], "file_path": "clients/python/conversion.md", "url": "/clients/python/conversion", "title": "Conversion between DuckDB and Python", "category": null, "tags": [], "section_url": "/clients/python/conversion#list"}}
{"chunk_id": "clients-python-conversion-004", "document_id": "clients-python-conversion", "content": "### `dict`\n\nThe `dict` object can convert to either `STRUCT(...)` or `MAP(..., ...)` depending on its structure.\nIf the dict has a structure similar to:\n\n```python\nimport duckdb\n\nmy_map_dict = {\n \"key\": [\n 1, 2, 3\n ],\n \"value\": [\n \"one\", \"two\", \"three\"\n ]\n}\n\nduckdb.values(my_map_dict)\n```\n\nThen we'll convert it to a `MAP` of key-value pairs of the two lists zipped together.\nThe example above becomes a `MAP(INTEGER, VARCHAR)`:\n\n```text\n┌─────────────────────────┐\n│ {1=one, 2=two, 3=three} │\n│ map(integer, varchar) │\n├─────────────────────────┤\n│ {1=one, 2=two, 3=three} │\n└─────────────────────────┘", "position": 4, "token_count": 204, "has_code": true, "section_hierarchy": ["`dict`"], "metadata": {"chunk_id": "clients-python-conversion-004", "document_id": "clients-python-conversion", "position": 4, "token_count": 204, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["`dict`"], "file_path": "clients/python/conversion.md", "url": "/clients/python/conversion", "title": "Conversion between DuckDB and Python", "category": null, "tags": [], "section_url": "/clients/python/conversion#dict"}}
{"chunk_id": "clients-python-conversion-005", "document_id": "clients-python-conversion", "content": "```\n\nIf the dict is returned by a [function]({% link docs/stable/clients/python/function.md %}),\nthe function will return a `MAP`, therefore the function `return_type` has to be specified. Providing\na return type which cannot convert to `MAP` will raise an error:\n```python\nimport duckdb\nduckdb_conn = duckdb.connect()\n\ndef get_map() -> dict[str,list[str]|list[int]]:\n return {\n \"key\": [\n 1, 2, 3\n ],\n \"value\": [\n \"one\", \"two\", \"three\"\n ]\n }\n\nduckdb_conn.create_function(\"get_map\", get_map, return_type=dict[int, str])\n\nduckdb_conn.sql(\"select get_map()\").show()\n\nduckdb_conn.create_function(\"get_map_error\", get_map)\n\nduckdb_conn.sql(\"select get_map_error()\").show()", "position": 5, "token_count": 250, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "clients-python-conversion-005", "document_id": "clients-python-conversion", "position": 5, "token_count": 250, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "clients/python/conversion.md", "url": "/clients/python/conversion", "title": "Conversion between DuckDB and Python", "category": null, "tags": [], "section_url": "/clients/python/conversion"}}
{"chunk_id": "clients-python-conversion-006", "document_id": "clients-python-conversion", "content": "```\n ```text\n┌─────────────────────────┐\n│ get_map() │\n│ map(bigint, varchar) │\n├─────────────────────────┤\n│ {1=one, 2=two, 3=three} │\n└─────────────────────────┘\n\nConversionException: Conversion Error: Type VARCHAR can't be cast as UNION(u1 VARCHAR[], u2 BIGINT[]). VARCHAR can't be implicitly cast to any of the union member types: VARCHAR[], BIGINT[]\n```\n\n> The names of the fields matter and the two lists need to have the same size.\n\nOtherwise we'll try to convert it to a `STRUCT`.\n\n```python\nimport duckdb\n\nmy_struct_dict = {\n 1: \"one\",\n \"2\": 2,\n \"three\": [1, 2, 3],\n False: True\n}\n\nduckdb.values(my_struct_dict)", "position": 6, "token_count": 203, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "clients-python-conversion-006", "document_id": "clients-python-conversion", "position": 6, "token_count": 203, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "clients/python/conversion.md", "url": "/clients/python/conversion", "title": "Conversion between DuckDB and Python", "category": null, "tags": [], "section_url": "/clients/python/conversion"}}
{"chunk_id": "clients-python-conversion-007", "document_id": "clients-python-conversion", "content": "```\nBecomes:\n\n```text\n┌────────────────────────────────────────────────────────────────────┐\n│ {'1': 'one', '2': 2, 'three': [1, 2, 3], 'False': true} │\n│ struct(\"1\" varchar, \"2\" integer, three integer[], \"false\" boolean) │\n├────────────────────────────────────────────────────────────────────┤\n│ {'1': one, '2': 2, 'three': [1, 2, 3], 'False': true} │\n└────────────────────────────────────────────────────────────────────┘", "position": 7, "token_count": 111, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "clients-python-conversion-007", "document_id": "clients-python-conversion", "position": 7, "token_count": 111, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "clients/python/conversion.md", "url": "/clients/python/conversion", "title": "Conversion between DuckDB and Python", "category": null, "tags": [], "section_url": "/clients/python/conversion"}}
{"chunk_id": "clients-python-conversion-008", "document_id": "clients-python-conversion", "content": "```\n\nIf the dict is returned by a [function]({% link docs/stable/clients/python/function.md %}),\nthe function will return a `MAP`, due to [automatic conversion]({% link docs/stable/clients/python/types.md %}#dictkey_type-value_type).\nTo return a `STRUCT`, the `return_type` has to be provided:\n```python\nimport duckdb\nfrom duckdb.sqltypes import BOOLEAN, INTEGER, VARCHAR\nfrom duckdb import list_type, struct_type\n\nduckdb_conn = duckdb.connect()\n\nmy_struct_dict = {\n 1: \"one\",\n \"2\": 2,\n \"three\": [1, 2, 3],\n False: True\n}\n\ndef get_struct() -> dict[str|int|bool,str|int|list[int]|bool]:\n return my_struct_dict", "position": 8, "token_count": 231, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "clients-python-conversion-008", "document_id": "clients-python-conversion", "position": 8, "token_count": 231, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "clients/python/conversion.md", "url": "/clients/python/conversion", "title": "Conversion between DuckDB and Python", "category": null, "tags": [], "section_url": "/clients/python/conversion"}}
{"chunk_id": "clients-python-conversion-009", "document_id": "clients-python-conversion", "content": "def get_struct() -> dict[str|int|bool,str|int|list[int]|bool]:\n return my_struct_dict\n\nduckdb_conn.create_function(\"get_struct_as_map\", get_struct)\n\nduckdb_conn.sql(\"select get_struct_as_map()\").show()\n\nduckdb_conn.create_function(\"get_struct\", get_struct, return_type=struct_type({\n 1: VARCHAR,\n \"2\": INTEGER,\n \"three\": list_type(INTEGER),\n False: BOOLEAN\n}))\n\nduckdb_conn.sql(\"select get_struct()\").show()", "position": 9, "token_count": 189, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "clients-python-conversion-009", "document_id": "clients-python-conversion", "position": 9, "token_count": 189, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "clients/python/conversion.md", "url": "/clients/python/conversion", "title": "Conversion between DuckDB and Python", "category": null, "tags": [], "section_url": "/clients/python/conversion"}}
{"chunk_id": "clients-python-conversion-010", "document_id": "clients-python-conversion", "content": "```\n\n```text\n┌──────────────────────────────────────────────────────────────────────────────────────────────────────┐\n│ get_struct_as_map() │\n│ map(union(u1 varchar, u2 bigint, u3 boolean), union(u1 varchar, u2 bigint, u3 bigint[], u4 boolean)) │\n├──────────────────────────────────────────────────────────────────────────────────────────────────────┤\n│ {1=one, 2=2, three=[1, 2, 3], false=true} │\n└──────────────────────────────────────────────────────────────────────────────────────────────────────┘\n\n┌────────────────────────────────────────────────────────────────────┐\n│ get_struct() │\n│ struct(\"1\" varchar, \"2\" integer, three integer[], \"false\" boolean) │\n├────────────────────────────────────────────────────────────────────┤\n│ {'1': one, '2': 2, 'three': [1, 2, 3], 'False': true} │\n└────────────────────────────────────────────────────────────────────┘\n```\n> Every `key` of the dictionary is converted to string.", "position": 10, "token_count": 187, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "clients-python-conversion-010", "document_id": "clients-python-conversion", "position": 10, "token_count": 187, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "clients/python/conversion.md", "url": "/clients/python/conversion", "title": "Conversion between DuckDB and Python", "category": null, "tags": [], "section_url": "/clients/python/conversion"}}
{"chunk_id": "clients-python-conversion-011", "document_id": "clients-python-conversion", "content": "### `tuple`\n\n`tuple` converts to `LIST` by default, when it's used to construct a Value object of type `STRUCT` it will convert to `STRUCT` instead.\n\n### `numpy.ndarray` and `numpy.datetime64`\n\n`ndarray` and `datetime64` are converted by calling `tolist()` and converting the result of that.", "position": 11, "token_count": 99, "has_code": false, "section_hierarchy": ["`numpy.ndarray` and `numpy.datetime64`"], "metadata": {"chunk_id": "clients-python-conversion-011", "document_id": "clients-python-conversion", "position": 11, "token_count": 99, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["`numpy.ndarray` and `numpy.datetime64`"], "file_path": "clients/python/conversion.md", "url": "/clients/python/conversion", "title": "Conversion between DuckDB and Python", "category": null, "tags": [], "section_url": "/clients/python/conversion#numpyndarray-and-numpydatetime64"}}
{"chunk_id": "clients-python-conversion-012", "document_id": "clients-python-conversion", "content": "## Result Conversion: DuckDB Results to Python\n\nDuckDB's Python client provides multiple additional methods that can be used to efficiently retrieve data.\n\n### NumPy\n\n* `fetchnumpy()` fetches the data as a dictionary of NumPy arrays\n\n### Pandas\n\n* `df()` fetches the data as a Pandas DataFrame\n* `fetchdf()` is an alias of `df()`\n* `fetch_df()` is an alias of `df()`\n* `fetch_df_chunk(vector_multiple)` fetches a portion of the results into a DataFrame. The number of rows returned in each chunk is the vector size (2048 by default) * vector_multiple (1 by default).", "position": 12, "token_count": 169, "has_code": false, "section_hierarchy": ["Pandas"], "metadata": {"chunk_id": "clients-python-conversion-012", "document_id": "clients-python-conversion", "position": 12, "token_count": 169, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Pandas"], "file_path": "clients/python/conversion.md", "url": "/clients/python/conversion", "title": "Conversion between DuckDB and Python", "category": null, "tags": [], "section_url": "/clients/python/conversion#pandas"}}
{"chunk_id": "clients-python-conversion-013", "document_id": "clients-python-conversion", "content": "### Apache Arrow\n\n* `arrow()` fetches the data as an [Arrow table](https://arrow.apache.org/docs/python/generated/pyarrow.Table.html)\n* `fetch_arrow_table()` is an alias of `arrow()`\n* `fetch_record_batch(chunk_size)` returns an [Arrow record batch reader](https://arrow.apache.org/docs/python/generated/pyarrow.ipc.RecordBatchStreamReader.html) with `chunk_size` rows per batch\n\n### Polars\n\n* `pl()` fetches the data as a Polars DataFrame", "position": 13, "token_count": 153, "has_code": false, "section_hierarchy": ["Polars"], "metadata": {"chunk_id": "clients-python-conversion-013", "document_id": "clients-python-conversion", "position": 13, "token_count": 153, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Polars"], "file_path": "clients/python/conversion.md", "url": "/clients/python/conversion", "title": "Conversion between DuckDB and Python", "category": null, "tags": [], "section_url": "/clients/python/conversion#polars"}}
{"chunk_id": "clients-python-conversion-014", "document_id": "clients-python-conversion", "content": "### Examples\n\nBelow are some examples using this functionality. See the [Python guides]({% link docs/stable/guides/overview.md %}#python-client) for more examples.\n\nFetch as Pandas DataFrame:\n\n```python\ndf = con.execute(\"SELECT * FROM items\").fetchdf()\nprint(df)\n```\n\n```text\n item value count\n0 jeans 20.0 1\n1 hammer 42.2 2\n2 laptop 2000.0 1\n3 chainsaw 500.0 10\n4 iphone 300.0 2\n```\n\nFetch as dictionary of NumPy arrays:\n\n```python\narr = con.execute(\"SELECT * FROM items\").fetchnumpy()\nprint(arr)", "position": 14, "token_count": 162, "has_code": true, "section_hierarchy": ["Examples"], "metadata": {"chunk_id": "clients-python-conversion-014", "document_id": "clients-python-conversion", "position": 14, "token_count": 162, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Examples"], "file_path": "clients/python/conversion.md", "url": "/clients/python/conversion", "title": "Conversion between DuckDB and Python", "category": null, "tags": [], "section_url": "/clients/python/conversion#examples"}}
{"chunk_id": "clients-python-conversion-015", "document_id": "clients-python-conversion", "content": "```\n\nFetch as dictionary of NumPy arrays:\n\n```python\narr = con.execute(\"SELECT * FROM items\").fetchnumpy()\nprint(arr)\n```\n\n```text\n{'item': masked_array(data=['jeans', 'hammer', 'laptop', 'chainsaw', 'iphone'],\n mask=[False, False, False, False, False],\n fill_value='?',\n dtype=object), 'value': masked_array(data=[20.0, 42.2, 2000.0, 500.0, 300.0],\n mask=[False, False, False, False, False],\n fill_value=1e+20), 'count': masked_array(data=[1, 2, 1, 10, 2],\n mask=[False, False, False, False, False],\n fill_value=999999,\n dtype=int32)}", "position": 15, "token_count": 220, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "clients-python-conversion-015", "document_id": "clients-python-conversion", "position": 15, "token_count": 220, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "clients/python/conversion.md", "url": "/clients/python/conversion", "title": "Conversion between DuckDB and Python", "category": null, "tags": [], "section_url": "/clients/python/conversion"}}
{"chunk_id": "clients-python-conversion-016", "document_id": "clients-python-conversion", "content": "```\n\nFetch as an Arrow table. Converting to Pandas afterwards just for pretty printing:\n\n```python\ntbl = con.execute(\"SELECT * FROM items\").fetch_arrow_table()\nprint(tbl.to_pandas())\n```\n\n```text\n item value count\n0 jeans 20.00 1\n1 hammer 42.20 2\n2 laptop 2000.00 1\n3 chainsaw 500.00 10\n4 iphone 300.00 2\n```", "position": 16, "token_count": 103, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "clients-python-conversion-016", "document_id": "clients-python-conversion", "position": 16, "token_count": 103, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "clients/python/conversion.md", "url": "/clients/python/conversion", "title": "Conversion between DuckDB and Python", "category": null, "tags": [], "section_url": "/clients/python/conversion"}}
