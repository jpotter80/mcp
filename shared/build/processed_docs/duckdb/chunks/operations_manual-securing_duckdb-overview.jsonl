{"chunk_id": "operations_manual-securing_duckdb-overview-000", "document_id": "operations_manual-securing_duckdb-overview", "content": "DuckDB is quite powerful, which can be problematic, especially if untrusted SQL queries are run, e.g., from public-facing user inputs.\nThis page lists some options to restrict the potential fallout from malicious SQL queries.\n\nThe approach to securing DuckDB varies depending on your use case, environment, and potential attack models.\nTherefore, consider the security-related configuration options carefully, especially when working with confidential datasets.\n\nIf you plan to embed DuckDB in your application, please consult the [“Embedding DuckDB”]({% link docs/stable/operations_manual/securing_duckdb/embedding_duckdb.md %}) page.\n\n## Reporting Vulnerabilities\n\nIf you discover a potential vulnerability, please [report it confidentially via GitHub](https://github.com/duckdb/duckdb/security/advisories/new).", "position": 0, "token_count": 197, "has_code": false, "section_hierarchy": ["Reporting Vulnerabilities"], "metadata": {"chunk_id": "operations_manual-securing_duckdb-overview-000", "document_id": "operations_manual-securing_duckdb-overview", "position": 0, "token_count": 197, "has_code": false, "overlap_with_previous": false, "section_hierarchy": ["Reporting Vulnerabilities"], "file_path": "operations_manual/securing_duckdb/overview.md", "url": "/operations_manual/securing_duckdb/overview", "title": "Securing DuckDB", "category": null, "tags": [], "section_url": "/operations_manual/securing_duckdb/overview#reporting-vulnerabilities"}}
{"chunk_id": "operations_manual-securing_duckdb-overview-001", "document_id": "operations_manual-securing_duckdb-overview", "content": "## Safe Mode (CLI)\n\nDuckDB's CLI client supports [“safe mode”]({% link docs/stable/clients/cli/safe_mode.md %}), which prevents DuckDB from accessing external files other than the database file.\nThis can be activated via a command line argument or a [dot command]({% link docs/stable/clients/cli/dot_commands.md %}):\n\n```batch\nduckdb -safe ...\n```\n\n```plsql\n.safe_mode\n```", "position": 1, "token_count": 128, "has_code": true, "section_hierarchy": ["Safe Mode (CLI)"], "metadata": {"chunk_id": "operations_manual-securing_duckdb-overview-001", "document_id": "operations_manual-securing_duckdb-overview", "position": 1, "token_count": 128, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Safe Mode (CLI)"], "file_path": "operations_manual/securing_duckdb/overview.md", "url": "/operations_manual/securing_duckdb/overview", "title": "Securing DuckDB", "category": null, "tags": [], "section_url": "/operations_manual/securing_duckdb/overview#safe-mode-cli"}}
{"chunk_id": "operations_manual-securing_duckdb-overview-002", "document_id": "operations_manual-securing_duckdb-overview", "content": "## Restricting File Access\n\nDuckDB can list directories and read arbitrary files via its CSV parser’s [`read_csv` function]({% link docs/stable/data/csv/overview.md %}) or read text via the [`read_text` function]({% link docs/stable/sql/functions/text.md %}#read_textsource).\nThis makes it possible to read from the local file system, for example:\n\n```sql\nSELECT *\nFROM read_csv('/etc/passwd', sep = ':');\n```", "position": 2, "token_count": 138, "has_code": true, "section_hierarchy": ["Restricting File Access"], "metadata": {"chunk_id": "operations_manual-securing_duckdb-overview-002", "document_id": "operations_manual-securing_duckdb-overview", "position": 2, "token_count": 138, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Restricting File Access"], "file_path": "operations_manual/securing_duckdb/overview.md", "url": "/operations_manual/securing_duckdb/overview", "title": "Securing DuckDB", "category": null, "tags": [], "section_url": "/operations_manual/securing_duckdb/overview#restricting-file-access"}}
{"chunk_id": "operations_manual-securing_duckdb-overview-003", "document_id": "operations_manual-securing_duckdb-overview", "content": "### Disabling File Access\n\nFiles access can be disabled in two ways. First, you can disable individual file systems. For example:\n\n```sql\nSET disabled_filesystems = 'LocalFileSystem';\n```\n\nSecond, you can also completely disable external access by setting the [`enable_external_access` option]({% link docs/stable/configuration/overview.md %}#configuration-reference) option to `false`.\n\n```sql\nSET enable_external_access = false;\n```\n\nThis setting implies that:\n\n* `ATTACH` cannot attach to a database in a file.\n* `COPY` cannot read to or write from files.\n* Functions such as `read_csv`, `read_parquet`, `read_json`, etc. cannot read from an external source.", "position": 3, "token_count": 185, "has_code": true, "section_hierarchy": ["Disabling File Access"], "metadata": {"chunk_id": "operations_manual-securing_duckdb-overview-003", "document_id": "operations_manual-securing_duckdb-overview", "position": 3, "token_count": 185, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Disabling File Access"], "file_path": "operations_manual/securing_duckdb/overview.md", "url": "/operations_manual/securing_duckdb/overview", "title": "Securing DuckDB", "category": null, "tags": [], "section_url": "/operations_manual/securing_duckdb/overview#disabling-file-access"}}
{"chunk_id": "operations_manual-securing_duckdb-overview-004", "document_id": "operations_manual-securing_duckdb-overview", "content": "### The `allowed_directories` and `allowed_paths` Options\n\nYou can restrict DuckDB's access to certain directories or files using the `allowed_directories` and `allowed_paths` options (respectively).\nThese options allows fine-grained access control for the file system.\nFor example, you can set DuckDB to only use the `/tmp` directory.\n\n```sql\nSET allowed_directories = ['/tmp'];\nSET enable_external_access = false;\nFROM read_csv('test.csv');\n```\n\nWith the setting applied, DuckDB will refuse to read files in the current working directory:\n\n```console\nPermission Error:\nCannot access file \"test.csv\" - file system operations are disabled by configuration\n```", "position": 4, "token_count": 174, "has_code": true, "section_hierarchy": ["The `allowed_directories` and `allowed_paths` Options"], "metadata": {"chunk_id": "operations_manual-securing_duckdb-overview-004", "document_id": "operations_manual-securing_duckdb-overview", "position": 4, "token_count": 174, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["The `allowed_directories` and `allowed_paths` Options"], "file_path": "operations_manual/securing_duckdb/overview.md", "url": "/operations_manual/securing_duckdb/overview", "title": "Securing DuckDB", "category": null, "tags": [], "section_url": "/operations_manual/securing_duckdb/overview#the-alloweddirectories-and-allowedpaths-options"}}
{"chunk_id": "operations_manual-securing_duckdb-overview-005", "document_id": "operations_manual-securing_duckdb-overview", "content": "## Secrets\n\n[Secrets]({% link docs/stable/configuration/secrets_manager.md %}) are used to manage credentials to log into third party services like AWS or Azure. DuckDB can show a list of secrets using the `duckdb_secrets()` table function. This will redact any sensitive information such as security keys by default. The `allow_unredacted_secrets` option can be set to show all information contained within a security key. It is recommended not to turn on this option if you are running untrusted SQL input.\n\nQueries can access the secrets defined in the Secrets Manager. For example, if there is a secret defined to authenticate with a user, who has write privileges to a given AWS S3 bucket, queries may write to that bucket. This is applicable for both persistent and temporary secrets.", "position": 5, "token_count": 182, "has_code": false, "section_hierarchy": ["Secrets"], "metadata": {"chunk_id": "operations_manual-securing_duckdb-overview-005", "document_id": "operations_manual-securing_duckdb-overview", "position": 5, "token_count": 182, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Secrets"], "file_path": "operations_manual/securing_duckdb/overview.md", "url": "/operations_manual/securing_duckdb/overview", "title": "Securing DuckDB", "category": null, "tags": [], "section_url": "/operations_manual/securing_duckdb/overview#secrets"}}
{"chunk_id": "operations_manual-securing_duckdb-overview-006", "document_id": "operations_manual-securing_duckdb-overview", "content": "[Persistent secrets]({% link docs/stable/configuration/secrets_manager.md %}#persistent-secrets) are stored in unencrypted binary format on the disk. These have the same permissions as SSH keys, `600`, i.e., only user who is running the DuckDB (parent) process can read and write them.", "position": 6, "token_count": 81, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "operations_manual-securing_duckdb-overview-006", "document_id": "operations_manual-securing_duckdb-overview", "position": 6, "token_count": 81, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "operations_manual/securing_duckdb/overview.md", "url": "/operations_manual/securing_duckdb/overview", "title": "Securing DuckDB", "category": null, "tags": [], "section_url": "/operations_manual/securing_duckdb/overview"}}
{"chunk_id": "operations_manual-securing_duckdb-overview-007", "document_id": "operations_manual-securing_duckdb-overview", "content": "## Locking Configurations\n\nSecurity-related configuration settings generally lock themselves for safety reasons. For example, while we can disable [community extensions]({% link community_extensions/index.md %}) using the `SET allow_community_extensions = false`, we cannot re-enable them again after the fact without restarting the database. Trying to do so will result in an error:\n\n```console\nInvalid Input Error: Cannot upgrade allow_community_extensions setting while database is running\n```\n\nThis prevents untrusted SQL input from re-enabling settings that were explicitly disabled for security reasons.\n\nNevertheless, many configuration settings do not disable themselves, such as the resource constraints. If you allow users to run SQL statements unrestricted on your own hardware, it is recommended that you lock the configuration after your own configuration has finished using the following command:\n\n```sql\nSET lock_configuration = true;\n```\n\nThis prevents any configuration settings from being modified from that point onwards.", "position": 7, "token_count": 204, "has_code": true, "section_hierarchy": ["Locking Configurations"], "metadata": {"chunk_id": "operations_manual-securing_duckdb-overview-007", "document_id": "operations_manual-securing_duckdb-overview", "position": 7, "token_count": 204, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Locking Configurations"], "file_path": "operations_manual/securing_duckdb/overview.md", "url": "/operations_manual/securing_duckdb/overview", "title": "Securing DuckDB", "category": null, "tags": [], "section_url": "/operations_manual/securing_duckdb/overview#locking-configurations"}}
{"chunk_id": "operations_manual-securing_duckdb-overview-008", "document_id": "operations_manual-securing_duckdb-overview", "content": "## Prepared Statements to Prevent SQL Injection\n\nSimilarly to other SQL databases, it's recommended to use [prepared statements]({% link docs/stable/sql/query_syntax/prepared_statements.md %}) in DuckDB to prevent [SQL injection](https://en.wikipedia.org/wiki/SQL_injection).\n\n**Therefore, avoid concatenating strings for queries:**\n\n```python\nimport duckdb\nduckdb.execute(\"SELECT * FROM (VALUES (32, 'a'), (42, 'b')) t(x) WHERE x = \" + str(42)).fetchall()\n```\n\n**Instead, use prepared statements:**\n\n```python\nimport duckdb\nduckdb.execute(\"SELECT * FROM (VALUES (32, 'a'), (42, 'b')) t(x) WHERE x = ?\", [42]).fetchall()\n```", "position": 8, "token_count": 216, "has_code": true, "section_hierarchy": ["Prepared Statements to Prevent SQL Injection"], "metadata": {"chunk_id": "operations_manual-securing_duckdb-overview-008", "document_id": "operations_manual-securing_duckdb-overview", "position": 8, "token_count": 216, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Prepared Statements to Prevent SQL Injection"], "file_path": "operations_manual/securing_duckdb/overview.md", "url": "/operations_manual/securing_duckdb/overview", "title": "Securing DuckDB", "category": null, "tags": [], "section_url": "/operations_manual/securing_duckdb/overview#prepared-statements-to-prevent-sql-injection"}}
{"chunk_id": "operations_manual-securing_duckdb-overview-009", "document_id": "operations_manual-securing_duckdb-overview", "content": "## Constrain Resource Usage\n\nDuckDB can use quite a lot of CPU, RAM, and disk space. To avoid denial of service attacks, these resources can be limited.\n\nThe number of CPU threads that DuckDB can use can be set using, for example:\n\n```sql\nSET threads = 4;\n```\n\nWhere 4 is the number of allowed threads.\n\nThe maximum amount of memory (RAM) can also be limited, for example:\n\n```sql\nSET memory_limit = '4GB';\n```\n\nThe size of the temporary file directory can be limited with:\n\n```sql\nSET max_temp_directory_size = '4GB';\n```\n\n## Extensions\n\nDuckDB has a powerful extension mechanism, which have the same privileges as the user running DuckDB's (parent) process.\nThis introduces security considerations. Therefore, we recommend reviewing the configuration options for [securing extensions]({% link docs/stable/operations_manual/securing_duckdb/securing_extensions.md %}).", "position": 9, "token_count": 218, "has_code": true, "section_hierarchy": ["Extensions"], "metadata": {"chunk_id": "operations_manual-securing_duckdb-overview-009", "document_id": "operations_manual-securing_duckdb-overview", "position": 9, "token_count": 218, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Extensions"], "file_path": "operations_manual/securing_duckdb/overview.md", "url": "/operations_manual/securing_duckdb/overview", "title": "Securing DuckDB", "category": null, "tags": [], "section_url": "/operations_manual/securing_duckdb/overview#extensions"}}
{"chunk_id": "operations_manual-securing_duckdb-overview-010", "document_id": "operations_manual-securing_duckdb-overview", "content": "## Privileges\n\nAvoid running DuckDB as a root user (e.g., using `sudo`).\nThere is no good reason to run DuckDB as root.\n\n## Generic Solutions\n\nSecuring DuckDB can also be supported via proven means, for example:\n\n* Scoping user privileges via [`chroot`](https://en.wikipedia.org/wiki/Chroot), relying on the operating system\n* Containerization, e.g., via Docker or Podman. See the [“DuckDB Docker Container” page]({% link docs/stable/operations_manual/duckdb_docker.md %})\n* Running DuckDB in WebAssembly", "position": 10, "token_count": 153, "has_code": false, "section_hierarchy": ["Generic Solutions"], "metadata": {"chunk_id": "operations_manual-securing_duckdb-overview-010", "document_id": "operations_manual-securing_duckdb-overview", "position": 10, "token_count": 153, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Generic Solutions"], "file_path": "operations_manual/securing_duckdb/overview.md", "url": "/operations_manual/securing_duckdb/overview", "title": "Securing DuckDB", "category": null, "tags": [], "section_url": "/operations_manual/securing_duckdb/overview#generic-solutions"}}
