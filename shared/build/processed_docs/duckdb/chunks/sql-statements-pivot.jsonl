{"chunk_id": "sql-statements-pivot-000", "document_id": "sql-statements-pivot", "content": "The `PIVOT` statement allows distinct values within a column to be separated into their own columns.\nThe values within those new columns are calculated using an aggregate function on the subset of rows that match each distinct value.\n\nDuckDB implements both the SQL Standard `PIVOT` syntax and a simplified `PIVOT` syntax that automatically detects the columns to create while pivoting.\n`PIVOT_WIDER` may also be used in place of the `PIVOT` keyword.\n\nFor details on how the `PIVOT` statement is implemented, see the [Pivot Internals site]({% link docs/stable/internals/pivot.md %}#pivot).\n\n> The [`UNPIVOT` statement]({% link docs/stable/sql/statements/unpivot.md %}) is the inverse of the `PIVOT` statement.", "position": 0, "token_count": 186, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "sql-statements-pivot-000", "document_id": "sql-statements-pivot", "position": 0, "token_count": 186, "has_code": false, "overlap_with_previous": false, "section_hierarchy": [], "file_path": "sql/statements/pivot.md", "url": "/sql/statements/pivot", "title": "PIVOT Statement", "category": null, "tags": [], "section_url": "/sql/statements/pivot"}}
{"chunk_id": "sql-statements-pivot-001", "document_id": "sql-statements-pivot", "content": "## Simplified `PIVOT` Syntax\n\nThe full syntax diagram is below, but the simplified `PIVOT` syntax can be summarized using spreadsheet pivot table naming conventions as:\n\n```sql\nPIVOT ⟨dataset⟩\nON ⟨columns⟩\nUSING ⟨values⟩\nGROUP BY ⟨rows⟩\nORDER BY ⟨columns_with_order_directions⟩\nLIMIT ⟨number_of_rows⟩;\n```\n\nThe `ON`, `USING`, and `GROUP BY` clauses are each optional, but they may not all be omitted.", "position": 1, "token_count": 112, "has_code": true, "section_hierarchy": ["Simplified `PIVOT` Syntax"], "metadata": {"chunk_id": "sql-statements-pivot-001", "document_id": "sql-statements-pivot", "position": 1, "token_count": 112, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Simplified `PIVOT` Syntax"], "file_path": "sql/statements/pivot.md", "url": "/sql/statements/pivot", "title": "PIVOT Statement", "category": null, "tags": [], "section_url": "/sql/statements/pivot#simplified-pivot-syntax"}}
{"chunk_id": "sql-statements-pivot-002", "document_id": "sql-statements-pivot", "content": "### Example Data\n\nAll examples use the dataset produced by the queries below:\n\n```sql\nCREATE TABLE cities (\n country VARCHAR, name VARCHAR, year INTEGER, population INTEGER\n);\nINSERT INTO cities VALUES\n ('NL', 'Amsterdam', 2000, 1005),\n ('NL', 'Amsterdam', 2010, 1065),\n ('NL', 'Amsterdam', 2020, 1158),\n ('US', 'Seattle', 2000, 564),\n ('US', 'Seattle', 2010, 608),\n ('US', 'Seattle', 2020, 738),\n ('US', 'New York City', 2000, 8015),\n ('US', 'New York City', 2010, 8175),\n ('US', 'New York City', 2020, 8772);\n```\n\n```sql\nSELECT *\nFROM cities;", "position": 2, "token_count": 203, "has_code": true, "section_hierarchy": ["Example Data"], "metadata": {"chunk_id": "sql-statements-pivot-002", "document_id": "sql-statements-pivot", "position": 2, "token_count": 203, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Example Data"], "file_path": "sql/statements/pivot.md", "url": "/sql/statements/pivot", "title": "PIVOT Statement", "category": null, "tags": [], "section_url": "/sql/statements/pivot#example-data"}}
{"chunk_id": "sql-statements-pivot-003", "document_id": "sql-statements-pivot", "content": "```\n\n```sql\nSELECT *\nFROM cities;\n```\n\n| country | name | year | population |\n|---------|---------------|-----:|-----------:|\n| NL | Amsterdam | 2000 | 1005 |\n| NL | Amsterdam | 2010 | 1065 |\n| NL | Amsterdam | 2020 | 1158 |\n| US | Seattle | 2000 | 564 |\n| US | Seattle | 2010 | 608 |\n| US | Seattle | 2020 | 738 |\n| US | New York City | 2000 | 8015 |\n| US | New York City | 2010 | 8175 |\n| US | New York City | 2020 | 8772 |", "position": 3, "token_count": 170, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-statements-pivot-003", "document_id": "sql-statements-pivot", "position": 3, "token_count": 170, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/statements/pivot.md", "url": "/sql/statements/pivot", "title": "PIVOT Statement", "category": null, "tags": [], "section_url": "/sql/statements/pivot"}}
{"chunk_id": "sql-statements-pivot-004", "document_id": "sql-statements-pivot", "content": "### `PIVOT ON` and `USING`\n\nUse the `PIVOT` statement below to create a separate column for each year and calculate the total population in each.\nThe `ON` clause specifies which column(s) to split into separate columns.\nIt is equivalent to the columns parameter in a spreadsheet pivot table.\n\nThe `USING` clause determines how to aggregate the values that are split into separate columns.\nThis is equivalent to the values parameter in a spreadsheet pivot table.\nIf the `USING` clause is not included, it defaults to `count(*)`.\n\n```sql\nPIVOT cities\nON year\nUSING sum(population);", "position": 4, "token_count": 141, "has_code": true, "section_hierarchy": ["`PIVOT ON` and `USING`"], "metadata": {"chunk_id": "sql-statements-pivot-004", "document_id": "sql-statements-pivot", "position": 4, "token_count": 141, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["`PIVOT ON` and `USING`"], "file_path": "sql/statements/pivot.md", "url": "/sql/statements/pivot", "title": "PIVOT Statement", "category": null, "tags": [], "section_url": "/sql/statements/pivot#pivot-on-and-using"}}
{"chunk_id": "sql-statements-pivot-005", "document_id": "sql-statements-pivot", "content": "```\n\n| country | name | 2000 | 2010 | 2020 |\n|---------|---------------|-----:|-----:|-----:|\n| NL | Amsterdam | 1005 | 1065 | 1158 |\n| US | Seattle | 564 | 608 | 738 |\n| US | New York City | 8015 | 8175 | 8772 |\n\nIn the above example, the `sum` aggregate is always operating on a single value.\nIf we only want to change the orientation of how the data is displayed without aggregating, use the `first` aggregate function.\nIn this example, we are pivoting numeric values, but the `first` function works very well for pivoting out a text column.\n(This is something that is difficult to do in a spreadsheet pivot table, but easy in DuckDB!)\n\nThis query produces a result that is identical to the one above:\n\n```sql\nPIVOT cities\nON year\nUSING first(population);", "position": 5, "token_count": 238, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-statements-pivot-005", "document_id": "sql-statements-pivot", "position": 5, "token_count": 238, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/statements/pivot.md", "url": "/sql/statements/pivot", "title": "PIVOT Statement", "category": null, "tags": [], "section_url": "/sql/statements/pivot"}}
{"chunk_id": "sql-statements-pivot-006", "document_id": "sql-statements-pivot", "content": "```\n\n> Note The SQL syntax permits [`FILTER` clauses]({% link docs/stable/sql/query_syntax/filter.md %}) with aggregate functions in the `USING` clause.\n> In DuckDB, the `PIVOT` statement currently does not support these and they are silently ignored.", "position": 6, "token_count": 70, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-statements-pivot-006", "document_id": "sql-statements-pivot", "position": 6, "token_count": 70, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/statements/pivot.md", "url": "/sql/statements/pivot", "title": "PIVOT Statement", "category": null, "tags": [], "section_url": "/sql/statements/pivot"}}
{"chunk_id": "sql-statements-pivot-007", "document_id": "sql-statements-pivot", "content": "### `PIVOT ON`, `USING`, and `GROUP BY`\n\nBy default, the `PIVOT` statement retains all columns not specified in the `ON` or `USING` clauses.\nTo include only certain columns and further aggregate, specify columns in the `GROUP BY` clause.\nThis is equivalent to the rows parameter of a spreadsheet pivot table.\n\nIn the below example, the `name` column is no longer included in the output, and the data is aggregated up to the `country` level.\n\n```sql\nPIVOT cities\nON year\nUSING sum(population)\nGROUP BY country;\n```\n\n| country | 2000 | 2010 | 2020 |\n|---------|-----:|-----:|-----:|\n| NL | 1005 | 1065 | 1158 |\n| US | 8579 | 8783 | 9510 |", "position": 7, "token_count": 200, "has_code": true, "section_hierarchy": ["`PIVOT ON`, `USING`, and `GROUP BY`"], "metadata": {"chunk_id": "sql-statements-pivot-007", "document_id": "sql-statements-pivot", "position": 7, "token_count": 200, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["`PIVOT ON`, `USING`, and `GROUP BY`"], "file_path": "sql/statements/pivot.md", "url": "/sql/statements/pivot", "title": "PIVOT Statement", "category": null, "tags": [], "section_url": "/sql/statements/pivot#pivot-on-using-and-group-by"}}
{"chunk_id": "sql-statements-pivot-008", "document_id": "sql-statements-pivot", "content": "### `IN` Filter for `ON` Clause\n\nTo only create a separate column for specific values within a column in the `ON` clause, use an optional `IN` expression.\nLet's say for example that we wanted to forget about the year 2020 for no particular reason...\n\n```sql\nPIVOT cities\nON year IN (2000, 2010)\nUSING sum(population)\nGROUP BY country;\n```\n\n| country | 2000 | 2010 |\n|---------|-----:|-----:|\n| NL | 1005 | 1065 |\n| US | 8579 | 8783 |", "position": 8, "token_count": 142, "has_code": true, "section_hierarchy": ["`IN` Filter for `ON` Clause"], "metadata": {"chunk_id": "sql-statements-pivot-008", "document_id": "sql-statements-pivot", "position": 8, "token_count": 142, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["`IN` Filter for `ON` Clause"], "file_path": "sql/statements/pivot.md", "url": "/sql/statements/pivot", "title": "PIVOT Statement", "category": null, "tags": [], "section_url": "/sql/statements/pivot#in-filter-for-on-clause"}}
{"chunk_id": "sql-statements-pivot-009", "document_id": "sql-statements-pivot", "content": "### Multiple Expressions per Clause\n\nMultiple columns can be specified in the `ON` and `GROUP BY` clauses, and multiple aggregate expressions can be included in the `USING` clause.", "position": 9, "token_count": 40, "has_code": false, "section_hierarchy": ["Multiple Expressions per Clause"], "metadata": {"chunk_id": "sql-statements-pivot-009", "document_id": "sql-statements-pivot", "position": 9, "token_count": 40, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Multiple Expressions per Clause"], "file_path": "sql/statements/pivot.md", "url": "/sql/statements/pivot", "title": "PIVOT Statement", "category": null, "tags": [], "section_url": "/sql/statements/pivot#multiple-expressions-per-clause"}}
{"chunk_id": "sql-statements-pivot-010", "document_id": "sql-statements-pivot", "content": "#### Multiple `ON` Columns and `ON` Expressions\n\nMultiple columns can be pivoted out into their own columns.\nDuckDB will find the distinct values in each `ON` clause column and create one new column for all combinations of those values (a Cartesian product).\n\nIn the below example, all combinations of unique countries and unique cities receive their own column.\nSome combinations may not be present in the underlying data, so those columns are populated with `NULL` values.\n\n```sql\nPIVOT cities\nON country, name\nUSING sum(population);", "position": 10, "token_count": 118, "has_code": true, "section_hierarchy": ["Multiple `ON` Columns and `ON` Expressions"], "metadata": {"chunk_id": "sql-statements-pivot-010", "document_id": "sql-statements-pivot", "position": 10, "token_count": 118, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Multiple `ON` Columns and `ON` Expressions"], "file_path": "sql/statements/pivot.md", "url": "/sql/statements/pivot", "title": "PIVOT Statement", "category": null, "tags": [], "section_url": "/sql/statements/pivot#multiple-on-columns-and-on-expressions"}}
{"chunk_id": "sql-statements-pivot-011", "document_id": "sql-statements-pivot", "content": "```\n\n| year | NL_Amsterdam | NL_New York City | NL_Seattle | US_Amsterdam | US_New York City | US_Seattle |\n|-----:|-------------:|------------------|------------|--------------|-----------------:|-----------:|\n| 2000 | 1005 | NULL | NULL | NULL | 8015 | 564 |\n| 2010 | 1065 | NULL | NULL | NULL | 8175 | 608 |\n| 2020 | 1158 | NULL | NULL | NULL | 8772 | 738 |\n\nTo pivot only the combinations of values that are present in the underlying data, use an expression in the `ON` clause.\nMultiple expressions and/or columns may be provided.", "position": 11, "token_count": 229, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-statements-pivot-011", "document_id": "sql-statements-pivot", "position": 11, "token_count": 229, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/statements/pivot.md", "url": "/sql/statements/pivot", "title": "PIVOT Statement", "category": null, "tags": [], "section_url": "/sql/statements/pivot"}}
{"chunk_id": "sql-statements-pivot-012", "document_id": "sql-statements-pivot", "content": "To pivot only the combinations of values that are present in the underlying data, use an expression in the `ON` clause.\nMultiple expressions and/or columns may be provided.\n\nHere, `country` and `name` are concatenated together and the resulting concatenations each receive their own column.\nAny arbitrary non-aggregating expression may be used.\nIn this case, concatenating with an underscore is used to imitate the naming convention the `PIVOT` clause uses when multiple `ON` columns are provided (like in the prior example).\n\n```sql\nPIVOT cities\nON country || '_' || name\nUSING sum(population);", "position": 12, "token_count": 144, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-statements-pivot-012", "document_id": "sql-statements-pivot", "position": 12, "token_count": 144, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/statements/pivot.md", "url": "/sql/statements/pivot", "title": "PIVOT Statement", "category": null, "tags": [], "section_url": "/sql/statements/pivot"}}
{"chunk_id": "sql-statements-pivot-013", "document_id": "sql-statements-pivot", "content": "```\n\n| year | NL_Amsterdam | US_New York City | US_Seattle |\n|-----:|-------------:|-----------------:|-----------:|\n| 2000 | 1005 | 8015 | 564 |\n| 2010 | 1065 | 8175 | 608 |\n| 2020 | 1158 | 8772 | 738 |", "position": 13, "token_count": 114, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-statements-pivot-013", "document_id": "sql-statements-pivot", "position": 13, "token_count": 114, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/statements/pivot.md", "url": "/sql/statements/pivot", "title": "PIVOT Statement", "category": null, "tags": [], "section_url": "/sql/statements/pivot"}}
{"chunk_id": "sql-statements-pivot-014", "document_id": "sql-statements-pivot", "content": "#### Multiple `USING` Expressions\n\nAn alias may also be included for each expression in the `USING` clause.\nIt will be appended to the generated column names after an underscore (`_`).\nThis makes the column naming convention much cleaner when multiple expressions are included in the `USING` clause.\n\nIn this example, both the `sum` and `max` of the population column are calculated for each year and are split into separate columns.\n\n```sql\nPIVOT cities\nON year\nUSING sum(population) AS total, max(population) AS max\nGROUP BY country;", "position": 14, "token_count": 124, "has_code": true, "section_hierarchy": ["Multiple `USING` Expressions"], "metadata": {"chunk_id": "sql-statements-pivot-014", "document_id": "sql-statements-pivot", "position": 14, "token_count": 124, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Multiple `USING` Expressions"], "file_path": "sql/statements/pivot.md", "url": "/sql/statements/pivot", "title": "PIVOT Statement", "category": null, "tags": [], "section_url": "/sql/statements/pivot#multiple-using-expressions"}}
{"chunk_id": "sql-statements-pivot-015", "document_id": "sql-statements-pivot", "content": "```\n\n| country | 2000_total | 2000_max | 2010_total | 2010_max | 2020_total | 2020_max |\n|---------|-----------:|---------:|-----------:|---------:|-----------:|---------:|\n| US | 8579 | 8015 | 8783 | 8175 | 9510 | 8772 |\n| NL | 1005 | 1005 | 1065 | 1065 | 1158 | 1158 |", "position": 15, "token_count": 160, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-statements-pivot-015", "document_id": "sql-statements-pivot", "position": 15, "token_count": 160, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/statements/pivot.md", "url": "/sql/statements/pivot", "title": "PIVOT Statement", "category": null, "tags": [], "section_url": "/sql/statements/pivot"}}
{"chunk_id": "sql-statements-pivot-016", "document_id": "sql-statements-pivot", "content": "#### Multiple `GROUP BY` Columns\n\nMultiple `GROUP BY` columns may also be provided.\nNote that column names must be used rather than column positions (1, 2, etc.), and that expressions are not supported in the `GROUP BY` clause.\n\n```sql\nPIVOT cities\nON year\nUSING sum(population)\nGROUP BY country, name;\n```\n\n| country | name | 2000 | 2010 | 2020 |\n|---------|---------------|-----:|-----:|-----:|\n| NL | Amsterdam | 1005 | 1065 | 1158 |\n| US | Seattle | 564 | 608 | 738 |\n| US | New York City | 8015 | 8175 | 8772 |", "position": 16, "token_count": 184, "has_code": true, "section_hierarchy": ["Multiple `GROUP BY` Columns"], "metadata": {"chunk_id": "sql-statements-pivot-016", "document_id": "sql-statements-pivot", "position": 16, "token_count": 184, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Multiple `GROUP BY` Columns"], "file_path": "sql/statements/pivot.md", "url": "/sql/statements/pivot", "title": "PIVOT Statement", "category": null, "tags": [], "section_url": "/sql/statements/pivot#multiple-group-by-columns"}}
{"chunk_id": "sql-statements-pivot-017", "document_id": "sql-statements-pivot", "content": "### Using `PIVOT` within a `SELECT` Statement\n\nThe `PIVOT` statement may be included within a `SELECT` statement as a CTE ([a Common Table Expression, or `WITH` clause]({% link docs/stable/sql/query_syntax/with.md %})), or a subquery.\nThis allows for a `PIVOT` to be used alongside other SQL logic, as well as for multiple `PIVOT`s to be used in one query.\n\nNo `SELECT` is needed within the CTE, the `PIVOT` keyword can be thought of as taking its place.\n\n```sql\nWITH pivot_alias AS (\n PIVOT cities\n ON year\n USING sum(population)\n GROUP BY country\n)\nSELECT * FROM pivot_alias;\n```\n\nA `PIVOT` may be used in a subquery and must be wrapped in parentheses.\nNote that this behavior is different than the SQL Standard Pivot, as illustrated in subsequent examples.\n\n```sql\nSELECT *\nFROM (\n PIVOT cities\n ON year\n USING sum(population)\n GROUP BY country\n) pivot_alias;\n```", "position": 17, "token_count": 242, "has_code": true, "section_hierarchy": ["Using `PIVOT` within a `SELECT` Statement"], "metadata": {"chunk_id": "sql-statements-pivot-017", "document_id": "sql-statements-pivot", "position": 17, "token_count": 242, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Using `PIVOT` within a `SELECT` Statement"], "file_path": "sql/statements/pivot.md", "url": "/sql/statements/pivot", "title": "PIVOT Statement", "category": null, "tags": [], "section_url": "/sql/statements/pivot#using-pivot-within-a-select-statement"}}
{"chunk_id": "sql-statements-pivot-018", "document_id": "sql-statements-pivot", "content": "### Multiple `PIVOT` Statements\n\nEach `PIVOT` can be treated as if it were a `SELECT` node, so they can be joined together or manipulated in other ways.\n\nFor example, if two `PIVOT` statements share the same `GROUP BY` expression, they can be joined together using the columns in the `GROUP BY` clause into a wider pivot.\n\n```sql\nSELECT *\nFROM (PIVOT cities ON year USING sum(population) GROUP BY country) year_pivot\nJOIN (PIVOT cities ON name USING sum(population) GROUP BY country) name_pivot\nUSING (country);", "position": 18, "token_count": 132, "has_code": true, "section_hierarchy": ["Multiple `PIVOT` Statements"], "metadata": {"chunk_id": "sql-statements-pivot-018", "document_id": "sql-statements-pivot", "position": 18, "token_count": 132, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Multiple `PIVOT` Statements"], "file_path": "sql/statements/pivot.md", "url": "/sql/statements/pivot", "title": "PIVOT Statement", "category": null, "tags": [], "section_url": "/sql/statements/pivot#multiple-pivot-statements"}}
{"chunk_id": "sql-statements-pivot-019", "document_id": "sql-statements-pivot", "content": "```\n\n| country | 2000 | 2010 | 2020 | Amsterdam | New York City | Seattle |\n|---------|-----:|-----:|-----:|----------:|--------------:|--------:|\n| NL | 1005 | 1065 | 1158 | 3228 | NULL | NULL |\n| US | 8579 | 8783 | 9510 | NULL | 24962 | 1910 |", "position": 19, "token_count": 133, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-statements-pivot-019", "document_id": "sql-statements-pivot", "position": 19, "token_count": 133, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/statements/pivot.md", "url": "/sql/statements/pivot", "title": "PIVOT Statement", "category": null, "tags": [], "section_url": "/sql/statements/pivot"}}
{"chunk_id": "sql-statements-pivot-020", "document_id": "sql-statements-pivot", "content": "## Simplified `PIVOT` Full Syntax Diagram\n\nBelow is the full syntax diagram of the `PIVOT` statement.\n\n## SQL Standard `PIVOT` Syntax\n\nThe full syntax diagram is below, but the SQL Standard `PIVOT` syntax can be summarized as:\n\n```sql\nSELECT *\nFROM ⟨dataset⟩\nPIVOT (\n ⟨values⟩\n FOR\n ⟨column_1⟩ IN (⟨in_list⟩)\n ⟨column_2⟩ IN (⟨in_list⟩)\n ...\n GROUP BY ⟨rows⟩\n);\n```\n\nUnlike the simplified syntax, the `IN` clause must be specified for each column to be pivoted.\nIf you are interested in dynamic pivoting, the simplified syntax is recommended.\n\nNote that no commas separate the expressions in the `FOR` clause, but that `value` and `GROUP BY` expressions must be comma-separated!", "position": 20, "token_count": 184, "has_code": true, "section_hierarchy": ["SQL Standard `PIVOT` Syntax"], "metadata": {"chunk_id": "sql-statements-pivot-020", "document_id": "sql-statements-pivot", "position": 20, "token_count": 184, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["SQL Standard `PIVOT` Syntax"], "file_path": "sql/statements/pivot.md", "url": "/sql/statements/pivot", "title": "PIVOT Statement", "category": null, "tags": [], "section_url": "/sql/statements/pivot#sql-standard-pivot-syntax"}}
{"chunk_id": "sql-statements-pivot-021", "document_id": "sql-statements-pivot", "content": "## Examples\n\nThis example uses a single value expression, a single column expression, and a single row expression:\n\n```sql\nSELECT *\nFROM cities\nPIVOT (\n sum(population)\n FOR\n year IN (2000, 2010, 2020)\n GROUP BY country\n);\n```\n\n| country | 2000 | 2010 | 2020 |\n|---------|-----:|-----:|-----:|\n| NL | 1005 | 1065 | 1158 |\n| US | 8579 | 8783 | 9510 |\n\nThis example is somewhat contrived, but serves as an example of using multiple value expressions and multiple columns in the `FOR` clause.\n\n```sql\nSELECT *\nFROM cities\nPIVOT (\n sum(population) AS total,\n count(population) AS count\n FOR\n year IN (2000, 2010)\n country IN ('NL', 'US')\n);", "position": 21, "token_count": 197, "has_code": true, "section_hierarchy": ["Examples"], "metadata": {"chunk_id": "sql-statements-pivot-021", "document_id": "sql-statements-pivot", "position": 21, "token_count": 197, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Examples"], "file_path": "sql/statements/pivot.md", "url": "/sql/statements/pivot", "title": "PIVOT Statement", "category": null, "tags": [], "section_url": "/sql/statements/pivot#examples"}}
{"chunk_id": "sql-statements-pivot-022", "document_id": "sql-statements-pivot", "content": "```\n\n| name | 2000_NL_total | 2000_NL_count | 2000_US_total | 2000_US_count | 2010_NL_total | 2010_NL_count | 2010_US_total | 2010_US_count |\n|--|-:|-:|-:|-:|-:|-:|-:|-:|\n| Amsterdam | 1005 | 1 | NULL | 0 | 1065 | 1 | NULL | 0 |\n| Seattle | NULL | 0 | 564 | 1 | NULL | 0 | 608 | 1 |\n| New York City | NULL | 0 | 8015 | 1 | NULL | 0 | 8175 | 1 |", "position": 22, "token_count": 149, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-statements-pivot-022", "document_id": "sql-statements-pivot", "position": 22, "token_count": 149, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/statements/pivot.md", "url": "/sql/statements/pivot", "title": "PIVOT Statement", "category": null, "tags": [], "section_url": "/sql/statements/pivot"}}
{"chunk_id": "sql-statements-pivot-023", "document_id": "sql-statements-pivot", "content": "### SQL Standard `PIVOT` Full Syntax Diagram\n\nBelow is the full syntax diagram of the SQL Standard version of the `PIVOT` statement.", "position": 23, "token_count": 33, "has_code": false, "section_hierarchy": ["SQL Standard `PIVOT` Full Syntax Diagram"], "metadata": {"chunk_id": "sql-statements-pivot-023", "document_id": "sql-statements-pivot", "position": 23, "token_count": 33, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["SQL Standard `PIVOT` Full Syntax Diagram"], "file_path": "sql/statements/pivot.md", "url": "/sql/statements/pivot", "title": "PIVOT Statement", "category": null, "tags": [], "section_url": "/sql/statements/pivot#sql-standard-pivot-full-syntax-diagram"}}
{"chunk_id": "sql-statements-pivot-024", "document_id": "sql-statements-pivot", "content": "## Limitations\n\n`PIVOT` currently only accepts an aggregate function, expressions are not allowed.\nFor example, the following query attempts to get the population as the number of people instead of thousands of people (i.e., instead of 564, get 564000):\n\n```sql\nPIVOT cities\nON year\nUSING sum(population) * 1000;\n```\n\nHowever, it fails with the following error:\n\n```console\nCatalog Error:\n* is not an aggregate function\n```\n\nTo work around this limitation, perform the `PIVOT` with the aggregation only, then use the [`COLUMNS` expression]({% link docs/stable/sql/expressions/star.md %}#columns-expression):\n\n```sql\nSELECT country, name, 1000 * COLUMNS(* EXCLUDE (country, name))\nFROM (\n PIVOT cities\n ON year\n USING sum(population)\n);\n```", "position": 24, "token_count": 192, "has_code": true, "section_hierarchy": ["Limitations"], "metadata": {"chunk_id": "sql-statements-pivot-024", "document_id": "sql-statements-pivot", "position": 24, "token_count": 192, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Limitations"], "file_path": "sql/statements/pivot.md", "url": "/sql/statements/pivot", "title": "PIVOT Statement", "category": null, "tags": [], "section_url": "/sql/statements/pivot#limitations"}}
