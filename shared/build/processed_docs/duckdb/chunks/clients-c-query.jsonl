{"chunk_id": "clients-c-query-000", "document_id": "clients-c-query", "content": "The `duckdb_query` method allows SQL queries to be run in DuckDB from C. This method takes two parameters, a (null-terminated) SQL query string and a `duckdb_result` result pointer. The result pointer may be `NULL` if the application is not interested in the result set or if the query produces no result. After the result is consumed, the `duckdb_destroy_result` method should be used to clean up the result.\n\nElements can be extracted from the `duckdb_result` object using a variety of methods. The `duckdb_column_count` can be used to extract the number of columns. `duckdb_column_name` and `duckdb_column_type` can be used to extract the names and types of individual columns.", "position": 0, "token_count": 168, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "clients-c-query-000", "document_id": "clients-c-query", "position": 0, "token_count": 168, "has_code": false, "overlap_with_previous": false, "section_hierarchy": [], "file_path": "clients/c/query.md", "url": "/clients/c/query", "title": "Query", "category": null, "tags": [], "section_url": "/clients/c/query"}}
{"chunk_id": "clients-c-query-001", "document_id": "clients-c-query", "content": "## Example\n\n```c\nduckdb_state state;\nduckdb_result result;\n\n// create a table\nstate = duckdb_query(con, \"CREATE TABLE integers (i INTEGER, j INTEGER);\", NULL);\nif (state == DuckDBError) {\n // handle error\n}\n// insert three rows into the table\nstate = duckdb_query(con, \"INSERT INTO integers VALUES (3, 4), (5, 6), (7, NULL);\", NULL);\nif (state == DuckDBError) {\n // handle error\n}\n// query rows again\nstate = duckdb_query(con, \"SELECT * FROM integers\", &result);\nif (state == DuckDBError) {\n // handle error\n}\n// handle the result\n// ...\n\n// destroy the result after we are done with it\nduckdb_destroy_result(&result);\n```", "position": 1, "token_count": 205, "has_code": true, "section_hierarchy": ["Example"], "metadata": {"chunk_id": "clients-c-query-001", "document_id": "clients-c-query", "position": 1, "token_count": 205, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Example"], "file_path": "clients/c/query.md", "url": "/clients/c/query", "title": "Query", "category": null, "tags": [], "section_url": "/clients/c/query#example"}}
{"chunk_id": "clients-c-query-002", "document_id": "clients-c-query", "content": "## Value Extraction\n\nValues can be extracted using either the `duckdb_fetch_chunk` function, or using the `duckdb_value` convenience functions. The `duckdb_fetch_chunk` function directly hands you data chunks in DuckDB's native array format and can therefore be very fast. The `duckdb_value` functions perform bounds- and type-checking, and will automatically cast values to the desired type. This makes them more convenient and easier to use, at the expense of being slower.\n\nSee the [Types]({% link docs/stable/clients/c/types.md %}) page for more information.\n\n> For optimal performance, use `duckdb_fetch_chunk` to extract data from the query result.\n> The `duckdb_value` functions perform internal type-checking, bounds-checking and casting which makes them slower.", "position": 2, "token_count": 184, "has_code": false, "section_hierarchy": ["Value Extraction"], "metadata": {"chunk_id": "clients-c-query-002", "document_id": "clients-c-query", "position": 2, "token_count": 184, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Value Extraction"], "file_path": "clients/c/query.md", "url": "/clients/c/query", "title": "Query", "category": null, "tags": [], "section_url": "/clients/c/query#value-extraction"}}
{"chunk_id": "clients-c-query-003", "document_id": "clients-c-query", "content": "### `duckdb_fetch_chunk`\n\nBelow is an end-to-end example that prints the above result to CSV format using the `duckdb_fetch_chunk` function.\nNote that the function is NOT generic: we do need to know exactly what the types of the result columns are.\n\n```c\nduckdb_database db;\nduckdb_connection con;\nduckdb_open(nullptr, &db);\nduckdb_connect(db, &con);\n\nduckdb_result res;\nduckdb_query(con, \"CREATE TABLE integers (i INTEGER, j INTEGER);\", NULL);\nduckdb_query(con, \"INSERT INTO integers VALUES (3, 4), (5, 6), (7, NULL);\", NULL);\nduckdb_query(con, \"SELECT * FROM integers;\", &res);", "position": 3, "token_count": 190, "has_code": true, "section_hierarchy": ["`duckdb_fetch_chunk`"], "metadata": {"chunk_id": "clients-c-query-003", "document_id": "clients-c-query", "position": 3, "token_count": 190, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["`duckdb_fetch_chunk`"], "file_path": "clients/c/query.md", "url": "/clients/c/query", "title": "Query", "category": null, "tags": [], "section_url": "/clients/c/query#duckdbfetchchunk"}}
{"chunk_id": "clients-c-query-004", "document_id": "clients-c-query", "content": "// iterate until result is exhausted\nwhile (true) {\n duckdb_data_chunk result = duckdb_fetch_chunk(res);\n if (!result) {\n // result is exhausted\n break;\n }\n // get the number of rows from the data chunk\n idx_t row_count = duckdb_data_chunk_get_size(result);\n // get the first column\n duckdb_vector col1 = duckdb_data_chunk_get_vector(result, 0);\n int32_t *col1_data = (int32_t *) duckdb_vector_get_data(col1);\n uint64_t *col1_validity = duckdb_vector_get_validity(col1);\n\n // get the second column\n duckdb_vector col2 = duckdb_data_chunk_get_vector(result, 1);\n int32_t *col2_data = (int32_t *) duckdb_vector_get_data(col2);\n uint64_t *col2_validity = duckdb_vector_get_validity(col2);", "position": 4, "token_count": 246, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "clients-c-query-004", "document_id": "clients-c-query", "position": 4, "token_count": 246, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "clients/c/query.md", "url": "/clients/c/query", "title": "Query", "category": null, "tags": [], "section_url": "/clients/c/query"}}
{"chunk_id": "clients-c-query-005", "document_id": "clients-c-query", "content": "// iterate over the rows\n for (idx_t row = 0; row Deprecated The `duckdb_value` functions are deprecated and are scheduled for removal in a future release.\n\nBelow is an example that prints the above result to CSV format using the `duckdb_value_varchar` function.\nNote that the function is generic: we do not need to know about the types of the individual result columns.\n\n```c\n// print the above result to CSV format using `duckdb_value_varchar`\nidx_t row_count = duckdb_row_count(&result);\nidx_t column_count = duckdb_column_count(&result);\nfor (idx_t row = 0; row 0) printf(\",\");\n auto str_val = duckdb_value_varchar(&result, col, row);\n printf(\"%s\", str_val);\n duckdb_free(str_val);\n }\n printf(\"\\n\");\n}", "position": 5, "token_count": 237, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "clients-c-query-005", "document_id": "clients-c-query", "position": 5, "token_count": 237, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "clients/c/query.md", "url": "/clients/c/query", "title": "Query", "category": null, "tags": [], "section_url": "/clients/c/query"}}
{"chunk_id": "clients-c-query-006", "document_id": "clients-c-query", "content": "```", "position": 6, "token_count": 5, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "clients-c-query-006", "document_id": "clients-c-query", "position": 6, "token_count": 5, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "clients/c/query.md", "url": "/clients/c/query", "title": "Query", "category": null, "tags": [], "section_url": "/clients/c/query"}}
{"chunk_id": "clients-c-query-007", "document_id": "clients-c-query", "content": "## API Reference Overview", "position": 7, "token_count": 7, "has_code": false, "section_hierarchy": ["API Reference Overview"], "metadata": {"chunk_id": "clients-c-query-007", "document_id": "clients-c-query", "position": 7, "token_count": 7, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["API Reference Overview"], "file_path": "clients/c/query.md", "url": "/clients/c/query", "title": "Query", "category": null, "tags": [], "section_url": "/clients/c/query#api-reference-overview"}}
{"chunk_id": "clients-c-query-008", "document_id": "clients-c-query", "content": "duckdb_state duckdb_query(duckdb_connection connection, const char *query, duckdb_result *out_result);\nvoid duckdb_destroy_result(duckdb_result *result);\nconst char *duckdb_column_name(duckdb_result *result, idx_t col);\nduckdb_type duckdb_column_type(duckdb_result *result, idx_t col);\nduckdb_statement_type duckdb_result_statement_type(duckdb_result result);\nduckdb_logical_type duckdb_column_logical_type(duckdb_result *result, idx_t col);\nduckdb_arrow_options duckdb_result_get_arrow_options(duckdb_result *result);\nidx_t duckdb_column_count(duckdb_result *result);\nidx_t duckdb_row_count(duckdb_result *result);", "position": 8, "token_count": 213, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "clients-c-query-008", "document_id": "clients-c-query", "position": 8, "token_count": 213, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "clients/c/query.md", "url": "/clients/c/query", "title": "Query", "category": null, "tags": [], "section_url": "/clients/c/query"}}
{"chunk_id": "clients-c-query-009", "document_id": "clients-c-query", "content": "idx_t duckdb_column_count(duckdb_result *result);\nidx_t duckdb_row_count(duckdb_result *result);\nidx_t duckdb_rows_changed(duckdb_result *result);\nvoid *duckdb_column_data(duckdb_result *result, idx_t col);\nbool *duckdb_nullmask_data(duckdb_result *result, idx_t col);\nconst char *duckdb_result_error(duckdb_result *result);\nduckdb_error_type duckdb_result_error_type(duckdb_result *result);", "position": 9, "token_count": 150, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "clients-c-query-009", "document_id": "clients-c-query", "position": 9, "token_count": 150, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "clients/c/query.md", "url": "/clients/c/query", "title": "Query", "category": null, "tags": [], "section_url": "/clients/c/query"}}
{"chunk_id": "clients-c-query-010", "document_id": "clients-c-query", "content": "#### `duckdb_query`\n\nExecutes a SQL query within a connection and stores the full (materialized) result in the out_result pointer.\nIf the query fails to execute, DuckDBError is returned and the error message can be retrieved by calling\n`duckdb_result_error`.\n\nNote that after running `duckdb_query`, `duckdb_destroy_result` must be called on the result object even if the\nquery fails, otherwise the error stored within the result will not be freed correctly.\n\n##### Syntax\n\nduckdb_state duckdb_query(\n duckdb_connection connection,\n const char *query,\n duckdb_result *out_result\n);\n\n##### Parameters\n\n* `connection`: The connection to perform the query in.\n* `query`: The SQL query to run.\n* `out_result`: The query result.\n\n##### Return Value\n\n`DuckDBSuccess` on success or `DuckDBError` on failure.", "position": 10, "token_count": 215, "has_code": false, "section_hierarchy": ["Return Value"], "metadata": {"chunk_id": "clients-c-query-010", "document_id": "clients-c-query", "position": 10, "token_count": 215, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Return Value"], "file_path": "clients/c/query.md", "url": "/clients/c/query", "title": "Query", "category": null, "tags": [], "section_url": "/clients/c/query#return-value"}}
{"chunk_id": "clients-c-query-011", "document_id": "clients-c-query", "content": "#### `duckdb_destroy_result`\n\nCloses the result and de-allocates all memory allocated for that result.\n\n##### Syntax\n\nvoid duckdb_destroy_result(\n duckdb_result *result\n);\n\n##### Parameters\n\n* `result`: The result to destroy.\n\n#### `duckdb_column_name`\n\nReturns the column name of the specified column. The result should not need to be freed; the column names will\nautomatically be destroyed when the result is destroyed.\n\nReturns `NULL` if the column is out of range.\n\n##### Syntax\n\nconst char *duckdb_column_name(\n duckdb_result *result,\n idx_t col\n);\n\n##### Parameters\n\n* `result`: The result object to fetch the column name from.\n* `col`: The column index.\n\n##### Return Value\n\nThe column name of the specified column.", "position": 11, "token_count": 199, "has_code": false, "section_hierarchy": ["Return Value"], "metadata": {"chunk_id": "clients-c-query-011", "document_id": "clients-c-query", "position": 11, "token_count": 199, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Return Value"], "file_path": "clients/c/query.md", "url": "/clients/c/query", "title": "Query", "category": null, "tags": [], "section_url": "/clients/c/query#return-value"}}
{"chunk_id": "clients-c-query-012", "document_id": "clients-c-query", "content": "#### `duckdb_column_type`\n\nReturns the column type of the specified column.\n\nReturns `DUCKDB_TYPE_INVALID` if the column is out of range.\n\n##### Syntax\n\nduckdb_type duckdb_column_type(\n duckdb_result *result,\n idx_t col\n);\n\n##### Parameters\n\n* `result`: The result object to fetch the column type from.\n* `col`: The column index.\n\n##### Return Value\n\nThe column type of the specified column.\n\n#### `duckdb_result_statement_type`\n\nReturns the statement type of the statement that was executed\n\n##### Syntax\n\nduckdb_statement_type duckdb_result_statement_type(\n duckdb_result result\n);\n\n##### Parameters\n\n* `result`: The result object to fetch the statement type from.\n\n##### Return Value\n\nduckdb_statement_type value or DUCKDB_STATEMENT_TYPE_INVALID", "position": 12, "token_count": 212, "has_code": false, "section_hierarchy": ["Return Value"], "metadata": {"chunk_id": "clients-c-query-012", "document_id": "clients-c-query", "position": 12, "token_count": 212, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Return Value"], "file_path": "clients/c/query.md", "url": "/clients/c/query", "title": "Query", "category": null, "tags": [], "section_url": "/clients/c/query#return-value"}}
{"chunk_id": "clients-c-query-013", "document_id": "clients-c-query", "content": "#### `duckdb_column_logical_type`\n\nReturns the logical column type of the specified column.\n\nThe return type of this call should be destroyed with `duckdb_destroy_logical_type`.\n\nReturns `NULL` if the column is out of range.\n\n##### Syntax\n\nduckdb_logical_type duckdb_column_logical_type(\n duckdb_result *result,\n idx_t col\n);\n\n##### Parameters\n\n* `result`: The result object to fetch the column type from.\n* `col`: The column index.\n\n##### Return Value\n\nThe logical column type of the specified column.", "position": 13, "token_count": 140, "has_code": false, "section_hierarchy": ["Return Value"], "metadata": {"chunk_id": "clients-c-query-013", "document_id": "clients-c-query", "position": 13, "token_count": 140, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Return Value"], "file_path": "clients/c/query.md", "url": "/clients/c/query", "title": "Query", "category": null, "tags": [], "section_url": "/clients/c/query#return-value"}}
{"chunk_id": "clients-c-query-014", "document_id": "clients-c-query", "content": "#### `duckdb_result_get_arrow_options`\n\nReturns the arrow options associated with the given result. These options are definitions of how the arrow arrays/schema\nshould be produced.\n\n##### Syntax\n\nduckdb_arrow_options duckdb_result_get_arrow_options(\n duckdb_result *result\n);\n\n##### Parameters\n\n* `result`: The result object to fetch arrow options from.\n\n##### Return Value\n\nThe arrow options associated with the given result. This must be destroyed with\n`duckdb_destroy_arrow_options`.\n\n#### `duckdb_column_count`\n\nReturns the number of columns present in a the result object.\n\n##### Syntax\n\nidx_t duckdb_column_count(\n duckdb_result *result\n);\n\n##### Parameters\n\n* `result`: The result object.\n\n##### Return Value\n\nThe number of columns present in the result object.", "position": 14, "token_count": 208, "has_code": false, "section_hierarchy": ["Return Value"], "metadata": {"chunk_id": "clients-c-query-014", "document_id": "clients-c-query", "position": 14, "token_count": 208, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Return Value"], "file_path": "clients/c/query.md", "url": "/clients/c/query", "title": "Query", "category": null, "tags": [], "section_url": "/clients/c/query#return-value"}}
{"chunk_id": "clients-c-query-015", "document_id": "clients-c-query", "content": "#### `duckdb_row_count`\n\n> Warning Deprecation notice. This method is scheduled for removal in a future release.\n\nReturns the number of rows present in the result object.\n\n##### Syntax\n\nidx_t duckdb_row_count(\n duckdb_result *result\n);\n\n##### Parameters\n\n* `result`: The result object.\n\n##### Return Value\n\nThe number of rows present in the result object.\n\n#### `duckdb_rows_changed`\n\nReturns the number of rows changed by the query stored in the result. This is relevant only for INSERT/UPDATE/DELETE\nqueries. For other queries the rows_changed will be 0.\n\n##### Syntax\n\nidx_t duckdb_rows_changed(\n duckdb_result *result\n);\n\n##### Parameters\n\n* `result`: The result object.\n\n##### Return Value\n\nThe number of rows changed.", "position": 15, "token_count": 205, "has_code": false, "section_hierarchy": ["Return Value"], "metadata": {"chunk_id": "clients-c-query-015", "document_id": "clients-c-query", "position": 15, "token_count": 205, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Return Value"], "file_path": "clients/c/query.md", "url": "/clients/c/query", "title": "Query", "category": null, "tags": [], "section_url": "/clients/c/query#return-value"}}
{"chunk_id": "clients-c-query-016", "document_id": "clients-c-query", "content": "#### `duckdb_column_data`\n\n> Deprecated This method has been deprecated. Prefer using `duckdb_result_get_chunk` instead.\n\nReturns the data of a specific column of a result in columnar format.\n\nThe function returns a dense array which contains the result data. The exact type stored in the array depends on the\ncorresponding duckdb_type (as provided by `duckdb_column_type`). For the exact type by which the data should be\naccessed, see the comments in [the types section](types) or the `DUCKDB_TYPE` enum.\n\nFor example, for a column of type `DUCKDB_TYPE_INTEGER`, rows can be accessed in the following manner:\n```c\nint32_t *data = (int32_t *) duckdb_column_data(&result, 0);\nprintf(\"Data for row %d: %d\\n\", row, data[row]);\n```\n\n##### Syntax\n\nvoid *duckdb_column_data(\n duckdb_result *result,\n idx_t col\n);", "position": 16, "token_count": 244, "has_code": true, "section_hierarchy": ["Syntax"], "metadata": {"chunk_id": "clients-c-query-016", "document_id": "clients-c-query", "position": 16, "token_count": 244, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Syntax"], "file_path": "clients/c/query.md", "url": "/clients/c/query", "title": "Query", "category": null, "tags": [], "section_url": "/clients/c/query#syntax"}}
{"chunk_id": "clients-c-query-017", "document_id": "clients-c-query", "content": "##### Syntax\n\nvoid *duckdb_column_data(\n duckdb_result *result,\n idx_t col\n);\n\n##### Parameters\n\n* `result`: The result object to fetch the column data from.\n* `col`: The column index.\n\n##### Return Value\n\nThe column data of the specified column.", "position": 17, "token_count": 76, "has_code": false, "section_hierarchy": ["Return Value"], "metadata": {"chunk_id": "clients-c-query-017", "document_id": "clients-c-query", "position": 17, "token_count": 76, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Return Value"], "file_path": "clients/c/query.md", "url": "/clients/c/query", "title": "Query", "category": null, "tags": [], "section_url": "/clients/c/query#return-value"}}
{"chunk_id": "clients-c-query-018", "document_id": "clients-c-query", "content": "#### `duckdb_nullmask_data`\n\n> Deprecated This method has been deprecated. Prefer using `duckdb_result_get_chunk` instead.\n\nReturns the nullmask of a specific column of a result in columnar format. The nullmask indicates for every row\nwhether or not the corresponding row is `NULL`. If a row is `NULL`, the values present in the array provided\nby `duckdb_column_data` are undefined.\n\n```c\nint32_t *data = (int32_t *) duckdb_column_data(&result, 0);\nbool *nullmask = duckdb_nullmask_data(&result, 0);\nif (nullmask[row]) {\n printf(\"Data for row %d: NULL\\n\", row);\n} else {\n printf(\"Data for row %d: %d\\n\", row, data[row]);\n}\n```\n\n##### Syntax\n\nbool *duckdb_nullmask_data(\n duckdb_result *result,\n idx_t col\n);", "position": 18, "token_count": 250, "has_code": true, "section_hierarchy": ["Syntax"], "metadata": {"chunk_id": "clients-c-query-018", "document_id": "clients-c-query", "position": 18, "token_count": 250, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Syntax"], "file_path": "clients/c/query.md", "url": "/clients/c/query", "title": "Query", "category": null, "tags": [], "section_url": "/clients/c/query#syntax"}}
{"chunk_id": "clients-c-query-019", "document_id": "clients-c-query", "content": "##### Syntax\n\nbool *duckdb_nullmask_data(\n duckdb_result *result,\n idx_t col\n);\n\n##### Parameters\n\n* `result`: The result object to fetch the nullmask from.\n* `col`: The column index.\n\n##### Return Value\n\nThe nullmask of the specified column.", "position": 19, "token_count": 81, "has_code": false, "section_hierarchy": ["Return Value"], "metadata": {"chunk_id": "clients-c-query-019", "document_id": "clients-c-query", "position": 19, "token_count": 81, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Return Value"], "file_path": "clients/c/query.md", "url": "/clients/c/query", "title": "Query", "category": null, "tags": [], "section_url": "/clients/c/query#return-value"}}
{"chunk_id": "clients-c-query-020", "document_id": "clients-c-query", "content": "#### `duckdb_result_error`\n\nReturns the error message contained within the result. The error is only set if `duckdb_query` returns `DuckDBError`.\n\nThe result of this function must not be freed. It will be cleaned up when `duckdb_destroy_result` is called.\n\n##### Syntax\n\nconst char *duckdb_result_error(\n duckdb_result *result\n);\n\n##### Parameters\n\n* `result`: The result object to fetch the error from.\n\n##### Return Value\n\nThe error of the result.\n\n#### `duckdb_result_error_type`\n\nReturns the result error type contained within the result. The error is only set if `duckdb_query` returns\n`DuckDBError`.\n\n##### Syntax\n\nduckdb_error_type duckdb_result_error_type(\n duckdb_result *result\n);\n\n##### Parameters\n\n* `result`: The result object to fetch the error from.\n\n##### Return Value\n\nThe error type of the result.", "position": 20, "token_count": 235, "has_code": false, "section_hierarchy": ["Return Value"], "metadata": {"chunk_id": "clients-c-query-020", "document_id": "clients-c-query", "position": 20, "token_count": 235, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Return Value"], "file_path": "clients/c/query.md", "url": "/clients/c/query", "title": "Query", "category": null, "tags": [], "section_url": "/clients/c/query#return-value"}}
