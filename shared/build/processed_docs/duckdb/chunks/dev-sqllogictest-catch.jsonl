{"chunk_id": "dev-sqllogictest-catch-000", "document_id": "dev-sqllogictest-catch", "content": "While we prefer the sqllogic tests for testing most functionality, for certain tests only SQL is not sufficient. This typically happens when you want to test the C++ API. When using pure SQL is really not an option it might be necessary to make a C++ test using Catch.\n\nCatch tests reside in the test directory as well. Here is an example of a catch test that tests the storage of the system:\n\n```cpp\n#include \"catch.hpp\"\n#include \"test_helpers.hpp\"\n\nTEST_CASE(\"Test simple storage\", \"[storage]\") {\n auto config = GetTestConfig();\n unique_ptr result;\n auto storage_database = TestCreatePath(\"storage_test\");", "position": 0, "token_count": 163, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "dev-sqllogictest-catch-000", "document_id": "dev-sqllogictest-catch", "position": 0, "token_count": 163, "has_code": true, "overlap_with_previous": false, "section_hierarchy": [], "file_path": "dev/sqllogictest/catch.md", "url": "/dev/sqllogictest/catch", "title": "Catch C/C++ Tests", "category": null, "tags": [], "section_url": "/dev/sqllogictest/catch"}}
{"chunk_id": "dev-sqllogictest-catch-001", "document_id": "dev-sqllogictest-catch", "content": "// make sure the database does not exist\n DeleteDatabase(storage_database);\n {\n // create a database and insert values\n DuckDB db(storage_database, config.get());\n Connection con(db);\n REQUIRE_NO_FAIL(con.Query(\"CREATE TABLE test (a INTEGER, b INTEGER);\"));\n REQUIRE_NO_FAIL(con.Query(\"INSERT INTO test VALUES (11, 22), (13, 22), (12, 21), (NULL, NULL)\"));\n REQUIRE_NO_FAIL(con.Query(\"CREATE TABLE test2 (a INTEGER);\"));\n REQUIRE_NO_FAIL(con.Query(\"INSERT INTO test2 VALUES (13), (12), (11)\"));\n }\n // reload the database from disk a few times", "position": 1, "token_count": 187, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "dev-sqllogictest-catch-001", "document_id": "dev-sqllogictest-catch", "position": 1, "token_count": 187, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "dev/sqllogictest/catch.md", "url": "/dev/sqllogictest/catch", "title": "Catch C/C++ Tests", "category": null, "tags": [], "section_url": "/dev/sqllogictest/catch"}}
{"chunk_id": "dev-sqllogictest-catch-002", "document_id": "dev-sqllogictest-catch", "content": "}\n // reload the database from disk a few times\n for (idx_t i = 0; i < 2; i++) {\n DuckDB db(storage_database, config.get());\n Connection con(db);\n result = con.Query(\"SELECT * FROM test ORDER BY a\");\n REQUIRE(CHECK_COLUMN(result, 0, {Value(), 11, 12, 13}));\n REQUIRE(CHECK_COLUMN(result, 1, {Value(), 22, 21, 22}));\n result = con.Query(\"SELECT * FROM test2 ORDER BY a\");\n REQUIRE(CHECK_COLUMN(result, 0, {11, 12, 13}));\n }\n DeleteDatabase(storage_database);\n}", "position": 2, "token_count": 170, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "dev-sqllogictest-catch-002", "document_id": "dev-sqllogictest-catch", "position": 2, "token_count": 170, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "dev/sqllogictest/catch.md", "url": "/dev/sqllogictest/catch", "title": "Catch C/C++ Tests", "category": null, "tags": [], "section_url": "/dev/sqllogictest/catch"}}
{"chunk_id": "dev-sqllogictest-catch-003", "document_id": "dev-sqllogictest-catch", "content": "```\n\nThe test uses the `TEST_CASE` wrapper to create each test. The database is created and queried using the C++ API. Results are checked using either `REQUIRE_FAIL` / `REQUIRE_NO_FAIL` (corresponding to statement ok and statement error) or `REQUIRE(CHECK_COLUMN(...))` (corresponding to query with a result check). Every test that is created in this way needs to be added to the corresponding `CMakeLists.txt`.", "position": 3, "token_count": 110, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "dev-sqllogictest-catch-003", "document_id": "dev-sqllogictest-catch", "position": 3, "token_count": 110, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "dev/sqllogictest/catch.md", "url": "/dev/sqllogictest/catch", "title": "Catch C/C++ Tests", "category": null, "tags": [], "section_url": "/dev/sqllogictest/catch"}}
