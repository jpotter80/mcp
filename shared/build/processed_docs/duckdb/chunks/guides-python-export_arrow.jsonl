{"chunk_id": "guides-python-export_arrow-000", "document_id": "guides-python-export_arrow", "content": "All results of a query can be exported to an [Apache Arrow Table](https://arrow.apache.org/docs/python/generated/pyarrow.Table.html) using the `fetch_arrow_table` function. Alternatively, results can be returned as a [RecordBatchReader](https://arrow.apache.org/docs/python/generated/pyarrow.ipc.RecordBatchStreamReader.html) using the `arrow` function and results can be read one batch at a time. In addition, relations built using DuckDB's [Relational API]({% link docs/stable/guides/python/relational_api_pandas.md %}) can also be exported.\n\n## Export to an Arrow Table\n\n```python\nimport duckdb\nimport pyarrow as pa\n\nmy_arrow_table = pa.Table.from_pydict({'i': [1, 2, 3, 4],\n 'j': [\"one\", \"two\", \"three\", \"four\"]})", "position": 0, "token_count": 238, "has_code": true, "section_hierarchy": ["Export to an Arrow Table"], "metadata": {"chunk_id": "guides-python-export_arrow-000", "document_id": "guides-python-export_arrow", "position": 0, "token_count": 238, "has_code": true, "overlap_with_previous": false, "section_hierarchy": ["Export to an Arrow Table"], "file_path": "guides/python/export_arrow.md", "url": "/guides/python/export_arrow", "title": "Export to Apache Arrow", "category": null, "tags": [], "section_url": "/guides/python/export_arrow#export-to-an-arrow-table"}}
{"chunk_id": "guides-python-export_arrow-001", "document_id": "guides-python-export_arrow", "content": "# query the Apache Arrow Table \"my_arrow_table\" and return as an Arrow Table\nresults = duckdb.sql(\"SELECT * FROM my_arrow_table\").fetch_arrow_table()\n```\n\n## Export as a RecordBatchReader\n\n```python\nimport duckdb\nimport pyarrow as pa\n\nmy_arrow_table = pa.Table.from_pydict({'i': [1, 2, 3, 4],\n 'j': [\"one\", \"two\", \"three\", \"four\"]})\n\n# query the Apache Arrow Table \"my_arrow_table\" and return as an Arrow RecordBatchReader\nchunk_size = 1_000_000\nresult = duckdb.sql(\"SELECT * FROM my_arrow_table\").arrow(chunk_size)", "position": 1, "token_count": 185, "has_code": true, "section_hierarchy": ["query the Apache Arrow Table \"my_arrow_table\" and return as an Arrow RecordBatchReader"], "metadata": {"chunk_id": "guides-python-export_arrow-001", "document_id": "guides-python-export_arrow", "position": 1, "token_count": 185, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["query the Apache Arrow Table \"my_arrow_table\" and return as an Arrow RecordBatchReader"], "file_path": "guides/python/export_arrow.md", "url": "/guides/python/export_arrow", "title": "Export to Apache Arrow", "category": null, "tags": [], "section_url": "/guides/python/export_arrow#query-the-apache-arrow-table-myarrowtable-and-return-as-an-arrow-recordbatchreader"}}
{"chunk_id": "guides-python-export_arrow-002", "document_id": "guides-python-export_arrow", "content": "# Loop through the results. A StopIteration exception is thrown when the RecordBatchReader is empty\nwhile (batch := result.read_next_batch()):\n # Process a single chunk here\n print(batch.to_pandas())\n```\n\n## Export from Relational API\n\nArrow objects can also be exported from the Relational API. A relation can be converted to an Arrow table using either the `DuckDBPyRelation.fetch_arrow_table` or `DuckDBPyRelation.to_arrow_table` function, and to an Arrow record batch reader using either the `DuckDBPyRelation.arrow` or `DuckDBPyRelation.fetch_arrow_reader` function.\n\n```python\nimport duckdb\n\n# connect to an in-memory database\ncon = duckdb.connect()\n\ncon.execute('CREATE TABLE integers (i integer)')\ncon.execute('INSERT INTO integers VALUES (0), (1), (2), (3), (4), (5), (6), (7), (8), (9), (NULL)')", "position": 2, "token_count": 244, "has_code": true, "section_hierarchy": ["connect to an in-memory database"], "metadata": {"chunk_id": "guides-python-export_arrow-002", "document_id": "guides-python-export_arrow", "position": 2, "token_count": 244, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["connect to an in-memory database"], "file_path": "guides/python/export_arrow.md", "url": "/guides/python/export_arrow", "title": "Export to Apache Arrow", "category": null, "tags": [], "section_url": "/guides/python/export_arrow#connect-to-an-in-memory-database"}}
{"chunk_id": "guides-python-export_arrow-003", "document_id": "guides-python-export_arrow", "content": "# Create a relation from the table and export the entire relation as Arrow\nrel = con.table(\"integers\")\nrelation_as_arrow = rel.to_arrow_table() # or .fetch_arrow_table()\n\n# Calculate a result using that relation and export that result to Arrow\nres = rel.aggregate(\"sum(i)\").execute()\narrow_table = res.to_arrow_table() # or .fetch_arrow_table()\n\n# You can also create an Arrow record batch reader from a relation\narrow_batch_reader = res.arrow() # or .fetch_arrow_reader()\nwhile (batch := arrow_batch_reader.read_next_batch()):\n # Process a single chunk here\n print(batch.to_pandas())\n```", "position": 3, "token_count": 181, "has_code": true, "section_hierarchy": ["You can also create an Arrow record batch reader from a relation"], "metadata": {"chunk_id": "guides-python-export_arrow-003", "document_id": "guides-python-export_arrow", "position": 3, "token_count": 181, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["You can also create an Arrow record batch reader from a relation"], "file_path": "guides/python/export_arrow.md", "url": "/guides/python/export_arrow", "title": "Export to Apache Arrow", "category": null, "tags": [], "section_url": "/guides/python/export_arrow#you-can-also-create-an-arrow-record-batch-reader-from-a-relation"}}
