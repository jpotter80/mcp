{"chunk_id": "guides-python-jupyter-000", "document_id": "guides-python-jupyter", "content": "DuckDB's Python client can be used directly in Jupyter notebooks with no additional configuration if desired.\nHowever, additional libraries can be used to simplify SQL query development.\nThis guide will describe how to utilize those additional libraries.\nSee other guides in the Python section for how to use DuckDB and Python together.\n\nIn this example, we use the [JupySQL](https://github.com/ploomber/jupysql) package. This example workflow is also available as a [Google Colab notebook](https://colab.research.google.com/drive/1bNfU8xRTu8MQJnCbyyDRxvptklLb0ExH?usp=sharing).", "position": 0, "token_count": 166, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "guides-python-jupyter-000", "document_id": "guides-python-jupyter", "position": 0, "token_count": 166, "has_code": false, "overlap_with_previous": false, "section_hierarchy": [], "file_path": "guides/python/jupyter.md", "url": "/guides/python/jupyter", "title": "Jupyter Notebooks", "category": null, "tags": [], "section_url": "/guides/python/jupyter"}}
{"chunk_id": "guides-python-jupyter-001", "document_id": "guides-python-jupyter", "content": "## Library Installation\n\nFour additional libraries improve the DuckDB experience in Jupyter notebooks.\n\n1. [jupysql](https://github.com/ploomber/jupysql): Convert a Jupyter code cell into a SQL cell\n2. [Pandas](https://github.com/pandas-dev/pandas): Clean table visualizations and compatibility with other analysis\n3. [matplotlib](https://github.com/matplotlib/matplotlib): Plotting with Python\n4. [duckdb-engine (DuckDB SQLAlchemy driver)](https://github.com/Mause/duckdb_engine): Used by SQLAlchemy to connect to DuckDB (optional)\n\nRun these `pip install` commands from the command line if Jupyter Notebook is not yet installed. Otherwise, see Google Colab link above for an in-notebook example:\n\n```batch\npip install duckdb\n```\n\nInstall Jupyter Notebook:\n\n```batch\npip install notebook", "position": 1, "token_count": 242, "has_code": true, "section_hierarchy": ["Library Installation"], "metadata": {"chunk_id": "guides-python-jupyter-001", "document_id": "guides-python-jupyter", "position": 1, "token_count": 242, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Library Installation"], "file_path": "guides/python/jupyter.md", "url": "/guides/python/jupyter", "title": "Jupyter Notebooks", "category": null, "tags": [], "section_url": "/guides/python/jupyter#library-installation"}}
{"chunk_id": "guides-python-jupyter-002", "document_id": "guides-python-jupyter", "content": "```\n\nInstall Jupyter Notebook:\n\n```batch\npip install notebook\n```\n\nOr JupyterLab:\n\n```batch\npip install jupyterlab\n```\n\nInstall supporting libraries:\n\n```batch\npip install jupysql pandas matplotlib duckdb-engine\n```", "position": 2, "token_count": 68, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "guides-python-jupyter-002", "document_id": "guides-python-jupyter", "position": 2, "token_count": 68, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "guides/python/jupyter.md", "url": "/guides/python/jupyter", "title": "Jupyter Notebooks", "category": null, "tags": [], "section_url": "/guides/python/jupyter"}}
{"chunk_id": "guides-python-jupyter-003", "document_id": "guides-python-jupyter", "content": "## Library Import and Configuration\n\nOpen a Jupyter Notebook and import the relevant libraries.\n\nSet configurations on jupysql to directly output data to Pandas and to simplify the output that is printed to the notebook.\n\n```python\n%config SqlMagic.autopandas = True\n%config SqlMagic.feedback = False\n%config SqlMagic.displaycon = False\n```\n\n### Connecting to DuckDB Natively\n\nTo connect to DuckDB, run:\n\n```python\nimport duckdb\nimport pandas as pd\n\n%load_ext sql\nconn = duckdb.connect()\n%sql conn --alias duckdb\n```\n\n> Warning [Variables]({% link docs/stable/sql/statements/set_variable.md %}) are not recognized within a native DuckDB connection.", "position": 3, "token_count": 183, "has_code": true, "section_hierarchy": ["Connecting to DuckDB Natively"], "metadata": {"chunk_id": "guides-python-jupyter-003", "document_id": "guides-python-jupyter", "position": 3, "token_count": 183, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Connecting to DuckDB Natively"], "file_path": "guides/python/jupyter.md", "url": "/guides/python/jupyter", "title": "Jupyter Notebooks", "category": null, "tags": [], "section_url": "/guides/python/jupyter#connecting-to-duckdb-natively"}}
{"chunk_id": "guides-python-jupyter-004", "document_id": "guides-python-jupyter", "content": "### Connecting to DuckDB via SQLAlchemy\n\nAlternatively, you can connect to DuckDB via SQLAlchemy using `duckdb_engine`. See the [performance and feature differences](https://jupysql.ploomber.io/en/latest/tutorials/duckdb-native-sqlalchemy.html).\n\n```python\nimport duckdb\nimport pandas as pd", "position": 4, "token_count": 92, "has_code": true, "section_hierarchy": ["Connecting to DuckDB via SQLAlchemy"], "metadata": {"chunk_id": "guides-python-jupyter-004", "document_id": "guides-python-jupyter", "position": 4, "token_count": 92, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Connecting to DuckDB via SQLAlchemy"], "file_path": "guides/python/jupyter.md", "url": "/guides/python/jupyter", "title": "Jupyter Notebooks", "category": null, "tags": [], "section_url": "/guides/python/jupyter#connecting-to-duckdb-via-sqlalchemy"}}
{"chunk_id": "guides-python-jupyter-005", "document_id": "guides-python-jupyter", "content": "# No need to import duckdb_engine\n# jupysql will auto-detect the driver needed based on the connection string!", "position": 5, "token_count": 30, "has_code": false, "section_hierarchy": ["jupysql will auto-detect the driver needed based on the connection string!"], "metadata": {"chunk_id": "guides-python-jupyter-005", "document_id": "guides-python-jupyter", "position": 5, "token_count": 30, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["jupysql will auto-detect the driver needed based on the connection string!"], "file_path": "guides/python/jupyter.md", "url": "/guides/python/jupyter", "title": "Jupyter Notebooks", "category": null, "tags": [], "section_url": "/guides/python/jupyter#jupysql-will-auto-detect-the-driver-needed-based-on-the-connection-string"}}
{"chunk_id": "guides-python-jupyter-006", "document_id": "guides-python-jupyter", "content": "# Import jupysql Jupyter extension to create SQL cells\n%load_ext sql\n```\nEither connect to a new [in-memory DuckDB]({% link docs/stable/clients/python/dbapi.md %}#in-memory-connection), the [default connection]({% link docs/stable/clients/python/dbapi.md %}#default-connection) or a file backed database:\n\n```sql\n%sql duckdb:///:memory:\n```\n\n```sql\n%sql duckdb:///:default:\n```\n\n```sql\n%sql duckdb:///path/to/file.db\n```\n\n> The `%sql` command and `duckdb.sql` share the same [default connection]({% link docs/stable/clients/python/dbapi.md %}) if you provide `duckdb:///:default:` as the SQLAlchemy connection string.", "position": 6, "token_count": 225, "has_code": true, "section_hierarchy": ["Import jupysql Jupyter extension to create SQL cells"], "metadata": {"chunk_id": "guides-python-jupyter-006", "document_id": "guides-python-jupyter", "position": 6, "token_count": 225, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Import jupysql Jupyter extension to create SQL cells"], "file_path": "guides/python/jupyter.md", "url": "/guides/python/jupyter", "title": "Jupyter Notebooks", "category": null, "tags": [], "section_url": "/guides/python/jupyter#import-jupysql-jupyter-extension-to-create-sql-cells"}}
{"chunk_id": "guides-python-jupyter-007", "document_id": "guides-python-jupyter", "content": "## Querying DuckDB\n\nSingle line SQL queries can be run using `%sql` at the start of a line. Query results will be displayed as a Pandas DataFrame.\n\n```sql\n%sql SELECT 'Off and flying!' AS a_duckdb_column;\n```\n\nAn entire Jupyter cell can be used as a SQL cell by placing `%%sql` at the start of the cell. Query results will be displayed as a Pandas DataFrame.\n\n```sql\n%%sql\nSELECT\n schema_name,\n function_name\nFROM duckdb_functions()\nORDER BY ALL DESC\nLIMIT 5;\n```\n\nTo store the query results in a Python variable, use ` Warning When using the SQLAlchemy connection, and DuckDB >= 1.1.0, make sure to run `%sql SET python_scan_all_frames=true`, to make Pandas dataframes queryable.", "position": 7, "token_count": 199, "has_code": true, "section_hierarchy": ["Querying DuckDB"], "metadata": {"chunk_id": "guides-python-jupyter-007", "document_id": "guides-python-jupyter", "position": 7, "token_count": 199, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Querying DuckDB"], "file_path": "guides/python/jupyter.md", "url": "/guides/python/jupyter", "title": "Jupyter Notebooks", "category": null, "tags": [], "section_url": "/guides/python/jupyter#querying-duckdb"}}
{"chunk_id": "guides-python-jupyter-008", "document_id": "guides-python-jupyter", "content": "## Visualizing DuckDB Data\n\nThe most common way to plot datasets in Python is to load them using Pandas and then use matplotlib or seaborn for plotting.\nThis approach requires loading all data into memory which is highly inefficient.\nThe plotting module in JupySQL runs computations in the SQL engine.\nThis delegates memory management to the engine and ensures that intermediate computations do not keep eating up memory, efficiently plotting massive datasets.", "position": 8, "token_count": 101, "has_code": false, "section_hierarchy": ["Visualizing DuckDB Data"], "metadata": {"chunk_id": "guides-python-jupyter-008", "document_id": "guides-python-jupyter", "position": 8, "token_count": 101, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Visualizing DuckDB Data"], "file_path": "guides/python/jupyter.md", "url": "/guides/python/jupyter", "title": "Jupyter Notebooks", "category": null, "tags": [], "section_url": "/guides/python/jupyter#visualizing-duckdb-data"}}
{"chunk_id": "guides-python-jupyter-009", "document_id": "guides-python-jupyter", "content": "### Boxplot & Histogram\n\nTo create a boxplot, call `%sqlplot boxplot`, passing the name of the table and the column to plot.\nIn this case, the name of the table is the path of the locally stored Parquet file.\n\n```python\nfrom urllib.request import urlretrieve\n\n_ = urlretrieve(\n \"https://d37ci6vzurychx.cloudfront.net/trip-data/yellow_tripdata_2021-01.parquet\",\n \"yellow_tripdata_2021-01.parquet\",\n)\n\n%sqlplot boxplot --table yellow_tripdata_2021-01.parquet --column trip_distance\n```", "position": 9, "token_count": 171, "has_code": true, "section_hierarchy": ["Boxplot & Histogram"], "metadata": {"chunk_id": "guides-python-jupyter-009", "document_id": "guides-python-jupyter", "position": 9, "token_count": 171, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Boxplot & Histogram"], "file_path": "guides/python/jupyter.md", "url": "/guides/python/jupyter", "title": "Jupyter Notebooks", "category": null, "tags": [], "section_url": "/guides/python/jupyter#boxplot--histogram"}}
{"chunk_id": "guides-python-jupyter-010", "document_id": "guides-python-jupyter", "content": "### Install and Load DuckDB httpfs Extension\n\nDuckDB's [httpfs extension]({% link docs/stable/core_extensions/httpfs/overview.md %}) allows Parquet and CSV files to be queried remotely over http.\nThese examples query a Parquet file that contains historical taxi data from NYC.\nUsing the Parquet format allows DuckDB to only pull the rows and columns into memory that are needed rather than downloading the entire file.\nDuckDB can be used to process local [Parquet files]({% link docs/stable/data/parquet/overview.md %}) as well, which may be desirable if querying the entire Parquet file, or running multiple queries that require large subsets of the file.\n\n```sql\n%%sql\nINSTALL httpfs;\nLOAD httpfs;", "position": 10, "token_count": 180, "has_code": true, "section_hierarchy": ["Install and Load DuckDB httpfs Extension"], "metadata": {"chunk_id": "guides-python-jupyter-010", "document_id": "guides-python-jupyter", "position": 10, "token_count": 180, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Install and Load DuckDB httpfs Extension"], "file_path": "guides/python/jupyter.md", "url": "/guides/python/jupyter", "title": "Jupyter Notebooks", "category": null, "tags": [], "section_url": "/guides/python/jupyter#install-and-load-duckdb-httpfs-extension"}}
{"chunk_id": "guides-python-jupyter-011", "document_id": "guides-python-jupyter", "content": "```\n\nNow, create a query that filters by the 90th percentile.\nNote the use of the `--save`, and `--no-execute` functions.\nThis tells JupySQL to store the query, but skips execution. It will be referenced in the next plotting call.\n\n```sql\n%%sql --save short_trips --no-execute\nSELECT *\nFROM 'https://d37ci6vzurychx.cloudfront.net/trip-data/yellow_tripdata_2021-01.parquet'\nWHERE trip_distance", "position": 11, "token_count": 129, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "guides-python-jupyter-011", "document_id": "guides-python-jupyter", "position": 11, "token_count": 129, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "guides/python/jupyter.md", "url": "/guides/python/jupyter", "title": "Jupyter Notebooks", "category": null, "tags": [], "section_url": "/guides/python/jupyter"}}
{"chunk_id": "guides-python-jupyter-012", "document_id": "guides-python-jupyter", "content": "## Summary\n\nYou now have the ability to alternate between SQL and Pandas in a simple and highly performant way! You can plot massive datasets directly through the engine (avoiding both the download of the entire file and loading all of it into Pandas in memory). Dataframes can be read as tables in SQL, and SQL results can be output into Dataframes. Happy analyzing!\n\nAn alternative to `jupysql` is [`magic_duckdb`](https://github.com/iqmo-org/magic_duckdb).", "position": 12, "token_count": 124, "has_code": false, "section_hierarchy": ["Summary"], "metadata": {"chunk_id": "guides-python-jupyter-012", "document_id": "guides-python-jupyter", "position": 12, "token_count": 124, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Summary"], "file_path": "guides/python/jupyter.md", "url": "/guides/python/jupyter", "title": "Jupyter Notebooks", "category": null, "tags": [], "section_url": "/guides/python/jupyter#summary"}}
