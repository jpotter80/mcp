{"chunk_id": "sql-query_syntax-grouping_sets-000", "document_id": "sql-query_syntax-grouping_sets", "content": "`GROUPING SETS`, `ROLLUP` and `CUBE` can be used in the `GROUP BY` clause to perform a grouping over multiple dimensions within the same query.\nNote that this syntax is not compatible with [`GROUP BY ALL`]({% link docs/stable/sql/query_syntax/groupby.md %}#group-by-all).", "position": 0, "token_count": 81, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "sql-query_syntax-grouping_sets-000", "document_id": "sql-query_syntax-grouping_sets", "position": 0, "token_count": 81, "has_code": false, "overlap_with_previous": false, "section_hierarchy": [], "file_path": "sql/query_syntax/grouping_sets.md", "url": "/sql/query_syntax/grouping_sets", "title": "GROUPING SETS", "category": null, "tags": [], "section_url": "/sql/query_syntax/grouping_sets"}}
{"chunk_id": "sql-query_syntax-grouping_sets-001", "document_id": "sql-query_syntax-grouping_sets", "content": "## Examples\n\nCompute the average income along the provided four different dimensions:\n\n```sql\n-- the syntax () denotes the empty set (i.e., computing an ungrouped aggregate)\nSELECT city, street_name, avg(income)\nFROM addresses\nGROUP BY GROUPING SETS ((city, street_name), (city), (street_name), ());\n```\n\nCompute the average income along the same dimensions:\n\n```sql\nSELECT city, street_name, avg(income)\nFROM addresses\nGROUP BY CUBE (city, street_name);\n```\n\nCompute the average income along the dimensions `(city, street_name)`, `(city)` and `()`:\n\n```sql\nSELECT city, street_name, avg(income)\nFROM addresses\nGROUP BY ROLLUP (city, street_name);\n```", "position": 1, "token_count": 189, "has_code": true, "section_hierarchy": ["Examples"], "metadata": {"chunk_id": "sql-query_syntax-grouping_sets-001", "document_id": "sql-query_syntax-grouping_sets", "position": 1, "token_count": 189, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Examples"], "file_path": "sql/query_syntax/grouping_sets.md", "url": "/sql/query_syntax/grouping_sets", "title": "GROUPING SETS", "category": null, "tags": [], "section_url": "/sql/query_syntax/grouping_sets#examples"}}
{"chunk_id": "sql-query_syntax-grouping_sets-002", "document_id": "sql-query_syntax-grouping_sets", "content": "## Description\n\n`GROUPING SETS` perform the same aggregate across different `GROUP BY clauses` in a single query.\n\n```sql\nCREATE TABLE students (course VARCHAR, type VARCHAR);\nINSERT INTO students (course, type)\nVALUES\n ('CS', 'Bachelor'), ('CS', 'Bachelor'), ('CS', 'PhD'), ('Math', 'Masters'),\n ('CS', NULL), ('CS', NULL), ('Math', NULL);\n```\n\n```sql\nSELECT course, type, count(*)\nFROM students\nGROUP BY GROUPING SETS ((course, type), course, type, ());", "position": 2, "token_count": 154, "has_code": true, "section_hierarchy": ["Description"], "metadata": {"chunk_id": "sql-query_syntax-grouping_sets-002", "document_id": "sql-query_syntax-grouping_sets", "position": 2, "token_count": 154, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Description"], "file_path": "sql/query_syntax/grouping_sets.md", "url": "/sql/query_syntax/grouping_sets", "title": "GROUPING SETS", "category": null, "tags": [], "section_url": "/sql/query_syntax/grouping_sets#description"}}
{"chunk_id": "sql-query_syntax-grouping_sets-003", "document_id": "sql-query_syntax-grouping_sets", "content": "```\n\n| course | type | count_star() |\n|--------|----------|-------------:|\n| Math | NULL | 1 |\n| NULL | NULL | 7 |\n| CS | PhD | 1 |\n| CS | Bachelor | 2 |\n| Math | Masters | 1 |\n| CS | NULL | 2 |\n| Math | NULL | 2 |\n| CS | NULL | 5 |\n| NULL | NULL | 3 |\n| NULL | Masters | 1 |\n| NULL | Bachelor | 2 |\n| NULL | PhD | 1 |\n\nIn the above query, we group across four different sets: `course, type`, `course`, `type` and `()` (the empty group). The result contains `NULL` for a group which is not in the grouping set for the result, i.e., the above query is equivalent to the following statement of `UNION ALL` clauses:", "position": 3, "token_count": 213, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-query_syntax-grouping_sets-003", "document_id": "sql-query_syntax-grouping_sets", "position": 3, "token_count": 213, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/query_syntax/grouping_sets.md", "url": "/sql/query_syntax/grouping_sets", "title": "GROUPING SETS", "category": null, "tags": [], "section_url": "/sql/query_syntax/grouping_sets"}}
{"chunk_id": "sql-query_syntax-grouping_sets-004", "document_id": "sql-query_syntax-grouping_sets", "content": "```sql\n-- Group by course, type:\nSELECT course, type, count(*)\nFROM students\nGROUP BY course, type\nUNION ALL\n-- Group by type:\nSELECT NULL AS course, type, count(*)\nFROM students\nGROUP BY type\nUNION ALL\n-- Group by course:\nSELECT course, NULL AS type, count(*)\nFROM students\nGROUP BY course\nUNION ALL\n-- Group by nothing:\nSELECT NULL AS course, NULL AS type, count(*)\nFROM students;", "position": 4, "token_count": 102, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-query_syntax-grouping_sets-004", "document_id": "sql-query_syntax-grouping_sets", "position": 4, "token_count": 102, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/query_syntax/grouping_sets.md", "url": "/sql/query_syntax/grouping_sets", "title": "GROUPING SETS", "category": null, "tags": [], "section_url": "/sql/query_syntax/grouping_sets"}}
{"chunk_id": "sql-query_syntax-grouping_sets-005", "document_id": "sql-query_syntax-grouping_sets", "content": "```\n\n`CUBE` and `ROLLUP` are syntactic sugar to easily produce commonly used grouping sets.\n\nThe `ROLLUP` clause will produce all “sub-groups” of a grouping set, e.g., `ROLLUP (country, city, zip)` produces the grouping sets `(country, city, zip), (country, city), (country), ()`. This can be useful for producing different levels of detail of a group by clause. This produces `n+1` grouping sets where n is the amount of terms in the `ROLLUP` clause.\n\n`CUBE` produces grouping sets for all combinations of the inputs, e.g., `CUBE (country, city, zip)` will produce `(country, city, zip), (country, city), (country, zip), (city, zip), (country), (city), (zip), ()`. This produces `2^n` grouping sets.", "position": 5, "token_count": 211, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-query_syntax-grouping_sets-005", "document_id": "sql-query_syntax-grouping_sets", "position": 5, "token_count": 211, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/query_syntax/grouping_sets.md", "url": "/sql/query_syntax/grouping_sets", "title": "GROUPING SETS", "category": null, "tags": [], "section_url": "/sql/query_syntax/grouping_sets"}}
{"chunk_id": "sql-query_syntax-grouping_sets-006", "document_id": "sql-query_syntax-grouping_sets", "content": "## Identifying Grouping Sets with `GROUPING_ID()`\n\nThe super-aggregate rows generated by `GROUPING SETS`, `ROLLUP` and `CUBE` can often be identified by `NULL`-values returned for the respective column in the grouping. But if the columns used in the grouping can themselves contain actual `NULL`-values, then it can be challenging to distinguish whether the value in the resultset is a “real” `NULL`-value coming out of the data itself, or a `NULL`-value generated by the grouping construct. The `GROUPING_ID()` or `GROUPING()` function is designed to identify which groups generated the super-aggregate rows in the result.\n\n`GROUPING_ID()` is an aggregate function that takes the column expressions that make up the grouping(s). It returns a `BIGINT` value. The return value is `0` for the rows that are not super-aggregate rows. But for the super-aggregate rows, it returns an integer value that identifies the combination of expressions that make up the group for which the super-aggregate is generated. At this point, an example might help. Consider the following query:", "position": 6, "token_count": 246, "has_code": false, "section_hierarchy": ["Identifying Grouping Sets with `GROUPING_ID()`"], "metadata": {"chunk_id": "sql-query_syntax-grouping_sets-006", "document_id": "sql-query_syntax-grouping_sets", "position": 6, "token_count": 246, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Identifying Grouping Sets with `GROUPING_ID()`"], "file_path": "sql/query_syntax/grouping_sets.md", "url": "/sql/query_syntax/grouping_sets", "title": "GROUPING SETS", "category": null, "tags": [], "section_url": "/sql/query_syntax/grouping_sets#identifying-grouping-sets-with-groupingid"}}
{"chunk_id": "sql-query_syntax-grouping_sets-007", "document_id": "sql-query_syntax-grouping_sets", "content": "```sql\nWITH days AS (\n SELECT\n year(\"generate_series\") AS y,\n quarter(\"generate_series\") AS q,\n month(\"generate_series\") AS m\n FROM generate_series(DATE '2023-01-01', DATE '2023-12-31', INTERVAL 1 DAY)\n)\nSELECT y, q, m, GROUPING_ID(y, q, m) AS \"grouping_id()\"\nFROM days\nGROUP BY GROUPING SETS (\n (y, q, m),\n (y, q),\n (y),\n ()\n)\nORDER BY y, q, m;", "position": 7, "token_count": 134, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-query_syntax-grouping_sets-007", "document_id": "sql-query_syntax-grouping_sets", "position": 7, "token_count": 134, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/query_syntax/grouping_sets.md", "url": "/sql/query_syntax/grouping_sets", "title": "GROUPING SETS", "category": null, "tags": [], "section_url": "/sql/query_syntax/grouping_sets"}}
{"chunk_id": "sql-query_syntax-grouping_sets-008", "document_id": "sql-query_syntax-grouping_sets", "content": "```\n\nThese are the results:\n\n| y | q | m | grouping_id() |\n|-----:|-----:|-----:|--------------:|\n| 2023 | 1 | 1 | 0 |\n| 2023 | 1 | 2 | 0 |\n| 2023 | 1 | 3 | 0 |\n| 2023 | 1 | NULL | 1 |\n| 2023 | 2 | 4 | 0 |\n| 2023 | 2 | 5 | 0 |\n| 2023 | 2 | 6 | 0 |\n| 2023 | 2 | NULL | 1 |\n| 2023 | 3 | 7 | 0 |\n| 2023 | 3 | 8 | 0 |\n| 2023 | 3 | 9 | 0 |\n| 2023 | 3 | NULL | 1 |\n| 2023 | 4 | 10 | 0 |\n| 2023 | 4 | 11 | 0 |\n| 2023 | 4 | 12 | 0 |\n| 2023 | 4 | NULL | 1 |\n| 2023 | NULL | NULL | 3 |\n| NULL | NULL | NULL | 7 |", "position": 8, "token_count": 240, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-query_syntax-grouping_sets-008", "document_id": "sql-query_syntax-grouping_sets", "position": 8, "token_count": 240, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/query_syntax/grouping_sets.md", "url": "/sql/query_syntax/grouping_sets", "title": "GROUPING SETS", "category": null, "tags": [], "section_url": "/sql/query_syntax/grouping_sets"}}
{"chunk_id": "sql-query_syntax-grouping_sets-009", "document_id": "sql-query_syntax-grouping_sets", "content": "In this example, the lowest level of grouping is at the month level, defined by the grouping set `(y, q, m)`. Result rows corresponding to that level are simply aggregate rows and the `GROUPING_ID(y, q, m)` function returns `0` for those. The grouping set `(y, q)` results in super-aggregate rows over the month level, leaving a `NULL`-value for the `m` column, and for which `GROUPING_ID(y, q, m)` returns `1`. The grouping set `(y)` results in super-aggregate rows over the quarter level, leaving `NULL`-values for the `m` and `q` column, for which `GROUPING_ID(y, q, m)` returns `3`. Finally, the `()` grouping set results in one super-aggregate row for the entire resultset, leaving `NULL`-values for `y`, `q` and `m` and for which `GROUPING_ID(y, q, m)` returns `7`.", "position": 9, "token_count": 234, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "sql-query_syntax-grouping_sets-009", "document_id": "sql-query_syntax-grouping_sets", "position": 9, "token_count": 234, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/query_syntax/grouping_sets.md", "url": "/sql/query_syntax/grouping_sets", "title": "GROUPING SETS", "category": null, "tags": [], "section_url": "/sql/query_syntax/grouping_sets"}}
{"chunk_id": "sql-query_syntax-grouping_sets-010", "document_id": "sql-query_syntax-grouping_sets", "content": "To understand the relationship between the return value and the grouping set, you can think of `GROUPING_ID(y, q, m)` writing to a bitfield, where the first bit corresponds to the last expression passed to `GROUPING_ID()`, the second bit to the one-but-last expression passed to `GROUPING_ID()`, and so on. This may become clearer by casting `GROUPING_ID()` to `BIT`:", "position": 10, "token_count": 99, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "sql-query_syntax-grouping_sets-010", "document_id": "sql-query_syntax-grouping_sets", "position": 10, "token_count": 99, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/query_syntax/grouping_sets.md", "url": "/sql/query_syntax/grouping_sets", "title": "GROUPING SETS", "category": null, "tags": [], "section_url": "/sql/query_syntax/grouping_sets"}}
{"chunk_id": "sql-query_syntax-grouping_sets-011", "document_id": "sql-query_syntax-grouping_sets", "content": "```sql\nWITH days AS (\n SELECT\n year(\"generate_series\") AS y,\n quarter(\"generate_series\") AS q,\n month(\"generate_series\") AS m\n FROM generate_series(DATE '2023-01-01', DATE '2023-12-31', INTERVAL 1 DAY)\n)\nSELECT\n y, q, m,\n GROUPING_ID(y, q, m) AS \"grouping_id(y, q, m)\",\n right(GROUPING_ID(y, q, m)::BIT::VARCHAR, 3) AS \"y_q_m_bits\"\nFROM days\nGROUP BY GROUPING SETS (\n (y, q, m),\n (y, q),\n (y),\n ()\n)\nORDER BY y, q, m;", "position": 11, "token_count": 173, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-query_syntax-grouping_sets-011", "document_id": "sql-query_syntax-grouping_sets", "position": 11, "token_count": 173, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/query_syntax/grouping_sets.md", "url": "/sql/query_syntax/grouping_sets", "title": "GROUPING SETS", "category": null, "tags": [], "section_url": "/sql/query_syntax/grouping_sets"}}
{"chunk_id": "sql-query_syntax-grouping_sets-012", "document_id": "sql-query_syntax-grouping_sets", "content": "```\n\nWhich returns these results:", "position": 12, "token_count": 10, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-query_syntax-grouping_sets-012", "document_id": "sql-query_syntax-grouping_sets", "position": 12, "token_count": 10, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/query_syntax/grouping_sets.md", "url": "/sql/query_syntax/grouping_sets", "title": "GROUPING SETS", "category": null, "tags": [], "section_url": "/sql/query_syntax/grouping_sets"}}
{"chunk_id": "sql-query_syntax-grouping_sets-013", "document_id": "sql-query_syntax-grouping_sets", "content": "| y | q | m | grouping_id(y, q, m) | y_q_m_bits |\n|-----:|-----:|-----:|---------------------:|------------|\n| 2023 | 1 | 1 | 0 | 000 |\n| 2023 | 1 | 2 | 0 | 000 |\n| 2023 | 1 | 3 | 0 | 000 |\n| 2023 | 1 | NULL | 1 | 001 |\n| 2023 | 2 | 4 | 0 | 000 |\n| 2023 | 2 | 5 | 0 | 000 |\n| 2023 | 2 | 6 | 0 | 000 |\n| 2023 | 2 | NULL | 1 | 001 |\n| 2023 | 3 | 7 | 0 | 000 |\n| 2023 | 3 | 8 | 0 | 000 |", "position": 13, "token_count": 206, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "sql-query_syntax-grouping_sets-013", "document_id": "sql-query_syntax-grouping_sets", "position": 13, "token_count": 206, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/query_syntax/grouping_sets.md", "url": "/sql/query_syntax/grouping_sets", "title": "GROUPING SETS", "category": null, "tags": [], "section_url": "/sql/query_syntax/grouping_sets"}}
{"chunk_id": "sql-query_syntax-grouping_sets-014", "document_id": "sql-query_syntax-grouping_sets", "content": "| 2023 | 2 | NULL | 1 | 001 |\n| 2023 | 3 | 7 | 0 | 000 |\n| 2023 | 3 | 8 | 0 | 000 |\n| 2023 | 3 | 9 | 0 | 000 |\n| 2023 | 3 | NULL | 1 | 001 |\n| 2023 | 4 | 10 | 0 | 000 |\n| 2023 | 4 | 11 | 0 | 000 |\n| 2023 | 4 | 12 | 0 | 000 |\n| 2023 | 4 | NULL | 1 | 001 |\n| 2023 | NULL | NULL | 3 | 011 |\n| NULL | NULL | NULL | 7 | 111 |", "position": 14, "token_count": 134, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "sql-query_syntax-grouping_sets-014", "document_id": "sql-query_syntax-grouping_sets", "position": 14, "token_count": 134, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/query_syntax/grouping_sets.md", "url": "/sql/query_syntax/grouping_sets", "title": "GROUPING SETS", "category": null, "tags": [], "section_url": "/sql/query_syntax/grouping_sets"}}
{"chunk_id": "sql-query_syntax-grouping_sets-015", "document_id": "sql-query_syntax-grouping_sets", "content": "Note that the number of expressions passed to `GROUPING_ID()`, or the order in which they are passed is independent from the actual group definitions appearing in the `GROUPING SETS`-clause (or the groups implied by `ROLLUP` and `CUBE`). As long as the expressions passed to `GROUPING_ID()` are expressions that appear some where in the `GROUPING SETS`-clause, `GROUPING_ID()` will set a bit corresponding to the position of the expression whenever that expression is rolled up to a super-aggregate.", "position": 15, "token_count": 117, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "sql-query_syntax-grouping_sets-015", "document_id": "sql-query_syntax-grouping_sets", "position": 15, "token_count": 117, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/query_syntax/grouping_sets.md", "url": "/sql/query_syntax/grouping_sets", "title": "GROUPING SETS", "category": null, "tags": [], "section_url": "/sql/query_syntax/grouping_sets"}}
{"chunk_id": "sql-query_syntax-grouping_sets-016", "document_id": "sql-query_syntax-grouping_sets", "content": "## Syntax", "position": 16, "token_count": 5, "has_code": false, "section_hierarchy": ["Syntax"], "metadata": {"chunk_id": "sql-query_syntax-grouping_sets-016", "document_id": "sql-query_syntax-grouping_sets", "position": 16, "token_count": 5, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Syntax"], "file_path": "sql/query_syntax/grouping_sets.md", "url": "/sql/query_syntax/grouping_sets", "title": "GROUPING SETS", "category": null, "tags": [], "section_url": "/sql/query_syntax/grouping_sets#syntax"}}
