{"chunk_id": "sql-query_syntax-filter-000", "document_id": "sql-query_syntax-filter", "content": "The `FILTER` clause may optionally follow an aggregate function in a `SELECT` statement. This will filter the rows of data that are fed into the aggregate function in the same way that a `WHERE` clause filters rows, but localized to the specific aggregate function.\n\nThere are multiple types of situations where this is useful, including when evaluating multiple aggregates with different filters, and when creating a pivoted view of a dataset. `FILTER` provides a cleaner syntax for pivoting data when compared with the more traditional `CASE WHEN` approach discussed below.\n\nSome aggregate functions also do not filter out `NULL` values, so using a `FILTER` clause will return valid results when at times the `CASE WHEN` approach will not. This occurs with the functions `first` and `last`, which are desirable in a non-aggregating pivot operation where the goal is to simply re-orient the data into columns rather than re-aggregate it. `FILTER` also improves `NULL` handling when using the `list` and `array_agg` functions, as the `CASE WHEN` approach will include `NULL` values in the list result, while the `FILTER` clause will remove them.", "position": 0, "token_count": 250, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "sql-query_syntax-filter-000", "document_id": "sql-query_syntax-filter", "position": 0, "token_count": 250, "has_code": false, "overlap_with_previous": false, "section_hierarchy": [], "file_path": "sql/query_syntax/filter.md", "url": "/sql/query_syntax/filter", "title": "FILTER Clause", "category": null, "tags": [], "section_url": "/sql/query_syntax/filter"}}
{"chunk_id": "sql-query_syntax-filter-001", "document_id": "sql-query_syntax-filter", "content": "## Examples\n\nReturn the following:\n\n* The total number of rows\n* The number of rows where `i\n\n| total_rows | lte_five | odds |\n|:---|:---|:---|\n| 10 | 5 | 5 |\n\n> Simply counting rows that satisfy a condition can also be achieved without `FILTER` clause, using the boolean `sum` aggregate function, e.g., `sum(i\n\n| lte_five_sum | odds_median | odds_lte_five_median |\n|:---|:---|:---|\n| 15 | 5.0 | 3.0 |\n\nThe `FILTER` clause can also be used to pivot data from rows into columns. This is a static pivot, as columns must be defined prior to runtime in SQL. However, this kind of statement can be dynamically generated in a host programming language to leverage DuckDB's SQL engine for rapid, larger than memory pivoting.\n\nFirst generate an example dataset:", "position": 1, "token_count": 221, "has_code": false, "section_hierarchy": ["Examples"], "metadata": {"chunk_id": "sql-query_syntax-filter-001", "document_id": "sql-query_syntax-filter", "position": 1, "token_count": 221, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Examples"], "file_path": "sql/query_syntax/filter.md", "url": "/sql/query_syntax/filter", "title": "FILTER Clause", "category": null, "tags": [], "section_url": "/sql/query_syntax/filter#examples"}}
{"chunk_id": "sql-query_syntax-filter-002", "document_id": "sql-query_syntax-filter", "content": "First generate an example dataset:\n\n```sql\nCREATE TEMP TABLE stacked_data AS\n SELECT\n i,\n CASE WHEN i\n\n| 2022 | 2023 | 2024 | 2025 | NULLs |\n|:---|:---|:---|:---|:---|\n| 25000000 | 25000000 | 25000000 | 12500000 | 12500000 |\n\nHowever, the `CASE WHEN` approach will not work as expected when using an aggregate function that does not ignore `NULL` values. The `first` function falls into this category, so `FILTER` is preferred in this case.\n\n“Pivot” the data out by year (move each year out to a separate column):", "position": 2, "token_count": 159, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-query_syntax-filter-002", "document_id": "sql-query_syntax-filter", "position": 2, "token_count": 159, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/query_syntax/filter.md", "url": "/sql/query_syntax/filter", "title": "FILTER Clause", "category": null, "tags": [], "section_url": "/sql/query_syntax/filter"}}
{"chunk_id": "sql-query_syntax-filter-003", "document_id": "sql-query_syntax-filter", "content": "“Pivot” the data out by year (move each year out to a separate column):\n\n```sql\nSELECT\n first(i) FILTER (year = 2022) AS \"2022\",\n first(i) FILTER (year = 2023) AS \"2023\",\n first(i) FILTER (year = 2024) AS \"2024\",\n first(i) FILTER (year = 2025) AS \"2025\",\n first(i) FILTER (year IS NULL) AS \"NULLs\"\nFROM stacked_data;", "position": 3, "token_count": 115, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-query_syntax-filter-003", "document_id": "sql-query_syntax-filter", "position": 3, "token_count": 115, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/query_syntax/filter.md", "url": "/sql/query_syntax/filter", "title": "FILTER Clause", "category": null, "tags": [], "section_url": "/sql/query_syntax/filter"}}
{"chunk_id": "sql-query_syntax-filter-004", "document_id": "sql-query_syntax-filter", "content": "```\n\n| 2022 | 2023 | 2024 | 2025 | NULLs |\n|:---|:---|:---|:---|:---|\n| 1474561 | 25804801 | 50749441 | 76431361 | 87500001 |\n\nThis will produce `NULL` values whenever the first evaluation of the `CASE WHEN` clause returns a `NULL`:\n\n```sql\nSELECT\n first(CASE WHEN year = 2022 THEN i END) AS \"2022\",\n first(CASE WHEN year = 2023 THEN i END) AS \"2023\",\n first(CASE WHEN year = 2024 THEN i END) AS \"2024\",\n first(CASE WHEN year = 2025 THEN i END) AS \"2025\",\n first(CASE WHEN year IS NULL THEN i END) AS \"NULLs\"\nFROM stacked_data;", "position": 4, "token_count": 197, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-query_syntax-filter-004", "document_id": "sql-query_syntax-filter", "position": 4, "token_count": 197, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/query_syntax/filter.md", "url": "/sql/query_syntax/filter", "title": "FILTER Clause", "category": null, "tags": [], "section_url": "/sql/query_syntax/filter"}}
{"chunk_id": "sql-query_syntax-filter-005", "document_id": "sql-query_syntax-filter", "content": "```\n\n| 2022 | 2023 | 2024 | 2025 | NULLs |\n|:---|:---|:---|:---|:---|\n| 1228801 | NULL | NULL | NULL | NULL |", "position": 5, "token_count": 61, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "sql-query_syntax-filter-005", "document_id": "sql-query_syntax-filter", "position": 5, "token_count": 61, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "sql/query_syntax/filter.md", "url": "/sql/query_syntax/filter", "title": "FILTER Clause", "category": null, "tags": [], "section_url": "/sql/query_syntax/filter"}}
{"chunk_id": "sql-query_syntax-filter-006", "document_id": "sql-query_syntax-filter", "content": "## Aggregate Function Syntax (Including `FILTER` Clause)", "position": 6, "token_count": 14, "has_code": false, "section_hierarchy": ["Aggregate Function Syntax (Including `FILTER` Clause)"], "metadata": {"chunk_id": "sql-query_syntax-filter-006", "document_id": "sql-query_syntax-filter", "position": 6, "token_count": 14, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Aggregate Function Syntax (Including `FILTER` Clause)"], "file_path": "sql/query_syntax/filter.md", "url": "/sql/query_syntax/filter", "title": "FILTER Clause", "category": null, "tags": [], "section_url": "/sql/query_syntax/filter#aggregate-function-syntax-including-filter-clause"}}
