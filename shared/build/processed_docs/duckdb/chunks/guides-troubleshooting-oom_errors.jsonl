{"chunk_id": "guides-troubleshooting-oom_errors-000", "document_id": "guides-troubleshooting-oom_errors", "content": "DuckDB has a state of the art out-of-core query engine that can spill to disk for larger-than-memory processing.\nWe continuously strive to improve DuckDB to improve its scalability and prevent out of memory errors whenever possible.\nThat said, you may still experience out-of-memory errors if you run queries with multiple [blocking operators]({% link docs/stable/guides/performance/how_to_tune_workloads.md %}#blocking-operators), certain aggregation functions, `PIVOT` operations, etc., or if you have very little available memory compared to the dataset size.", "position": 0, "token_count": 135, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "guides-troubleshooting-oom_errors-000", "document_id": "guides-troubleshooting-oom_errors", "position": 0, "token_count": 135, "has_code": false, "overlap_with_previous": false, "section_hierarchy": [], "file_path": "guides/troubleshooting/oom_errors.md", "url": "/guides/troubleshooting/oom_errors", "title": "Out of Memory Errors", "category": null, "tags": [], "section_url": "/guides/troubleshooting/oom_errors"}}
{"chunk_id": "guides-troubleshooting-oom_errors-001", "document_id": "guides-troubleshooting-oom_errors", "content": "## Types of “Out of Memory” Errors\n\nOut of memory errors mainly occur in two forms:\n\n### `OutOfMemoryException`\n\nMost of the time DuckDB runs out of memory with an `OutOfMemoryException`.\nFor example:\n\n```console\nduckdb.duckdb.OutOfMemoryException: Out of Memory Error: failed to pin block of size 256.0 KiB (476.7 MiB/476.8 MiB used)\n```", "position": 1, "token_count": 112, "has_code": true, "section_hierarchy": ["`OutOfMemoryException`"], "metadata": {"chunk_id": "guides-troubleshooting-oom_errors-001", "document_id": "guides-troubleshooting-oom_errors", "position": 1, "token_count": 112, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["`OutOfMemoryException`"], "file_path": "guides/troubleshooting/oom_errors.md", "url": "/guides/troubleshooting/oom_errors", "title": "Out of Memory Errors", "category": null, "tags": [], "section_url": "/guides/troubleshooting/oom_errors#outofmemoryexception"}}
{"chunk_id": "guides-troubleshooting-oom_errors-002", "document_id": "guides-troubleshooting-oom_errors", "content": "### OOM Reaper (Linux)\n\nMany Linux distributions have an [OOM killer or OOM reaper process](https://learn.redhat.com/t5/Platform-Linux/Out-of-Memory-Killer/td-p/48828)\nwhose goal is to prevent memory overcommitment.\nIf the OOM reaper killed your process, you often see the following message where DuckDB was running:\n\n```console\nKilled\n```\n\nTo get more detailed information, check the diagnostic messages using the [`dmesg` command](https://en.wikipedia.org/wiki/Dmesg) (you may need `sudo`):\n\n```batch\nsudo dmesg", "position": 2, "token_count": 158, "has_code": true, "section_hierarchy": ["OOM Reaper (Linux)"], "metadata": {"chunk_id": "guides-troubleshooting-oom_errors-002", "document_id": "guides-troubleshooting-oom_errors", "position": 2, "token_count": 158, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["OOM Reaper (Linux)"], "file_path": "guides/troubleshooting/oom_errors.md", "url": "/guides/troubleshooting/oom_errors", "title": "Out of Memory Errors", "category": null, "tags": [], "section_url": "/guides/troubleshooting/oom_errors#oom-reaper-linux"}}
{"chunk_id": "guides-troubleshooting-oom_errors-003", "document_id": "guides-troubleshooting-oom_errors", "content": "```\n\nIf the process was killed by the OOM killer/reaper, you will find an entry like this:\n\n```console\n[Fri Apr 18 02:04:10 2025] Out of memory: Killed process 54400 (duckdb) total-vm:1037911068kB, anon-rss:770031964kB, file-rss:0kB, shmem-rss:0kB, UID:1000 pgtables:1814612kB oom_score_adj:0\n```", "position": 3, "token_count": 129, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "guides-troubleshooting-oom_errors-003", "document_id": "guides-troubleshooting-oom_errors", "position": 3, "token_count": 129, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "guides/troubleshooting/oom_errors.md", "url": "/guides/troubleshooting/oom_errors", "title": "Out of Memory Errors", "category": null, "tags": [], "section_url": "/guides/troubleshooting/oom_errors"}}
{"chunk_id": "guides-troubleshooting-oom_errors-004", "document_id": "guides-troubleshooting-oom_errors", "content": "## Troubleshooting Out of Memory Errors\n\nTo prevent out of memory errors, try to reduce memory usage.\nTo this end, please consult the [“How to Tune Workloads” site]({% link docs/stable/guides/performance/how_to_tune_workloads.md %}).\nIn short:", "position": 4, "token_count": 73, "has_code": false, "section_hierarchy": ["Troubleshooting Out of Memory Errors"], "metadata": {"chunk_id": "guides-troubleshooting-oom_errors-004", "document_id": "guides-troubleshooting-oom_errors", "position": 4, "token_count": 73, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Troubleshooting Out of Memory Errors"], "file_path": "guides/troubleshooting/oom_errors.md", "url": "/guides/troubleshooting/oom_errors", "title": "Out of Memory Errors", "category": null, "tags": [], "section_url": "/guides/troubleshooting/oom_errors#troubleshooting-out-of-memory-errors"}}
{"chunk_id": "guides-troubleshooting-oom_errors-005", "document_id": "guides-troubleshooting-oom_errors", "content": "* Reduce the number of threads using the `SET threads = ...` command.\n* If your query reads a large mount of data from a file or writes a large amount of data, try setting the `preserve_insertion_order` option to `false`: `SET preserve_insertion_order = false`.\n* Counter-intuitively, reducing the memory limit below the [default 80%]({% link docs/stable/operations_manual/limits.md %}) can help prevent out of memory errors. This is because some DuckDB operations circumvent the database's buffer manager and thus they can reserve more memory than allowed by the memory limit. If this happens (e.g., DuckDB is killed by the operating system or an OOM reaper process), set the memory limit to just 50-60% of the total system memory by using the `SET memory_limit = '...'` statement.\n* Break up the query into subqueries. This allows you to see where the intermediate results “blow up”, causing the query to run out of memory.", "position": 5, "token_count": 233, "has_code": false, "section_hierarchy": [], "metadata": {"chunk_id": "guides-troubleshooting-oom_errors-005", "document_id": "guides-troubleshooting-oom_errors", "position": 5, "token_count": 233, "has_code": false, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "guides/troubleshooting/oom_errors.md", "url": "/guides/troubleshooting/oom_errors", "title": "Out of Memory Errors", "category": null, "tags": [], "section_url": "/guides/troubleshooting/oom_errors"}}
{"chunk_id": "guides-troubleshooting-oom_errors-006", "document_id": "guides-troubleshooting-oom_errors", "content": "## See Also\n\nFor more information on DuckDB's memory management, see the [“Memory Management in DuckDB” blog post]({% post_url 2024-07-09-memory-management %}).", "position": 6, "token_count": 51, "has_code": false, "section_hierarchy": ["See Also"], "metadata": {"chunk_id": "guides-troubleshooting-oom_errors-006", "document_id": "guides-troubleshooting-oom_errors", "position": 6, "token_count": 51, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["See Also"], "file_path": "guides/troubleshooting/oom_errors.md", "url": "/guides/troubleshooting/oom_errors", "title": "Out of Memory Errors", "category": null, "tags": [], "section_url": "/guides/troubleshooting/oom_errors#see-also"}}
