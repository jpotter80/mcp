{"chunk_id": "dev-benchmark-000", "document_id": "dev-benchmark", "content": "DuckDB has an extensive benchmark suite.\nWhen making changes that have potential performance implications, it is important to run these benchmarks to detect potential performance regressions.\n\n## Getting Started\n\nTo build the benchmark suite, run the following command in the [DuckDB repository](https://github.com/duckdb/duckdb):\n\n```batch\nBUILD_BENCHMARK=1 CORE_EXTENSIONS='tpch' make\n```\n\n## Listing Benchmarks\n\nTo list all available benchmarks, run:\n\n```batch\nbuild/release/benchmark/benchmark_runner --list\n```", "position": 0, "token_count": 133, "has_code": true, "section_hierarchy": ["Listing Benchmarks"], "metadata": {"chunk_id": "dev-benchmark-000", "document_id": "dev-benchmark", "position": 0, "token_count": 133, "has_code": true, "overlap_with_previous": false, "section_hierarchy": ["Listing Benchmarks"], "file_path": "dev/benchmark.md", "url": "/dev/benchmark", "title": "Benchmark Suite", "category": null, "tags": [], "section_url": "/dev/benchmark#listing-benchmarks"}}
{"chunk_id": "dev-benchmark-001", "document_id": "dev-benchmark", "content": "## Running Benchmarks", "position": 1, "token_count": 7, "has_code": false, "section_hierarchy": ["Running Benchmarks"], "metadata": {"chunk_id": "dev-benchmark-001", "document_id": "dev-benchmark", "position": 1, "token_count": 7, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["Running Benchmarks"], "file_path": "dev/benchmark.md", "url": "/dev/benchmark", "title": "Benchmark Suite", "category": null, "tags": [], "section_url": "/dev/benchmark#running-benchmarks"}}
{"chunk_id": "dev-benchmark-002", "document_id": "dev-benchmark", "content": "### Running a Single Benchmark\n\nTo run a single benchmark, issue the following command:\n\n```batch\nbuild/release/benchmark/benchmark_runner benchmark/micro/nulls/no_nulls_addition.benchmark\n```\n\nThe output will be printed to `stdout` in CSV format, in the following format:\n\n```text\nname\trun\ttiming\nbenchmark/micro/nulls/no_nulls_addition.benchmark\t1\t0.121234\nbenchmark/micro/nulls/no_nulls_addition.benchmark\t2\t0.121702\nbenchmark/micro/nulls/no_nulls_addition.benchmark\t3\t0.122948\nbenchmark/micro/nulls/no_nulls_addition.benchmark\t4\t0.122534\nbenchmark/micro/nulls/no_nulls_addition.benchmark\t5\t0.124102", "position": 2, "token_count": 200, "has_code": true, "section_hierarchy": ["Running a Single Benchmark"], "metadata": {"chunk_id": "dev-benchmark-002", "document_id": "dev-benchmark", "position": 2, "token_count": 200, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Running a Single Benchmark"], "file_path": "dev/benchmark.md", "url": "/dev/benchmark", "title": "Benchmark Suite", "category": null, "tags": [], "section_url": "/dev/benchmark#running-a-single-benchmark"}}
{"chunk_id": "dev-benchmark-003", "document_id": "dev-benchmark", "content": "```\n\nYou can also specify an output file using the `--out` flag. This will write only the timings (delimited by newlines) to that file.\n\n```batch\nbuild/release/benchmark/benchmark_runner benchmark/micro/nulls/no_nulls_addition.benchmark --out=timings.out\n```\n\nThe output will contain the following:\n\n```text\n0.182472\n0.185027\n0.184163\n0.185281\n0.182948\n```", "position": 3, "token_count": 120, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "dev-benchmark-003", "document_id": "dev-benchmark", "position": 3, "token_count": 120, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "dev/benchmark.md", "url": "/dev/benchmark", "title": "Benchmark Suite", "category": null, "tags": [], "section_url": "/dev/benchmark"}}
{"chunk_id": "dev-benchmark-004", "document_id": "dev-benchmark", "content": "### Running Multiple Benchmark Using a Regular Expression\n\nYou can also use a regular expression to specify which benchmarks to run.\nBe careful of shell expansion of certain regex characters (e.g., `*` will likely be expanded by your shell, hence this requires proper quoting or escaping).\n\n```batch\nbuild/release/benchmark/benchmark_runner \"benchmark/micro/nulls/.*\"\n```\n\n#### Running All Benchmarks\n\nNot specifying any argument will run all benchmarks.\n\n```batch\nbuild/release/benchmark/benchmark_runner\n```", "position": 4, "token_count": 131, "has_code": true, "section_hierarchy": ["Running All Benchmarks"], "metadata": {"chunk_id": "dev-benchmark-004", "document_id": "dev-benchmark", "position": 4, "token_count": 131, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Running All Benchmarks"], "file_path": "dev/benchmark.md", "url": "/dev/benchmark", "title": "Benchmark Suite", "category": null, "tags": [], "section_url": "/dev/benchmark#running-all-benchmarks"}}
{"chunk_id": "dev-benchmark-005", "document_id": "dev-benchmark", "content": "#### Running All Benchmarks\n\nNot specifying any argument will run all benchmarks.\n\n```batch\nbuild/release/benchmark/benchmark_runner\n```\n\n#### Other Options\n\nThe `--info` flag gives you some other information about the benchmark.\n\n```batch\nbuild/release/benchmark/benchmark_runner benchmark/micro/nulls/no_nulls_addition.benchmark --info\n```\n\n```text\ndisplay_name:NULL Addition (no nulls)\ngroup:micro\nsubgroup:nulls\n```\n\nThe `--query` flag will print the query that is run by the benchmark.\n\n```sql\nSELECT min(i + 1) FROM integers;\n```\n\nThe `--profile` flag will output a query tree.", "position": 5, "token_count": 174, "has_code": true, "section_hierarchy": ["Other Options"], "metadata": {"chunk_id": "dev-benchmark-005", "document_id": "dev-benchmark", "position": 5, "token_count": 174, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Other Options"], "file_path": "dev/benchmark.md", "url": "/dev/benchmark", "title": "Benchmark Suite", "category": null, "tags": [], "section_url": "/dev/benchmark#other-options"}}
{"chunk_id": "dev-benchmark-006", "document_id": "dev-benchmark", "content": "## Creating Benchmarks\n\nSome development work is around performance,\nand including a benchmark along with the other tests not only validates any improvements,\nbut also prevents future performance regressions in the feature.\n\n### Benchmark Example\n\nTo illustrate how to create a benchmark file, we can look at the benchmark for the `FILL` window function.\n(The `FILL` function linearly interpolates missing values in an ordered partition.)\n\nBenchmarks are similar to unit test files, and have the same type of header.\n\n```py", "position": 6, "token_count": 114, "has_code": true, "section_hierarchy": ["Benchmark Example"], "metadata": {"chunk_id": "dev-benchmark-006", "document_id": "dev-benchmark", "position": 6, "token_count": 114, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["Benchmark Example"], "file_path": "dev/benchmark.md", "url": "/dev/benchmark", "title": "Benchmark Suite", "category": null, "tags": [], "section_url": "/dev/benchmark#benchmark-example"}}
{"chunk_id": "dev-benchmark-007", "document_id": "dev-benchmark", "content": "# name: benchmark/micro/window/window_fill.benchmark\n# description: Measure the perfomance of FILL", "position": 7, "token_count": 29, "has_code": false, "section_hierarchy": ["description: Measure the perfomance of FILL"], "metadata": {"chunk_id": "dev-benchmark-007", "document_id": "dev-benchmark", "position": 7, "token_count": 29, "has_code": false, "overlap_with_previous": true, "section_hierarchy": ["description: Measure the perfomance of FILL"], "file_path": "dev/benchmark.md", "url": "/dev/benchmark", "title": "Benchmark Suite", "category": null, "tags": [], "section_url": "/dev/benchmark#description-measure-the-perfomance-of-fill"}}
{"chunk_id": "dev-benchmark-008", "document_id": "dev-benchmark", "content": "# group: [window]\n```\nThe `make format-head` command fill can ensure that the header has the expected structure and prevent tidy check errors.\n\nBelow this header, there are a set of keywords summarizing the benchmark.\n\n```text\nname FillPerformance\ngroup micro\nsubgroup window\n```\n\nWhile some benchmarks run a single query,\nit can often be useful to _parameterize_ a benchmark using the `argument` keyword.\nThis allows the benchmark to be with different settings, such as data volume.\nFor the `FILL` benchmark, there are three arguments:\n\n```text\nargument sf 10\nargument errors 0.1\nargument keys 4", "position": 8, "token_count": 143, "has_code": true, "section_hierarchy": ["group: [window]"], "metadata": {"chunk_id": "dev-benchmark-008", "document_id": "dev-benchmark", "position": 8, "token_count": 143, "has_code": true, "overlap_with_previous": true, "section_hierarchy": ["group: [window]"], "file_path": "dev/benchmark.md", "url": "/dev/benchmark", "title": "Benchmark Suite", "category": null, "tags": [], "section_url": "/dev/benchmark#group-window"}}
{"chunk_id": "dev-benchmark-009", "document_id": "dev-benchmark", "content": "```\n\nFor `FILL` these are\n* The scale factor (millions of rows per partition)\n* The error rate (fraction of the values that are missing)\n* The number of partitions.\n\nBenchmarks generally require some data preparation before running the query.\nData preparation is done in the `load` section of the benchmark file.\nFor the `FILL` benchmark, we create a table using the parameters and a random number generator.\n\n```sql\nload\nselect setseed(0.8675309);\ncreate or replace table data as (\n\tselect\n\t\tk::TINYINT as k,\n\t\t(case when random() > ${errors} then m - 1704067200000 else null end) as v,\n\t\tm,\n\tfrom range(1704067200000, 1704067200000 + ${sf} * 1_000_000 * 10, 10) times(m)\n\tcross join range(${keys}) keys(k)\n);", "position": 9, "token_count": 207, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "dev-benchmark-009", "document_id": "dev-benchmark", "position": 9, "token_count": 207, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "dev/benchmark.md", "url": "/dev/benchmark", "title": "Benchmark Suite", "category": null, "tags": [], "section_url": "/dev/benchmark"}}
{"chunk_id": "dev-benchmark-010", "document_id": "dev-benchmark", "content": "```\n\nThe `argument` parameters are expanded in the query,\nsimilar to the way that `foreach` values are expanded in unit tests.\nNote that we can issue multiple SQL statements in the `load` section.\n\nOne the data is prepared, we are finally ready to specify the query we will benchmark!\nThis is done in the `run` section, and the restrictions are the same as for a unit test\n(e.g., no blank lines, etc.)\nFor the `FILL` benchmark, we want to find all places where the interpolation fails:\n\n```sql\nrun\nSELECT\n\tm,\n\tk,\n\tfill(v) OVER (PARTITION BY k ORDER BY m) as v\nFROM\n\tdata\nqualify v <> m - 1704067200000;\n```\n\nIf the interpolation is correct, then we will have no output, no matter the scale.\nWe can check this with the final `result` clause,\nwhich ash the same syntax as a unit test:\n\n```text\nresult III", "position": 10, "token_count": 213, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "dev-benchmark-010", "document_id": "dev-benchmark", "position": 10, "token_count": 213, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "dev/benchmark.md", "url": "/dev/benchmark", "title": "Benchmark Suite", "category": null, "tags": [], "section_url": "/dev/benchmark"}}
{"chunk_id": "dev-benchmark-011", "document_id": "dev-benchmark", "content": "```\n\nBy providing no output rows, we can check the correctness of the query as well as its performance.\n\nThere are many other examples in the top level `benchmark/` directory,\nand you may want to have a look to discover some other techniques.", "position": 11, "token_count": 56, "has_code": true, "section_hierarchy": [], "metadata": {"chunk_id": "dev-benchmark-011", "document_id": "dev-benchmark", "position": 11, "token_count": 56, "has_code": true, "overlap_with_previous": true, "section_hierarchy": [], "file_path": "dev/benchmark.md", "url": "/dev/benchmark", "title": "Benchmark Suite", "category": null, "tags": [], "section_url": "/dev/benchmark"}}
